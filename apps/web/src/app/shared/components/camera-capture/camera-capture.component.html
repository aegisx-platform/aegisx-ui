<!-- Camera Capture Container -->
<div class="camera-capture">
  <!-- Header -->
  <div class="camera-header">
    <h3>Take Photo</h3>
    <button mat-icon-button (click)="close()" class="close-btn">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <!-- Camera View -->
  <div class="camera-view">
    <!-- Loading State -->
    @if (isLoading()) {
      <div class="loading-state">
        <mat-spinner diameter="48"></mat-spinner>
        <p>Initializing camera...</p>
      </div>
    }

    <!-- Error State -->
    @if (errorMessage(); as error) {
      <div class="error-state">
        <mat-icon class="error-icon">camera_off</mat-icon>
        <p class="error-text">{{ error }}</p>
        <button mat-raised-button color="primary" (click)="retry()">
          <mat-icon>refresh</mat-icon>
          Retry
        </button>
      </div>
    }

    <!-- Video Preview (Live Camera) -->
    @if (!isLoading() && !errorMessage() && !capturedPhoto()) {
      <video #videoElement autoplay playsinline class="video-preview"></video>
    }

    <!-- Captured Photo Preview -->
    @if (capturedPhoto(); as photo) {
      <div class="photo-preview">
        <img [src]="photo" alt="Captured photo" />
      </div>
    }
  </div>

  <!-- Controls -->
  @if (!isLoading() && !errorMessage()) {
    <div class="camera-controls">
      @if (!capturedPhoto()) {
        <!-- Live Camera Controls -->
        <div class="live-controls">
          <!-- Switch Camera Button (if multiple cameras available) -->
          @if (hasMultipleCameras()) {
            <button
              mat-icon-button
              (click)="switchCamera()"
              class="control-btn"
              matTooltip="Switch Camera"
            >
              <mat-icon>flip_camera_ios</mat-icon>
            </button>
          }

          <!-- Capture Button -->
          <button
            mat-fab
            color="primary"
            (click)="capture()"
            class="capture-btn"
          >
            <mat-icon>camera</mat-icon>
          </button>

          <!-- Spacer (for centering capture button) -->
          @if (hasMultipleCameras()) {
            <div class="spacer"></div>
          }
        </div>
      } @else {
        <!-- Photo Captured Controls -->
        <div class="photo-controls">
          <button mat-raised-button (click)="retake()">
            <mat-icon>refresh</mat-icon>
            Retake
          </button>
          <button mat-raised-button color="primary" (click)="close()">
            <mat-icon>check</mat-icon>
            Use Photo
          </button>
        </div>
      }
    </div>
  }
</div>
