<div
  class="attachment-item group relative flex items-center gap-4 rounded-lg border border-gray-200 bg-white p-4 shadow-sm transition-all hover:shadow-md dark:border-gray-700 dark:bg-gray-800"
>
  <!-- Drag Handle -->
  @if (showDragHandle()) {
    <div
      class="drag-handle cursor-move text-gray-400 opacity-0 transition-opacity group-hover:opacity-100"
      title="Drag to reorder"
    >
      <mat-icon class="icon-size-5">drag_indicator</mat-icon>
    </div>
  }

  <!-- Thumbnail / Icon -->
  <div class="flex-shrink-0">
    @if (
      isImage(attachment().file.mimeType) &&
      attachment().file.signedUrls?.thumbnail
    ) {
      <!-- Image Thumbnail -->
      <div
        class="flex h-16 w-16 items-center justify-center overflow-hidden rounded-lg border border-gray-200 bg-gray-50 dark:border-gray-600 dark:bg-gray-700"
      >
        <img
          [src]="attachment().file.signedUrls!.thumbnail"
          [alt]="attachment().file.originalName"
          class="h-full w-full object-cover"
          loading="lazy"
        />
      </div>
    } @else {
      <!-- File Icon -->
      <div
        class="flex h-16 w-16 items-center justify-center rounded-lg border border-gray-200 bg-gray-50 dark:border-gray-600 dark:bg-gray-700"
      >
        <mat-icon
          [class]="getIconColor(attachment().file.mimeType)"
          class="icon-size-8"
        >
          {{ getFileIcon(attachment().file.mimeType) }}
        </mat-icon>
      </div>
    }
  </div>

  <!-- File Info -->
  <div class="flex-1 min-w-0">
    <!-- File Name -->
    <h4
      class="truncate text-sm font-medium text-gray-900 dark:text-gray-100"
      [title]="attachment().file.originalName"
    >
      {{ attachment().file.originalName }}
    </h4>

    <!-- File Metadata -->
    <div
      class="mt-1 flex items-center gap-3 text-xs text-gray-500 dark:text-gray-400"
    >
      <!-- File Size -->
      <span class="flex items-center gap-1">
        <mat-icon class="icon-size-4">storage</mat-icon>
        {{ formatFileSize(attachment().file.fileSize) }}
      </span>

      <!-- Upload Date -->
      <span class="flex items-center gap-1">
        <mat-icon class="icon-size-4">calendar_today</mat-icon>
        {{ formatDate(attachment().file.createdAt) }}
      </span>

      <!-- Attachment Type Badge -->
      @if (attachment().attachmentType) {
        <span
          class="inline-flex items-center rounded-full bg-blue-100 px-2 py-0.5 text-xs font-medium text-blue-800 dark:bg-blue-900 dark:text-blue-200"
        >
          {{ attachment().attachmentType }}
        </span>
      }
    </div>

    <!-- Metadata (if exists) -->
    @if (
      attachment().metadata && getMetadataKeys(attachment().metadata).length > 0
    ) {
      <div class="mt-2 flex flex-wrap gap-2">
        @for (key of getMetadataKeys(attachment().metadata); track key) {
          <span
            class="inline-flex items-center gap-1 rounded bg-gray-100 px-2 py-0.5 text-xs text-gray-600 dark:bg-gray-700 dark:text-gray-300"
          >
            <span class="font-medium">{{ key }}:</span>
            <span>{{ attachment().metadata[key] }}</span>
          </span>
        }
      </div>
    }
  </div>

  <!-- Actions -->
  @if (!readonly()) {
    <div class="flex items-center gap-1">
      <!-- View Button -->
      @if (attachment().file.signedUrls?.view) {
        <button
          mat-icon-button
          (click)="onView()"
          matTooltip="View file"
          class="text-gray-600 hover:text-blue-600 dark:text-gray-400 dark:hover:text-blue-400"
        >
          <mat-icon class="icon-size-5">visibility</mat-icon>
        </button>
      }

      <!-- Download Button -->
      @if (attachment().file.signedUrls?.download) {
        <button
          mat-icon-button
          (click)="onDownload()"
          matTooltip="Download file"
          class="text-gray-600 hover:text-green-600 dark:text-gray-400 dark:hover:text-green-400"
        >
          <mat-icon class="icon-size-5">download</mat-icon>
        </button>
      }

      <!-- Delete Button -->
      <button
        mat-icon-button
        (click)="onDelete()"
        matTooltip="Delete attachment"
        class="text-gray-600 hover:text-red-600 dark:text-gray-400 dark:hover:text-red-400"
      >
        <mat-icon class="icon-size-5">delete</mat-icon>
      </button>
    </div>
  }
</div>
