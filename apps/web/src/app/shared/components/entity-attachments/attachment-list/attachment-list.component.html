<!-- Loading State -->
@if (loading()) {
  <div class="flex items-center justify-center py-12">
    <div class="flex flex-col items-center gap-3">
      <div
        class="h-12 w-12 animate-spin rounded-full border-4 border-gray-200 border-t-blue-600"
      ></div>
      <p class="text-sm text-gray-500 dark:text-gray-400">
        Loading attachments...
      </p>
    </div>
  </div>
}

<!-- Empty State -->
@else if (attachments().length === 0 && showEmptyState()) {
  <div class="flex flex-col items-center justify-center py-12 text-center">
    <mat-icon
      class="mb-4 text-gray-400 dark:text-gray-500"
      style="font-size: 64px; width: 64px; height: 64px"
    >
      attach_file
    </mat-icon>
    <h3 class="mb-2 text-lg font-medium text-gray-900 dark:text-gray-100">
      No attachments yet
    </h3>
    <p class="text-sm text-gray-500 dark:text-gray-400">
      Upload files to attach them to this entity
    </p>
  </div>
}

<!-- Attachment List/Grid -->
@else {
  <div
    cdkDropList
    [cdkDropListDisabled]="!enableReorder()"
    (cdkDropListDropped)="onDrop($event)"
    [class.grid]="layout() === 'grid'"
    [class.grid-cols-1]="layout() === 'grid'"
    [class.md:grid-cols-2]="layout() === 'grid'"
    [class.lg:grid-cols-3]="layout() === 'grid'"
    [class.gap-4]="layout() === 'grid'"
    [class.space-y-3]="layout() === 'list'"
  >
    @for (
      attachment of attachments();
      track trackByAttachmentId($index, attachment)
    ) {
      <div
        cdkDrag
        [cdkDragDisabled]="!enableReorder()"
        class="attachment-list-item"
      >
        <!-- Drag Preview (custom drag preview) -->
        <div
          *cdkDragPreview
          class="rounded-lg border border-gray-300 bg-white p-4 shadow-lg dark:border-gray-600 dark:bg-gray-800"
        >
          <div class="flex items-center gap-3">
            <mat-icon class="text-gray-400">drag_indicator</mat-icon>
            <span
              class="truncate text-sm font-medium text-gray-900 dark:text-gray-100"
            >
              {{ attachment.file.originalName }}
            </span>
          </div>
        </div>

        <!-- Actual Attachment Item -->
        <app-attachment-item
          [attachment]="attachment"
          [showDragHandle]="enableReorder()"
          [readonly]="readonly()"
          (view)="onView(attachment)"
          (download)="onDownload(attachment)"
          (delete)="onDelete(attachment)"
        />
      </div>
    }
  </div>

  <!-- Reorder Hint -->
  @if (enableReorder() && attachments().length > 1) {
    <div
      class="mt-4 flex items-center gap-2 rounded-lg bg-blue-50 p-3 text-sm text-blue-700 dark:bg-blue-900/20 dark:text-blue-300"
    >
      <mat-icon class="icon-size-5">info</mat-icon>
      <span>Drag and drop to reorder attachments</span>
    </div>
  }
}
