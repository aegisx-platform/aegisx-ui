<div class="entity-attachments space-y-6">
  <!-- Header with Stats -->
  <div class="flex items-center justify-between">
    <div>
      <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100">
        Attachments
      </h3>
      <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">
        @if (config()) {
          <span>
            {{ attachments().length }} / {{ config()!.maxFiles || 'âˆž' }} files
          </span>
        }
      </p>
    </div>

    <!-- Refresh Button -->
    <button
      mat-icon-button
      (click)="loadAttachments()"
      [disabled]="loading()"
      matTooltip="Refresh attachments"
      class="text-gray-600 hover:text-blue-600 dark:text-gray-400 dark:hover:text-blue-400"
    >
      <mat-icon class="icon-size-5" [class.animate-spin]="loading()">
        refresh
      </mat-icon>
    </button>
  </div>

  <!-- Error Message -->
  @if (error()) {
    <div
      class="flex items-center gap-3 rounded-lg border border-red-200 bg-red-50 p-4 text-red-700 dark:border-red-800 dark:bg-red-900/20 dark:text-red-400"
    >
      <mat-icon class="icon-size-5">error</mat-icon>
      <div>
        <p class="font-medium">{{ error() }}</p>
        <button class="mt-1 text-sm underline" (click)="loadAttachments()">
          Try again
        </button>
      </div>
    </div>
  }

  <!-- Upload Section -->
  @if (showUpload() && !isMaxFilesReached()) {
    <div
      class="rounded-lg border border-gray-200 bg-white p-6 dark:border-gray-700 dark:bg-gray-800"
    >
      <div class="mb-4 flex items-center justify-between">
        <h4 class="text-sm font-medium text-gray-900 dark:text-gray-100">
          Upload Files
        </h4>
        @if (config()?.allowedTypes && config()!.allowedTypes!.length > 0) {
          <div class="text-xs text-gray-500 dark:text-gray-400">
            Allowed types:
            <span class="font-medium">
              {{ config()!.allowedTypes!.join(', ') }}
            </span>
          </div>
        }
      </div>

      <app-upload-widget
        mode="multiple"
        [maxFiles]="getMaxFiles()"
        [maxFileSize]="getMaxFileSize()"
        [accept]="getAllowedMimeTypes()"
        [enableDragDrop]="true"
        [enableCamera]="true"
        [enableCompression]="true"
        [useFileManager]="true"
        (onUploadComplete)="onUploadComplete($event)"
      />

      @if (uploading()) {
        <div
          class="mt-4 flex items-center gap-3 rounded-lg bg-blue-50 p-3 text-sm text-blue-700 dark:bg-blue-900/20 dark:text-blue-300"
        >
          <div
            class="h-4 w-4 animate-spin rounded-full border-2 border-blue-600 border-t-transparent"
          ></div>
          <span>Attaching files...</span>
        </div>
      }
    </div>
  }

  <!-- Max Files Reached Warning -->
  @if (isMaxFilesReached()) {
    <div
      class="flex items-center gap-3 rounded-lg border border-yellow-200 bg-yellow-50 p-4 text-yellow-700 dark:border-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-400"
    >
      <mat-icon class="icon-size-5">warning</mat-icon>
      <div>
        <p class="font-medium">Maximum files reached</p>
        <p class="mt-1 text-sm">
          You can attach up to {{ config()?.maxFiles }} files. Delete existing
          files to upload more.
        </p>
      </div>
    </div>
  }

  <!-- Attachments List -->
  <div
    class="rounded-lg border border-gray-200 bg-white p-6 dark:border-gray-700 dark:bg-gray-800"
  >
    <div class="mb-4">
      <h4 class="text-sm font-medium text-gray-900 dark:text-gray-100">
        Attached Files
      </h4>
    </div>

    <app-attachment-list
      [attachments]="attachments()"
      [enableReorder]="enableReorder()"
      [layout]="layout()"
      [loading]="loading()"
      (reorder)="onReorder($event)"
      (view)="onView($event)"
      (download)="onDownload($event)"
      (delete)="onDelete($event)"
    />
  </div>

  <!-- Configuration Info (Development only) -->
  @if (config() && false) {
    <details
      class="rounded-lg border border-gray-200 bg-gray-50 p-4 text-xs dark:border-gray-700 dark:bg-gray-900"
    >
      <summary
        class="cursor-pointer font-medium text-gray-700 dark:text-gray-300"
      >
        Debug: Configuration
      </summary>
      <pre class="mt-2 overflow-auto text-gray-600 dark:text-gray-400">{{
        config() | json
      }}</pre>
    </details>
  }
</div>
