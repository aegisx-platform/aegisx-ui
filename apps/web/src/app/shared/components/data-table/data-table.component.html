<div class="data-table-container">
  <!-- Loading Overlay -->
  <div *ngIf="loading" class="loading-overlay">
    <mat-spinner diameter="40"></mat-spinner>
  </div>

  <!-- Table Wrapper -->
  <div class="table-wrapper">
    <table
      mat-table
      [dataSource]="dataSource"
      matSort
      (matSortChange)="onSortChange($event)"
      class="data-table"
    >
      <!-- Dynamic Columns -->
      <ng-container
        *ngFor="let column of columns"
        [matColumnDef]="toString(column.key)"
      >
        <!-- Header -->
        <th
          mat-header-cell
          *matHeaderCellDef
          [ngClass]="column.cssClass"
          [style.width]="column.width"
        >
          <div *ngIf="isSortable(column)" mat-sort-header [disabled]="loading">
            {{ column.header }}
          </div>
          <div *ngIf="!isSortable(column)">
            {{ column.header }}
          </div>
        </th>

        <!-- Cell -->
        <td
          mat-cell
          *matCellDef="let row"
          [ngClass]="column.cssClass"
          [style.width]="column.width"
          (click)="onRowClick(row, $event)"
        >
          <ng-container [ngSwitch]="column.type">
            <!-- Text Column (default) -->
            <span *ngSwitchCase="'text'" class="cell-text">
              {{
                column.format
                  ? column.format(getCellValue(row, column))
                  : getCellValue(row, column)
              }}
            </span>

            <!-- Date Column -->
            <span *ngSwitchCase="'date'" class="cell-date">
              {{ getCellValue(row, column) | date: 'short' }}
            </span>

            <!-- Badge Column -->
            <span
              *ngSwitchCase="'badge'"
              [ngClass]="'badge ' + getBadgeClass(getCellValue(row, column))"
              class="cell-badge"
            >
              {{
                badgeStyles[toString(getCellValue(row, column))]?.label ||
                  getCellValue(row, column)
              }}
            </span>

            <!-- Actions Column -->
            <div *ngSwitchCase="'actions'" class="cell-actions">
              <button
                *ngFor="let action of column.actions"
                mat-icon-button
                [color]="action.color || 'primary'"
                [matTooltip]="action.label"
                [disabled]="isActionDisabled(action, row) || loading"
                (click)="onActionClick(action.action, row, $event)"
                class="action-button"
              >
                <mat-icon *ngIf="action.icon">{{ action.icon }}</mat-icon>
              </button>
            </div>

            <!-- Custom/Default Column -->
            <span *ngSwitchDefault class="cell-default">
              {{ getCellValue(row, column) }}
            </span>
          </ng-container>
        </td>
      </ng-container>

      <!-- Header Row -->
      <tr
        mat-header-row
        *matHeaderRowDef="displayedColumns"
        class="header-row"
      ></tr>

      <!-- Data Row -->
      <tr
        mat-row
        *matRowDef="let row; columns: displayedColumns"
        [ngClass]="getRowClasses()"
        class="data-row"
      ></tr>

      <!-- No Data Row -->
      <tr *matNoDataRow class="no-data-row">
        <td [attr.colspan]="displayedColumns.length" class="no-data-cell">
          <div class="no-data-message">
            <mat-icon>inbox</mat-icon>
            <p>No data available</p>
          </div>
        </td>
      </tr>
    </table>
  </div>

  <!-- Paginator -->
  <mat-paginator
    [length]="totalItems"
    [pageSize]="pageSize"
    [pageSizeOptions]="pageSizeOptions"
    (page)="onPageChange($event)"
    class="data-table-paginator"
  ></mat-paginator>
</div>
