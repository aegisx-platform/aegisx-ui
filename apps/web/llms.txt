# AegisX Web (Angular Frontend)

> Enterprise Angular application with authentication, RBAC, and comprehensive feature modules.

## Overview

The `apps/web` is the main Angular frontend application featuring:
- Angular 18+ with standalone components
- Authentication with JWT
- Role-Based Access Control (RBAC)
- Lazy-loaded feature modules
- Uses `@aegisx/ui` component library
- Angular Material integration
- Real-time WebSocket support

## Quick Start

```bash
# Development
pnpm run dev:web

# Build
pnpm nx build web

# Test
pnpm nx test web
```

---

## Architecture

```
apps/web/src/app/
├── app.ts               # App component
├── app.routes.ts        # Root routes
├── app.config.ts        # App configuration
├── core/                # Core services & modules
├── shared/              # Shared components & utilities
├── features/            # Feature modules (generated)
├── pages/               # Page components
├── dev-tools/           # Development utilities
└── schemas/             # Frontend schemas
```

---

## Core Modules (`src/app/core/`)

| Module | Description |
|--------|-------------|
| `auth` | Authentication service, guards, interceptors |
| `rbac` | Role-based access control, permission guards |
| `users` | User management |
| `user-profile` | Profile editing, preferences, activity log |
| `settings` | Application settings |
| `navigation` | Dynamic navigation service |
| `api-keys` | API key management |
| `audit` | Login attempts, file audit |
| `pdf-templates` | PDF template editor |
| `http` | HTTP interceptors |
| `error-handling` | Global error handling |
| `theme` | Theme management |
| `monitoring` | System monitoring UI |

---

## Routes

### Authentication (Guest Only)
| Path | Component | Description |
|------|-----------|-------------|
| `/login` | LoginPage | User login |
| `/register` | RegisterPage | User registration |
| `/forgot-password` | ForgotPasswordPage | Password reset request |
| `/reset-password` | ResetPasswordPage | Password reset form |
| `/verify-email` | VerifyEmailPage | Email verification |

### Protected Routes
| Path | Component | Description |
|------|-----------|-------------|
| `/home` | HomePage | Dashboard home |
| `/users` | UsersModule | User management |
| `/profile` | UserProfileModule | User profile |
| `/settings` | SettingsModule | App settings |
| `/rbac` | RbacModule | RBAC management |
| `/monitoring` | MonitoringModule | System monitoring |
| `/audit` | AuditModule | Audit logs |
| `/pdf-templates` | PdfTemplatesModule | PDF template editor |
| `/file-upload` | FileUploadPage | File upload demo |

### Error Pages
| Path | Description |
|------|-------------|
| `/401` | Unauthorized |
| `/403` | Forbidden |
| `/404` | Not Found |
| `/429` | Rate Limit |
| `/500` | Server Error |

---

## Authentication

### AuthService
```typescript
import { AuthService } from '@core/auth';

const authService = inject(AuthService);

// Login
await authService.login(email, password);

// Logout
await authService.logout();

// Check auth status
authService.isAuthenticated$;
authService.currentUser$;
```

### Guards
| Guard | Purpose |
|-------|---------|
| `AuthGuard` | Require authentication |
| `GuestGuard` | Only for non-authenticated users |
| `RoleGuard` | Require specific role |
| `PermissionGuard` | Require specific permission |

### HTTP Interceptors
| Interceptor | Purpose |
|-------------|---------|
| `AuthInterceptor` | Add JWT to requests |
| `BaseUrlInterceptor` | Add API base URL |
| `HttpErrorInterceptor` | Handle HTTP errors |

---

## RBAC

### RbacService
```typescript
import { RbacService } from '@core/rbac';

const rbac = inject(RbacService);

// Check permission
rbac.hasPermission('users.read');

// Check role
rbac.hasRole('admin');
```

### HasPermission Directive
```html
<button *hasPermission="'users.write'">Edit User</button>
```

### Permission Guard
```typescript
{
  path: 'users',
  canActivate: [PermissionGuard],
  data: {
    requiredPermissions: ['users.read'],
  },
}
```

---

## Services

### User Service
```typescript
import { UserService } from '@core/users';

const userService = inject(UserService);

// Get users
userService.getUsers(params);

// CRUD operations
userService.createUser(data);
userService.updateUser(id, data);
userService.deleteUser(id);
```

### Navigation Service
```typescript
import { NavigationService } from '@core/navigation';

const navService = inject(NavigationService);

// Get navigation items
navService.navigation$;

// Filter by permissions
navService.getFilteredNavigation();
```

### Settings Service
```typescript
import { SettingsService } from '@core/settings';

const settings = inject(SettingsService);

// Get/Set settings
settings.getSetting('theme');
settings.updateSetting('theme', 'dark');
```

---

## Shared Module (`src/app/shared/`)

### Components
| Component | Description |
|-----------|-------------|
| `CameraCaptureComponent` | Camera capture |
| `UploadWidgetComponent` | File upload widget |
| `DateRangeFilterComponent` | Date range filter |
| `EntityAttachmentsComponent` | Entity attachments |
| `MonacoEditorComponent` | Code editor |

### Services
| Service | Description |
|---------|-------------|
| `UploadService` | File upload handling |
| `FileManagerService` | File management |
| `AttachmentService` | Entity attachments |
| `CameraService` | Camera access |
| `ImageCompressionService` | Image compression |

### UI Components
Uses `@aegisx/ui` library - see `libs/aegisx-ui/llms.txt`

---

## Features Module (`src/app/features/`)

Generated CRUD modules go here:

```
features/
├── test-products/
│   ├── test-products.routes.ts
│   ├── components/
│   │   ├── test-products-list/
│   │   ├── test-products-form/
│   │   └── test-products-detail/
│   ├── services/
│   │   └── test-products.service.ts
│   └── types/
│       └── test-products.types.ts
```

---

## State Management

### Real-time State Manager
```typescript
import { BaseRealtimeStateManager } from '@shared/business';

class UserRealtimeState extends BaseRealtimeStateManager<User> {
  constructor() {
    super('users');
  }
}
```

### Feature State Pattern
```typescript
// In service
private readonly _items = signal<Item[]>([]);
readonly items = this._items.asReadonly();

// Update
this._items.set(newItems);
```

---

## HTTP Configuration

### Base URL
Configured in `proxy.conf.js` for development:
```javascript
'/api': {
  target: 'http://localhost:3333',
  secure: false,
}
```

### Error Handling
Global error interceptor handles:
- 401: Redirect to login
- 403: Show forbidden page
- 404: Show not found page
- 429: Show rate limit page
- 500: Show server error page

---

## Environment Configuration

```typescript
// environments/environment.ts
export const environment = {
  production: false,
  apiUrl: '/api',
  wsUrl: 'ws://localhost:3333',
};

// environments/environment.prod.ts
export const environment = {
  production: true,
  apiUrl: '/api',
  wsUrl: 'wss://api.example.com',
};
```

---

## Development Tools (`src/app/dev-tools/`)

Available in development mode only:

| Tool | Description |
|------|-------------|
| `DebugIconsComponent` | Icon browser |
| `TestNavigationComponent` | Navigation testing |
| `TestMaterialComponent` | Material testing |
| `TestAxComponent` | AegisX UI testing |

Access: `/dev/*` routes

---

## Page Structure Pattern

```typescript
@Component({
  selector: 'app-users',
  standalone: true,
  imports: [
    CommonModule,
    AxCardComponent,
    // ... other imports
  ],
  template: `...`,
})
export class UsersPage implements OnInit {
  private readonly userService = inject(UserService);

  readonly users = signal<User[]>([]);
  readonly loading = signal(false);

  ngOnInit() {
    this.loadUsers();
  }

  async loadUsers() {
    this.loading.set(true);
    const data = await this.userService.getUsers();
    this.users.set(data);
    this.loading.set(false);
  }
}
```

---

## File Structure Reference

```
apps/web/src/app/
├── app.ts
├── app.routes.ts
├── app.config.ts
├── core/
│   ├── auth/
│   │   ├── services/auth.service.ts
│   │   ├── guards/auth.guard.ts
│   │   └── interceptors/auth.interceptor.ts
│   ├── rbac/
│   │   ├── services/rbac.service.ts
│   │   ├── guards/permission.guard.ts
│   │   └── directives/has-permission.directive.ts
│   ├── users/
│   ├── user-profile/
│   ├── settings/
│   ├── navigation/
│   ├── api-keys/
│   ├── audit/
│   ├── pdf-templates/
│   ├── http/
│   ├── error-handling/
│   ├── theme/
│   └── monitoring/
├── shared/
│   ├── components/
│   ├── services/
│   ├── utils/
│   ├── ui/
│   └── business/
├── features/
│   └── (generated modules)
├── pages/
│   ├── auth/
│   ├── errors/
│   ├── dashboard/
│   └── components/
├── dev-tools/
└── schemas/
```
