# Claude Development Rules

## üö® CRITICAL: Multi-Instance Environment Rules

**This project runs in a MULTI-INSTANCE setup with other repositories.**

### Port Configuration - DO NOT MODIFY

**NEVER change these files without explicit permission:**
- `.env.local` - Contains instance-specific ports
- `.env` - Base environment configuration
- `proxy.conf.js` - Frontend proxy configuration

**DON'T ASSUME PORTS - Always Check .env.local First:**
```bash
# Step 1: ALWAYS run this FIRST
cat .env.local | grep PORT

# You'll see the ACTUAL ports for THIS repo instance
# Different repos = Different ports!
```

### Before ANY Port-Related Action:

1. **ALWAYS check `.env.local` first** before assuming default ports
2. **NEVER use hardcoded ports** (like 3333, 5432, 6379)
3. **NEVER modify .env.local** unless user explicitly asks
4. **When testing APIs**, use the port from `.env.local`
5. **When opening browser**, use URLs from `.env.local`

### Safe Commands:

```bash
# ‚úÖ CORRECT - Uses .env.local automatically
pnpm run dev:api
pnpm run dev:web

# ‚ùå WRONG - Hardcoded ports
nx serve api --port 3333
curl http://localhost:3333/api/...

# ‚úÖ CORRECT - Read from .env.local
source .env.local && curl http://localhost:$API_PORT/api/...
```

### Verification Checklist:

Before running any command that involves ports:
- [ ] Read `.env.local` to get current instance ports
- [ ] Use environment variables or scripts that read from `.env.local`
- [ ] Verify the command doesn't hardcode any port numbers
- [ ] If opening browser, use the port from `.env.local`

### Testing API Endpoints:

```bash
# ‚úÖ CORRECT - Read port from .env.local
source .env.local && curl http://localhost:$API_PORT/api/health

# ‚ùå WRONG - Hardcoded port
curl http://localhost:3333/api/health
```

### Opening URLs in Browser:

```bash
# ‚úÖ CORRECT - Read from .env.local
source .env.local && open "http://localhost:$WEB_PORT/pdf-templates"

# ‚ùå WRONG - Hardcoded port
open "http://localhost:4200/pdf-templates"
```

## Port Conflict Prevention:

If you encounter "port already in use" error:
1. **DO NOT change .env.local**
2. Check what's using the port: `lsof -i :PORT_NUMBER`
3. Kill the conflicting process or ask user what to do
4. **NEVER assume a different port** - stick to .env.local

## Why This Matters:

- User runs multiple repos simultaneously (aegisx-starter-1, aegisx-starter-2, etc.)
- Each repo has its own unique ports assigned in `.env.local`
- Changing ports breaks the multi-instance setup
- Port conflicts mean data goes to the wrong database/redis instance

---

**Remember: `.env.local` is the source of truth for this instance. ALWAYS read it first!**
