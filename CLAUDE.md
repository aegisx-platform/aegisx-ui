# Enterprise Monorepo Application

> **üìö Complete documentation has been split into organized files in the `docs/` directory for better readability.**

## üö® Important Development Guidelines

### üö® CRITICAL: Multi-Instance Port Configuration

**This project uses AUTOMATIC port assignment based on folder name.**

**Setup Process (User runs this BEFORE starting development):**

```bash
pnpm run setup
# This runs: setup-env.sh ‚Üí generates .env.local with unique ports
#            docker:up ‚Üí starts containers
#            db:migrate ‚Üí runs migrations
#            db:seed ‚Üí seeds database
```

**How Ports Are Assigned (from setup-env.sh):**

- Folder `aegisx-starter` ‚Üí Default ports (API: 3333, PostgreSQL: 5432)
- Folder `aegisx-starter-1` ‚Üí Hash("1") = 49 ‚Üí API: 3383, PostgreSQL: 5482
- Folder `aegisx-starter-xyz` ‚Üí Hash("xyz") ‚Üí Unique ports calculated
- **Each folder gets DIFFERENT ports automatically**

**NEVER modify these generated files:**

- `.env.local` - Auto-generated by setup-env.sh
- `docker-compose.instance.yml` - Auto-generated by setup-env.sh
- `proxy.conf.js` - Reads from .env.local automatically

**How to Find Current Ports:**

```bash
# ALWAYS do this FIRST before any port-related operation
cat .env.local | grep PORT
```

**MANDATORY Rules:**

1. **User runs `pnpm run setup` FIRST** - Generates .env.local with correct ports
2. **ALWAYS read `.env.local`** before any operation - Don't assume ANY port
3. **Use `pnpm run dev:api`** - Reads from .env.local automatically via load-env.sh
4. **NEVER hardcode ports** - setup-env.sh calculates them from folder name
5. **If port conflict**: User must stop conflicting service, DON'T change .env.local

**Common Mistakes to AVOID:**

- ‚ùå Assuming API is on 3333 (depends on folder name hash)
- ‚ùå Running `nx serve api --port 3333` (bypasses .env.local)
- ‚ùå Modifying .env.local manually (breaks multi-instance setup)
- ‚úÖ User runs `pnpm run setup` first
- ‚úÖ Use `pnpm run dev:api` (respects .env.local)
- ‚úÖ Check ports: `cat .env.local | grep PORT`

**Why This Matters:**

- User runs multiple repos: aegisx-starter, aegisx-starter-1, aegisx-starter-feature-x
- setup-env.sh assigns unique ports based on folder name hash
- Wrong port = data goes to wrong database = DATA CORRUPTION
- Modifying .env.local breaks the automatic port assignment system

### üö® CRITICAL: Standard Development Policy

**NEVER make changes without explicit user approval**

- **DO NOT add/modify standards without asking first**
- **DO NOT extend checklists or create new verification steps**
- **DO NOT write code or configs based on assumptions**
- **ALWAYS ask user before adding new requirements**

**When encountering gaps in standards:**

1. **STOP development**
2. **Ask user:** "Found [issue]. Should we create standard for this?"
3. **Wait for explicit approval and direction**
4. **Create standard only as instructed by user**

**Examples of what requires user approval:**

- Adding new checklist items
- Creating new verification scripts
- Extending existing standards
- Adding new phase/step requirements
- Modifying workflow processes

### Git Commit Rules

**DO NOT include the following in git commits**:

- `ü§ñ Generated with Claude Code`
- `Co-Authored-By: Claude <noreply@anthropic.com>`

Keep commit messages clean and professional.

### üö® CRITICAL: Semantic Release Protection Policy

**FORBIDDEN PATTERNS IN COMMIT MESSAGES - WILL TRIGGER v2.x.x RELEASES:**

- **NEVER use "BREAKING CHANGE:" in commit messages**
- **NEVER use "BREAKING CHANGES:" in commit messages**
- **NEVER use "BREAKING:" in commit messages**
- **NEVER copy commit messages from other repositories without reviewing**

**SAFE ALTERNATIVES to use instead:**

- `IMPORTANT:` - For significant changes that need attention
- `MAJOR UPDATE:` - For substantial feature changes
- `SIGNIFICANT:` - For notable modifications
- `API CHANGE:` - For API modifications that maintain compatibility
- `MIGRATION:` - For database or configuration changes
- `DEPRECATED:` - For marking features as deprecated

**VERSION STRATEGY:**

- Project maintains **v1.x.x versioning only**
- Major version (v2.x.x) releases are **FORBIDDEN**
- All changes must be backward compatible
- Use minor/patch releases for all updates

**COMMIT MESSAGE REVIEW CHECKLIST:**

1. ‚úÖ No "BREAKING CHANGE" text anywhere in commit
2. ‚úÖ No "BREAKING CHANGES" text anywhere in commit
3. ‚úÖ No "BREAKING:" text anywhere in commit
4. ‚úÖ Use safe alternatives for significant changes
5. ‚úÖ Conventional commit format: `type(scope): description`

**IF ACCIDENTAL BREAKING CHANGE COMMIT:**

1. **STOP immediately** - Do not push
2. Use `git commit --amend` to fix message
3. If already pushed, contact project owner immediately
4. Follow emergency recovery procedures in `/docs/troubleshooting/semantic-release-recovery.md`

### File Management Rules

**CRITICAL: File Deletion Policy**

- **NEVER delete any files without explicit permission**
- **ALWAYS ask for approval before removing any file**
- **This includes temporary files, old code, or seemingly unused files**
- When refactoring or cleaning up, list files to be deleted and wait for confirmation

**CRITICAL: Documentation Organization Policy**

- **KEEP root directory clean** - Only essential files should remain in root
- **Essential root files only:**
  - `README.md` - Project introduction and quick start
  - `CHANGELOG.md` - Release notes and version history
  - `CLAUDE.md` - Instructions for AI development assistant
  - `PROJECT_STATUS.md` - Current development status
  - `package.json`, `tsconfig.json` - Core configuration files
- **Move documentation to organized structure:**
  - Feature docs ‚Üí `docs/features/[feature-name]/`
  - Architecture docs ‚Üí `docs/architecture/`
  - Development guides ‚Üí `docs/development/`
  - Infrastructure guides ‚Üí `docs/infrastructure/`
- **NEVER create standalone .md files in root** without specific justification

### PROJECT_STATUS.md Update Policy (MANDATORY)

**üö® CRITICAL: Keep file clean and maintainable with session archiving**

**Why This Matters:**

- `PROJECT_STATUS.md` is the session recovery document
- File becomes too large if all sessions are kept (2,800+ lines before archiving)
- **Only keep 2-3 most recent sessions** for quick recovery
- Old sessions archived to `docs/sessions/ARCHIVE_YYYY_QX.md`

**File Structure:**

```
PROJECT_STATUS.md              # Main status file (~500 lines)
‚îú‚îÄ Summary & Recommendations   # Always at the top
‚îú‚îÄ Recent Sessions (2-3)       # Latest sessions for quick recovery
‚îî‚îÄ Reference to archives       # Link to docs/sessions/

docs/sessions/
‚îú‚îÄ ARCHIVE_2024_Q4.md         # Sessions 38-46
‚îú‚îÄ ARCHIVE_2024_Q3.md         # Older sessions
‚îî‚îÄ SESSION_TEMPLATE.md        # Template for new sessions
```

**MANDATORY Rules:**

1. **Location**: Summary & Recommendations section is located **immediately after "Implemented Features"** section
2. **Update Frequency**: Update this section **every time you complete a major task or session**
3. **What to Update**:
   - ‚úÖ "What's Working Well" - Add new completed features
   - üéØ "Recommended Next Steps" - Update priorities based on current status
   - üìä "Project Health Status" - Update metrics if changed
   - üéâ "Current Project Status" - Update feature counts and capabilities

4. **Session Management**:
   - **Keep only 2-3 most recent sessions** in PROJECT_STATUS.md
   - **Archive old sessions** when file exceeds ~800 lines
   - **Use SESSION_TEMPLATE.md** for documenting new sessions
   - **Reference archives** at bottom of PROJECT_STATUS.md

**When to Update:**

- ‚úÖ After completing a feature
- ‚úÖ After significant architectural changes
- ‚úÖ After publishing new versions (CRUD Generator, etc.)
- ‚úÖ When starting a new major feature
- ‚úÖ At the end of each session if significant progress made

**When to Archive:**

- üì¶ When PROJECT_STATUS.md exceeds ~800 lines
- üì¶ When you have more than 3 completed sessions
- üì¶ At end of each quarter (Q1, Q2, Q3, Q4)

**How to Update:**

```bash
# 1. Open PROJECT_STATUS.md
# 2. Scroll to "Summary & Recommendations" section (near top)
# 3. Update relevant subsections
# 4. Update "Last Updated" date at bottom of section
# 5. Add new session using SESSION_TEMPLATE.md as reference
# 6. Archive old sessions if needed
# 7. Commit changes with descriptive message
```

**How to Archive Sessions:**

```bash
# 1. Identify sessions to archive (keep only 2-3 latest)
# 2. Create/update docs/sessions/ARCHIVE_YYYY_QX.md
# 3. Move old session content to archive file
# 4. Update PROJECT_STATUS.md to reference archive
# 5. Commit with message: "docs: archive sessions X-Y to ARCHIVE_YYYY_QX.md"
```

**Important Notes:**

- ‚ùå **DO NOT** duplicate Summary & Recommendations at the bottom
- ‚úÖ **KEEP IT** at the top after "Implemented Features" section
- ‚úÖ **ADD NOTE** at bottom: "_üìå Note: For archived sessions, see [docs/sessions/](./docs/sessions/)_"
- ‚úÖ **USE TEMPLATE**: Copy from `docs/sessions/SESSION_TEMPLATE.md` for new sessions

**Example Commit Messages:**

- `docs(status): update project health status after CRUD generator v2.1.0 release`
- `docs(status): add new completed features to recommendations`
- `docs(status): update next steps priorities`
- `docs(status): archive sessions 38-46 to ARCHIVE_2024_Q4.md`

### Feature Documentation Policy (MANDATORY)

**üö® ALL new features MUST have comprehensive documentation - NO EXCEPTIONS**

**For EVERY new feature, create a complete documentation package in `/docs/features/[feature-name]/`:**

1. **README.md** - Feature overview and quick start guide
2. **USER_GUIDE.md** - End-user guide for using the feature
3. **DEVELOPER_GUIDE.md** - Technical guide for developers
4. **API_REFERENCE.md** - Complete API documentation (if applicable)
5. **ARCHITECTURE.md** - System architecture and design decisions
6. **DEPLOYMENT_GUIDE.md** - Production deployment instructions
7. **TROUBLESHOOTING.md** - Common issues and solutions
8. **DOCUMENTATION_INDEX.md** - Navigation & learning guide

**Documentation Standards:**

- **Professional grade** - Suitable for enterprise environments
- **Multiple audiences** - End users, developers, administrators, architects
- **Practical examples** - Working code examples and step-by-step guides
- **Complete coverage** - All aspects of the feature documented
- **Cross-referenced** - Easy navigation between related documents
- **Maintainable** - Well-organized for future updates

**Example Reference:** See `/docs/features/activity-tracking/` for the complete documentation standard that should be followed for all new features.

### Schema Standards (MANDATORY)

**üö® ALL API routes MUST use TypeBox schemas - NO EXCEPTIONS**

- **See [TypeBox Schema Standard](./docs/05c-typebox-schema-standard.md) for implementation**
- **TypeBox provides both runtime validation and TypeScript types**
- **Use base schemas from `/src/schemas/base.schemas.ts`**
- **Register schemas via schema registry**

### Type Safety Policy (MANDATORY)

**üö® NEVER use `any` or type assertions without proper schemas - NO EXCEPTIONS**

**Full Type Flow Required:**

1. **Schema Definition**: Create TypeBox schema in `*.schemas.ts`
2. **Type Export**: Export `Static<typeof Schema>` type
3. **Route Registration**: Use schema in routes with proper imports
4. **Controller Typing**: Use exported types in FastifyRequest generics
5. **OpenAPI Documentation**: Schemas automatically generate OpenAPI spec

**Example Flow:**

```typescript
// 1. Schema definition
export const DeleteQuerySchema = Type.Object({
  force: Type.Optional(Type.Boolean())
});

// 2. Type export
export type DeleteQuery = Static<typeof DeleteQuerySchema>;

// 3. Route registration
querystring: DeleteQuerySchema,

// 4. Controller typing
request: FastifyRequest<{
  Params: FileIdParam;
  Querystring: DeleteQuery;
}>

// 5. Type-safe access
const force = request.query.force || false;
```

**Forbidden Patterns:**

- `request.query as any`
- `request.query as { field?: string }`
- Modifying TypeScript types without updating schemas
- Type assertions without schema validation

### UUID Validation Policy (MANDATORY)

**üö® UUID fields MUST be validated to prevent PostgreSQL casting errors - NO EXCEPTIONS**

**Built-in UUID Protection:**

- **Automatic Validation**: All repositories inherit UUID validation from BaseRepository
- **Smart Detection**: Auto-detects UUID fields based on patterns (`*_id`, `id`, `*uuid*`)
- **PostgreSQL Error Prevention**: Invalid UUIDs filtered out before database queries
- **Multiple Strategies**: STRICT (400 errors), GRACEFUL (filter invalid), WARN (log + continue)

**CRUD Generator Integration:**

```typescript
// Generated repositories automatically include UUID validation
export class ArticlesRepository extends BaseRepository<Articles, CreateArticles, UpdateArticles> {
  constructor(knex: Knex) {
    super(
      knex,
      'articles',
      [...searchFields],
      ['id', 'author_id'], // üõ°Ô∏è Explicit UUID fields for validation
    );
  }
}
```

**Manual Configuration:**

```typescript
// For custom repositories, declare UUID fields explicitly
repository.setUUIDFields(['user_id', 'category_id']);

// Configure validation strategy
repository.setUUIDValidationConfig({
  strategy: UUIDValidationStrategy.STRICT, // Throw 400 errors
  allowAnyVersion: true,
  logInvalidAttempts: true,
});
```

**Benefits:**

- **No PostgreSQL Errors**: Prevents `invalid input syntax for type uuid` errors
- **Better UX**: Invalid UUIDs handled gracefully instead of 500 errors
- **Automatic Protection**: All new CRUD modules get UUID validation by default
- **Zero Configuration**: Works automatically with naming conventions

### Universal Development Standard (MANDATORY)

**üö® MUST follow Universal Full-Stack Standard for ALL feature development - NO EXCEPTIONS**

See **[Universal Full-Stack Standard](./docs/development/universal-fullstack-standard.md)** for complete database-first development workflow that must be followed for every feature to prevent integration bugs.

### Feature Development Standard (MANDATORY)

**üö® MUST follow Feature Development Standard for EVERY feature - NO EXCEPTIONS**

- **See [Feature Development Standard](./docs/development/feature-development-standard.md)** for complete feature lifecycle from planning to completion
- **ALWAYS create feature documentation before coding** using templates from `docs/features/templates/`
- **Reserve resources** in [Resource Registry](./docs/features/RESOURCE_REGISTRY.md) before starting development
- **Follow [Multi-Feature Workflow](./docs/development/multi-feature-workflow.md)** when multiple features are being developed simultaneously
- **Update progress daily** in feature PROGRESS.md files
- **Check [Feature Status Dashboard](./docs/features/README.md)** for coordination with other developers

### API-First Development Policy (MANDATORY)

**üö® MUST follow API-First workflow for ALL feature development - NO EXCEPTIONS**

**Before implementing ANY frontend component or making API calls:**

1. **üìã CHECK API SPEC** - Review `docs/features/[feature]/API_CONTRACTS.md` thoroughly
2. **üîç VERIFY ENDPOINTS** - Confirm backend routes match the documented API spec exactly
3. **üß™ TEST API ENDPOINTS** - Test actual API calls before implementing frontend logic
4. **üìù VALIDATE SCHEMAS** - Ensure request/response schemas match TypeBox definitions
5. **üîÑ UPDATE DOCUMENTATION** - Update API docs if any changes are needed

**API Spec Verification Rules:**

- **NEVER assume endpoint URLs** - Always check the documented API contracts first
- **NEVER implement frontend without backend API** - API must exist and work before frontend
- **NEVER guess schema formats** - Use exact TypeBox schemas from documentation
- **ALWAYS test with real data** - Use actual API responses, not mock data

**If API spec missing or incorrect:**

1. **STOP development immediately**
2. **Ask user:** "API spec for [feature] is missing/incorrect. Should I update the spec or fix the implementation?"
3. **Wait for explicit direction**
4. **Update either spec or implementation as instructed**

**Example API-First Workflow:**

```bash
# 1. Check feature API contracts
cat docs/features/user-profile/API_CONTRACTS.md

# 2. Verify backend routes exist
grep -r "GET /api/profile/preferences" apps/api/src/

# 3. Test API endpoint
curl -X GET http://localhost:3333/api/profile/preferences

# 4. Only then implement frontend service
```

### Quality Assurance Workflow (MANDATORY)

**üö® MUST run QA Checklist after every code change - NO EXCEPTIONS**

See **[QA Checklist](./docs/development/qa-checklist.md)** for complete quality assurance steps that must be performed before every commit.

### Testing Workflow (MANDATORY)

**üö® ALWAYS follow this workflow when writing tests - NO EXCEPTIONS**

**Before writing ANY test:**

1. **üìã Check existing schemas** - Review `*.schemas.ts` files for the module you're testing
2. **üîç Verify request/response formats** - Ensure test data matches schema exactly
3. **üèóÔ∏è Check test app helper** - Ensure all required plugins are registered in test environment
4. **üìä Compare with main app** - Verify test setup mirrors production plugin registration order

**Test Data Rules:**

- **NEVER guess request formats** - Always use schema definitions
- **Match schemas exactly** - Include only fields defined in request schemas
- **Use schema-based factories** - Create separate functions for API-valid test data
- **Check plugin registration** - Ensure test app includes ALL plugins the route needs

**Example Test Workflow:**

```typescript
// 1. Check schema first
import { RegisterRequestSchema } from '../auth.schemas';

// 2. Create API-compatible test data
function createRegisterRequestData() {
  return {
    email: 'test@example.com',
    username: 'testuser',
    password: 'testpass123',
    firstName: 'Test',
    lastName: 'User',
    // ‚ùå Don't include: role, status, emailVerified (not in schema)
  };
}

// 3. Verify test app helper includes ALL required plugins
```

**‡∏ú‡∏¥‡∏î‡πÅ‡∏•‡πâ‡∏ß‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ - ‡∏´‡πâ‡∏≤‡∏°‡πÄ‡∏î‡∏≤!**

### üö® CRITICAL: Fastify preValidation Hook Error Handling (MANDATORY)

**üö® NEVER throw errors in Fastify preValidation hooks - ALWAYS return responses directly**

**Critical Issue Discovered (Session 47):**

Fastify `preValidation` hooks don't automatically convert thrown errors to HTTP responses. Throwing errors in preValidation hooks causes requests to hang indefinitely without sending responses to clients, leading to timeouts instead of proper error responses.

**MANDATORY Pattern for All Auth Middleware:**

```typescript
// ‚ùå WRONG: Throwing errors causes timeouts
fastify.decorate('verifyRole', function (allowedRoles: string[]) {
  return async function (request: FastifyRequest, _reply: FastifyReply) {
    if (!user || !user.role || !allowedRoles.includes(user.role)) {
      throw new Error('INSUFFICIENT_PERMISSIONS'); // ‚ùå Request hangs, no response sent!
    }
  };
});

// ‚úÖ CORRECT: Return response directly
fastify.decorate('verifyRole', function (allowedRoles: string[]) {
  return async function (request: FastifyRequest, reply: FastifyReply) {
    if (!user || !user.role || !allowedRoles.includes(user.role)) {
      return reply.forbidden('Insufficient permissions'); // ‚úÖ Immediate 403 response!
    }
  };
});
```

**MANDATORY Rules:**

1. **ALWAYS use `return reply.unauthorized()` for authentication failures** (401)
2. **ALWAYS use `return reply.forbidden()` for authorization failures** (403)
3. **NEVER throw `Error()` in preValidation hooks** - causes timeouts
4. **Include `reply: FastifyReply` parameter** - not `_reply` (underscore means unused)
5. **Error handlers may NOT catch preValidation hook errors** - must return responses directly

**Impact of Wrong Pattern:**

- ‚ùå Requests timeout after 60+ seconds without any response
- ‚ùå Server logs "Request error" but never sends HTTP response to client
- ‚ùå Hanging connections and resource leaks
- ‚ùå Poor user experience and production instability
- ‚ùå Affects ALL protected routes using these middleware

**Correct Implementation (Reference):**

See `apps/api/src/core/auth/strategies/auth.strategies.ts` for standardized implementations:

- `verifyJWT` (lines 8-40) - Returns `reply.unauthorized()` ‚úÖ
- `verifyRole` (lines 44-51) - Returns `reply.forbidden()` ‚úÖ
- `verifyOwnership` (lines 54-66) - Returns `reply.forbidden()` ‚úÖ
- `verifyPermission` (lines 69-132) - Returns `reply.forbidden()` ‚úÖ

**Why This Matters:**

This was a **production-critical bug** discovered when User Role Assignment page hung indefinitely instead of returning 403 errors. All auth middleware were standardized to prevent this issue across the entire codebase.

## üî¥ IMPORTANT: This project uses PNPM, not NPM or Yarn

**Always use `pnpm` commands, never use `npm` or `yarn` commands for dependencies**

## üèóÔ∏è Multi-Instance Development Setup

**When working on multiple features simultaneously (cloned repos):**

### üìã Quick Setup (One Command)

```bash
# Auto-configure ports and containers based on folder name
pnpm setup
# This runs: setup-env.sh + docker-compose up + migrations + seeds
```

### üîß Manual Setup Steps

```bash
# 1. Configure instance-specific environment
pnpm run setup:env

# 2. Start services with unique ports/containers
pnpm run docker:up

# 3. Initialize database
pnpm run db:migrate && pnpm run db:seed
```

### üìä Port Assignment Strategy

- **Main repo (aegisx-starter)**: Default ports (5432, 6380, 3333, 4200)
- **Feature repos (aegisx-starter-{name})**: Auto-assigned unique ports
- **Examples**:
  - `aegisx-starter-mpv` ‚Üí PostgreSQL: 5433, Redis: 6381, API: 3334
  - `aegisx-starter-rbac` ‚Üí PostgreSQL: 5434, Redis: 6382, API: 3335

### üõ†Ô∏è Instance Management Commands

```bash
# View all instances and their ports
./scripts/port-manager.sh list

# Check for port conflicts
./scripts/port-manager.sh conflicts

# Stop specific instance
./scripts/port-manager.sh stop aegisx-starter-mpv

# Stop all instances
./scripts/port-manager.sh stop-all

# Show running services
./scripts/port-manager.sh running

# Clean up unused containers/volumes
./scripts/port-manager.sh cleanup
```

### üéØ Benefits

- ‚úÖ **Isolated environments** - Each feature has its own database
- ‚úÖ **No port conflicts** - Auto-assigned unique ports
- ‚úÖ **Parallel development** - Work on multiple features simultaneously
- ‚úÖ **Easy switching** - Stop/start instances as needed
- ‚úÖ **Consistent naming** - Folder name determines configuration

## Quick Navigation

### üöÄ Start Here

- **[üìñ Getting Started](./docs/getting-started/getting-started.md)** - **‡∏≠‡πà‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô! Git workflow & rules**

### Development Resources

- **[üö® Current Project Status](./PROJECT_STATUS.md)** - Session recovery & current progress
- **[üìö Complete Documentation](./docs/)** - Organized documentation hub
- **[üìä Feature Status Dashboard](./docs/features/README.md)** - Central feature development tracking
- **[üìã Feature Development Standard](./docs/development/feature-development-standard.md)** - **MANDATORY** feature lifecycle
- **[ü§ù Multi-Feature Workflow](./docs/development/multi-feature-workflow.md)** - Parallel development coordination
- **[üìù Resource Registry](./docs/features/RESOURCE_REGISTRY.md)** - Reserve resources to prevent conflicts
- **[üìä Feature Tracking System](./docs/development/feature-tracking.md)** - Track development progress
- **[üöÄ Quick Commands](./docs/development/quick-commands.md)** - Claude command reference (/feature, /status, etc.)
- **[üèóÔ∏è Project Setup](./docs/getting-started/project-setup.md)** - Bootstrap guide
- **[üîÑ Development Workflow](./docs/development/development-workflow.md)** - Step-by-step workflows
- **[üéØ API-First Workflow](./docs/development/api-first-workflow.md)** - Recommended development approach
- **[üèõÔ∏è Architecture](./docs/architecture/architecture-overview.md)** - Frontend/Backend patterns
- **[üß™ Testing Strategy](./docs/testing/testing-strategy.md)** - E2E with Playwright MCP
- **[üöÄ Deployment](./docs/infrastructure/deployment.md)** - Docker + CI/CD
- **[ü§ñ MCP Integration](./docs/development/mcp-integration.md)** - Nx MCP & Playwright MCP usage
- **[üìã All Commands Reference](./docs/references/claude-commands.md)** - Complete shell command list
- **[ü§ñ CRUD Generator](./docs/crud-generator/)** - Automatic CRUD API generation with error handling & validation

## ü§ñ Custom Commands

These are shortcut commands that can be used to trigger common workflows. When you see these commands, perform the actions listed below.

### doc-sync

**Purpose**: Update project documentation and sync with remote repository after completing a session or major work.

**Actions to Perform**:

1. **Update `PROJECT_STATUS.md`**:
   - Change "Last Updated" to current session number
   - Add new session entry to "Recent Development Sessions"
   - Update "What's Working Well" section if new features were added
   - Update "Last Updated" in summary section

2. **Update `CLAUDE.md`**:
   - Add current session to "Recent Development Sessions"
   - Move previous "Current Status" to "Previous Status"

3. **Git operations**:
   - `git add PROJECT_STATUS.md CLAUDE.md`
   - `git commit -m "docs: update documentation for Session X"`
   - `git pull origin develop`
   - `git push origin develop`

**Usage Examples**:

- "doc-sync"
- "please doc-sync"
- "‡∏ä‡πà‡∏ß‡∏¢ doc-sync ‡πÉ‡∏´‡πâ‡∏´‡∏ô‡πà‡∏≠‡∏¢"
- "doc-sync for this session"

**When to Use**: After completing significant work or at the end of a development session.

---

## üìù Recent Development Sessions

> **üìå For complete session history and details, see [PROJECT_STATUS.md](./PROJECT_STATUS.md) ¬ß Recent Development Sessions**

### Current Status (Session 60 - 2025-11-02) ‚úÖ COMPLETED

**Session 60 - Standardized Error Pages:**

- ‚úÖ **5 Error Page Components** - Full-screen error pages (401, 403, 404, 429, 500)
- ‚úÖ **Tremor-Inspired Design** - Consistent color palette and professional appearance
- ‚úÖ **HTTP Interceptor Integration** - Automatic navigation based on status codes
- ‚úÖ **Action Buttons** - User-friendly navigation (Go Home, Go Back, Try Again)
- ‚úÖ **Lazy Loading** - Error pages loaded on-demand for optimal performance

**Key Implementations:**

- **Error Pages**: Created 5 standalone components with Material Design + TailwindCSS
- **Color Themes**: Violet (401), Amber (403), Blue (404), Cyan (429), Red (500)
- **HTTP Interceptor**: Updated to navigate to appropriate error pages
- **Route Configuration**: Registered error page routes with lazy loading

**Files Modified (7 files):**

- Frontend: 5 new error page components + 2 updated files (routes, interceptor)
- Total Lines: ~584 lines of production code

### Previous Status (Session 59 - 2025-11-02) ‚úÖ COMPLETED

**Session 59 - Platform Dashboard Widgets:**

- ‚úÖ **Backend API Keys Stats** - GET /api-keys/stats endpoint
- ‚úÖ **Dashboard Service** - Centralized API calls for dashboard
- ‚úÖ **4 Production Widgets** - API Keys, System Metrics, Alerts, DB Performance
- ‚úÖ **Real-Time Updates** - Auto-refresh with RxJS intervals

### Previous Status (Session 58 - 2025-11-01) ‚úÖ COMPLETED

**Session 58 - Error Logs Improvements + Navigation Permissions:**

- ‚úÖ **Error Log Dialog Fix** - Fixed Material dialog header scrolling issue
- ‚úÖ **Delete Single Error Log** - Complete DELETE endpoint with Material confirmation dialog
- ‚úÖ **Cleanup Functionality** - Fixed type mismatch (date ‚Üí days), added Material dialog with validation
- ‚úÖ **Reusable Dialogs** - Created CleanupDialogComponent and ConfirmDialogComponent
- ‚úÖ **Material Icon Fix** - Changed "monitoring" ‚Üí "speed" (core icon set compatibility)
- ‚úÖ **Permission Organization** - Restructured seeds for role-based navigation (Admin/Manager/User)

**Key Implementations:**

- **Dialog Structure Fix**: Proper Material Dialog pattern (fixed header/footer, scrollable content)
- **Full Stack Delete**: Backend endpoint + frontend Material confirmation dialog + error handling
- **Type Safety**: Fixed API schema to match TypeScript interfaces (`Type.Number` for days)
- **Manager Role Access**: Dashboard + Profile + User Management (updated seeds)
- **User Role Access**: Dashboard + Profile only (updated seeds)

**Files Modified (11 files):**

- Backend: 5 files (routes, controller, service, repository, schemas)
- Frontend: 4 files (3 components including 2 NEW dialogs, 1 types file)
- Seeds: 2 files (001_initial_data.ts, 003_navigation_menu.ts)
- Navigation: 2 files (seed icon + frontend icon)

### Previous Status (Session 57 - 2025-11-01) ‚úÖ COMPLETED

**Session 57 - Register Page + Rate Limiting:**

- ‚úÖ **Register Page** - Complete registration form with validation and auto-login
- ‚úÖ **Rate Limiting Improvements** - Balanced limits for better UX (100/5min register, 15/5min login, 10/5min reset)
- ‚úÖ **Error Standardization** - All rate limit errors include statusCode: 429 with custom messages

**Files Modified:**

- `apps/web/src/app/pages/auth/register.page.ts` (new - 370 lines)
- `apps/web/src/app/app.routes.ts` (added /register route)
- `apps/api/src/core/auth/auth.routes.ts` (3 rate limit updates)

### Previous Status (Session 56a & 56b - 2025-11-01) ‚úÖ COMPLETED

**Session 56a - Monitoring Dashboard Design Refinement:**

- ‚úÖ **Complete Color Redesign** - Migrated all 4 monitoring charts to Tremor-inspired soft color palette
- ‚úÖ **Unified Color Strategy** - Cool blue palette (Blue + Cyan + Indigo + Rose) for visual consistency
- ‚úÖ **Professional Dashboard** - Enterprise-grade appearance matching Tremor design system standards

**Session 56b - Password Reset Implementation:**

- ‚úÖ **Password Reset Service** - Complete implementation with secure random token generation
- ‚úÖ **Database Migration** - `password_reset_tokens` table with expiration and tracking
- ‚úÖ **3 API Endpoints** - Request reset, verify token, reset password with rate limiting
- ‚úÖ **Security Features** - One-time use tokens, 1-hour expiration, session invalidation

### Previous Status (Session 55 - 2025-11-01) ‚úÖ COMPLETED

**Session 55 (2025-11-01) - Priority 2 Enterprise Standards:**

- ‚úÖ **Multi-User Concurrency Standards** (755 lines) - Complete guide for handling concurrent data access
- ‚úÖ **Integration Patterns** (730 lines) - Enterprise system integration best practices
- ‚úÖ **Advanced Validation Patterns** (630 lines) - Robust data validation strategies
- ‚úÖ Complete enterprise development standards (6 total, 4,772 lines)

### Previous Status (Session 54 - 2025-10-31) ‚úÖ COMPLETED

**Session 54 (2025-10-31) - System Monitoring Dashboard Fix:**

- ‚úÖ **Fixed 4 Metric Cards** - Resolved issue where metric cards were not displaying on System Monitoring page
- ‚úÖ **API Structure Alignment** - Updated `/database-pool` and `/cache-stats` endpoints to return nested structures
- ‚úÖ **Schema Updates** - Updated OpenAPI schemas to match TypeScript interfaces

### Previous Status (Session 52 Continuation - 2025-10-31) ‚úÖ COMPLETED

**Session 52 Continuation (2025-10-31) - Documentation & Repository Organization:**

- ‚úÖ **Custom Commands System** - Added `doc-sync` shortcut command to CLAUDE.md for reusable workflows
- ‚úÖ **Root Directory Cleanup** - Moved 2 audit reports to organized directories (preserved git history)
- ‚úÖ **README.md Complete Update** - Migrated to PNPM, added current features, comprehensive 528-line rewrite
- ‚úÖ **Documentation Organization** - 4 essential root files, audit reports properly organized

**Key Implementations:**

- **doc-sync Command**: 3-step workflow documented (Update PROJECT_STATUS.md ‚Üí Update CLAUDE.md ‚Üí Git operations)
- **Root Organization**: Moved `API_ENDPOINT_AUDIT_REPORT.md` and `RBAC_MIGRATION_AUDIT.md` to proper directories
- **README.md Rewrite**: Replaced all Yarn commands with PNPM, added CRUD Generator section, updated technology stack
- **Session Continuity**: Custom commands persist across AI sessions via documentation

**Benefits:**

- üöÄ **Reusable Workflows**: doc-sync command saves time in future sessions
- üìÅ **Clean Repository**: Root directory organized per documentation policy
- üìö **Current Documentation**: README accurately reflects actual project state
- üéØ **Session Continuity**: Custom commands enable faster future development

### Previous Status (Session 52 - 2025-10-31) ‚úÖ COMPLETED

**Session 52 (2025-10-31) - Navigation Icons Migration to Material Icons:**

- ‚úÖ **Complete Icon Migration** - All 16 navigation icons migrated from Heroicons to Material Icons
- ‚úÖ **Seed Data Updated** - Database seed file updated with Material Icons
- ‚úÖ **Default Navigation Updated** - Frontend fallback navigation aligned with seed data
- ‚úÖ **Better Performance** - Material Icons already included with Angular Material (lighter bundle)
- ‚úÖ **Consistent Design** - Perfect visual harmony with Material Design components

**Benefits:**

- üé® **Lighter Bundle**: Material Icons already loaded with Angular Material
- ‚ö° **Better Performance**: Icon fonts load faster than SVG for multiple icons
- üé® **Consistent UI**: All icons now follow Material Design language

### Previous Status (Session 51 - 2025-10-31) ‚úÖ COMPLETED

**Session 51 (2025-10-31) - CRUD Generator Authorization Pattern Migration:**

- ‚úÖ **Permission-Based Authorization** - Migrated from role-based to permission-based authorization
- ‚úÖ **36 Authorization Points Updated** - Across 3 backend templates
- ‚úÖ **Version Bumped** - CRUD Generator v2.1.1 ready for npm publish

### Previous Status (Session 49 - 2025-10-31) ‚úÖ COMPLETED

**Session 49 (2025-10-31) - Complete Multi-Role System + Seed Consolidation:**

- ‚úÖ **Complete Multi-Role Support** - Full frontend + backend implementation with 100% backward compatibility
- ‚úÖ **18 Files Modified** - 8 Frontend + 10 Backend (Priority 1 & 2)
- ‚úÖ **Navigation Seed Consolidation** - Single authoritative seed file
- ‚úÖ **Production Ready** - All builds passing, 0 TypeScript errors

**Key Implementations:**

- **Frontend Core (6 files):**
  - auth.service.ts - `roles?: string[]` support, `hasRole()` checks both role and roles[]
  - user.service.ts - User and UserProfile interfaces with multi-role
  - user-list.component.ts - Material chips with color coding (admin=purple, manager=blue, user=green)
  - profile-info.component.ts - Comma-separated roles display
  - realtime-user-list.component.ts - Comma-separated roles display
  - user-realtime-state.service.ts - Filter by roles array

- **RBAC Management (2 files):**
  - rbac.interfaces.ts - User interface with `roles?: string[]`
  - user-role-assignment.component.ts - Badge showing role count for multi-role users

- **Backend Multi-Role (10 files):**
  - Priority 1: Redis Permission Caching (99% DB query reduction)
  - Priority 2: Multi-role backend support (JWT with `roles[]` array)
  - Auth strategies updated for multi-role verification

- **Database Seeds:**
  - Consolidated navigation seed (003_navigation_menu.ts)
  - Merged ~90 permissions from duplicate files
  - Single source of truth for navigation + permissions

**Technical Pattern:**

```typescript
// Multi-role check pattern used everywhere
hasRole(role: string): boolean {
  return user?.role === role || user?.roles?.includes(role) || false;
}

// Backend JWT payload
{
  "role": "admin",           // Backward compatibility
  "roles": ["admin", "manager"],  // Multi-role support
  "permissions_count": 43
}
```

**Impact:**

- üéØ Users can have multiple roles simultaneously (frontend + backend)
- üîÑ 100% backward compatibility maintained
- üé® Professional UI for multi-role display (chips, badges, formatted lists)
- ‚ö° 99% DB query reduction via Redis permission caching
- üìä Clean database seeds (no more conflicts)
- ‚úÖ 0 errors - Production ready

**Commits:**

- `3786bc0` - feat(rbac): implement multi-role frontend support
- `b4b8f18` - feat(rbac): implement multi-role backend with Redis caching
- `b469477` - fix(seeds): consolidate navigation seed

### Previous Status (Session 48 - 2025-10-30) ‚úÖ COMPLETED

**Session 48 (2025-10-30) - API Endpoint Audit & Critical Bug Fixes:**

- ‚úÖ **Comprehensive API Audit** - Reviewed 139+ endpoints across 17 route modules
- ‚úÖ **Critical Bug Fixes** - Fixed 3 route ordering bugs affecting 12 endpoints
- ‚úÖ **TypeScript Fixes** - Resolved 4 type errors in navigation components
- ‚úÖ **Route Ordering Pattern** - Established mandatory pattern: static routes before parameterized routes

**Latest Development:**

- ‚úÖ **PDF Templates Module** - Fixed 9 unreachable endpoints (render, validate, search, stats, categories, types, helpers, starters, for-use)
- ‚úÖ **API Keys Module** - Fixed 3 unreachable endpoints (generate, validate, my-keys)
- ‚úÖ **Test Endpoints** - Added environment-based security protection (4 endpoints)
- ‚úÖ **Navigation Components** - Fixed Permission type handling in dialog and management components
- ‚úÖ **Testing Workflow** - Verified all fixes with curl commands, all builds passing

**Technical Achievements:**

- **Route Pattern**: Established `/:id` must come AFTER all specific routes
- **Type Safety**: Added type guards for `string | Permission` union types
- **Security**: Test endpoints now restricted to development/test environments
- **Documentation**: Created comprehensive API audit report

**Files Modified:**

- `apps/api/src/core/pdf-export/routes/pdf-template.routes.ts` - Route ordering fix
- `apps/api/src/core/api-keys/routes/index.ts` - Route ordering fix
- `apps/api/src/core/system/test-websocket.routes.ts` - Security protection
- `apps/web/src/app/core/rbac/dialogs/navigation-item-dialog/navigation-item-dialog.component.ts` - Type guard
- `apps/web/src/app/core/rbac/pages/navigation-management/navigation-management.component.ts` - Type guards (3 fixes)

**Impact:**

- üîß **12 endpoints restored** to working condition
- üõ°Ô∏è **4 test endpoints** now properly secured
- ‚úÖ **0 TypeScript errors** - all builds passing
- üìä **139+ endpoints** audited and documented

### Session 48 Continuation (2025-10-30) ‚úÖ COMPLETED

**API Keys Management System - Comprehensive Documentation:**

- ‚úÖ **Complete Documentation Package** - 4 comprehensive documents (~2,120 lines)
- ‚úÖ **README.md** (370 lines) - System overview, quick start, architecture diagram
- ‚úÖ **USER_GUIDE.md** (570 lines) - End-user guide with testing scripts and troubleshooting
- ‚úÖ **DEVELOPER_GUIDE.md** (510 lines) - Technical integration guide with code examples
- ‚úÖ **ARCHITECTURE.md** (670 lines) - System design, cache strategy, security design

**Documentation Highlights:**

- **3 Authentication Methods**: Custom header (recommended), Bearer token, Query parameter
- **Cache Strategy**: Hybrid approach (metadata cached, hash from DB)
- **Performance**: ~56ms validation (1ms cache + 5ms DB + 50ms bcrypt)
- **Key Format**: `ak_<8hex>_<64hex>` (prefix + hash + random)
- **30+ Code Examples**: JavaScript, Python, cURL, TypeScript
- **5 ASCII Diagrams**: Architecture, validation flow, cache strategy

**Technical Documentation:**

- Complete 9-step validation flow diagram
- Database schema with indexes
- Key generation algorithm explanation
- Permission system (scope-based access control)
- Security design (defense in depth, 5 layers)
- Performance characteristics and benchmarks
- Design decisions (why bcrypt, why hybrid cache)

**Files Created:**

- `docs/features/api-keys/README.md`
- `docs/features/api-keys/USER_GUIDE.md`
- `docs/features/api-keys/DEVELOPER_GUIDE.md`
- `docs/features/api-keys/ARCHITECTURE.md`

### Session 48 Continuation Part 2 (2025-10-30) ‚úÖ COMPLETED

**Web Application Review & Code Cleanup:**

- ‚úÖ **Priority 1: Route Cleanup** - Reduced app.routes.ts by 34% (218 ‚Üí 144 lines)
- ‚úÖ **Priority 2: Navigation Restructure** - Reorganized with RBAC submenu and Settings group
- ‚úÖ **Environment-Based Loading** - Dev routes only in development mode
- ‚úÖ **Permission Format Standardization** - Migrated to array-based permissions with OR logic

**Key Improvements:**

1. **Route Organization** - Removed 13 duplicate/dev routes from main routes file
2. **Navigation UX** - RBAC now a collapsible menu with 5 children (Dashboard, Roles, Permissions, User Assignments, Navigation)
3. **Settings Group** - Added new Settings group with API Keys menu (New badge)
4. **Cleaner Codebase** - 8 obsolete navigation items removed (books, authors, dev tools)
5. **Production Ready** - Dev routes excluded from production bundles

**Technical Patterns:**

```typescript
// Environment-Based Route Loading
...(environment.production ? [] : [devRoutes])

// Array-Based Permissions (OR Logic)
permissions: ['users:read', '*:*']  // User needs ANY of these

// Collapsible Navigation
type: 'collapsible'  // Changed from 'item' for RBAC
children: [/* 5 children */]
```

**Files Modified:**

- `apps/web/src/app/app.routes.ts` (218 ‚Üí 144 lines, -34%)
- `apps/web/src/app/core/navigation/services/navigation.service.ts` (208 ‚Üí 228 lines)
- `libs/aegisx-ui/src/lib/types/ax-navigation.types.ts` (+permissions array field)

**Commits Pushed:**

1. `951d503` - refactor(web): cleanup routes and add environment-based dev tools loading
2. `a634828` - refactor(web): reorganize navigation structure and add RBAC submenu
3. `1567f2e` - feat(api-keys): add API Keys Management System (Session 48)

### Previous Status (Session 47 - 2025-10-30) ‚úÖ COMPLETED

**Session 47a (2025-10-29) - Navigation Management UI + RBAC:**

- ‚úÖ **Navigation Management UI** - Full CRUD with Material table, Role Preview Mode
- ‚úÖ **RBAC Module Progress** - 45% ‚Üí 50% complete

**Session 47b (2025-10-30) - Config-Driven Attachment System:**

- ‚úÖ **Full-Stack Implementation** - Complete backend + frontend + documentation

**Latest Development:**

- ‚úÖ **Config-Driven Attachment System** - Complete full-stack implementation
- ‚úÖ **Polymorphic Attachments Table** - Single table for all entity types
- ‚úÖ **8 Pre-Configured Entities** - Inventory (4) + HIS (4) ready
- ‚úÖ **RESTful API** - 13 endpoints with OpenAPI docs
- ‚úÖ **Type-Safe Schemas** - Full TypeBox validation
- ‚úÖ **Frontend Components** - Complete with service, list, item, upload widgets
- ‚úÖ **Test Page** - Comprehensive testing interface with 8 scenarios
- ‚úÖ **Documentation** - README, DEVELOPER_GUIDE with 3 usage patterns

**Implementation Summary:**

- **Backend**: 2,048 lines (controller, service, repository, routes, schemas)
- **Frontend**: 2,445+ lines (service, components, test page)
- **Total**: ~4,500 lines of production code
- **Patterns**: Multiple files (default), Single file (maxFiles=1), Direct reference

**Quick Reference:**

```typescript
// Pattern 1: Multiple Files (Default) - Products, Patients
'product': {
  entityType: 'product',
  allowedTypes: ['image', 'manual'],
  maxFiles: 10, // Multiple files
  allowedMimeTypes: ['image/*', 'application/pdf'],
  maxFileSize: 5 * 1024 * 1024,
}

// Pattern 2: Single File - Profile Pictures
'user-profile': {
  entityType: 'user-profile',
  allowedTypes: ['profile-picture'],
  maxFiles: 1, // Single file only
  allowedMimeTypes: ['image/jpeg', 'image/png'],
  maxFileSize: 2 * 1024 * 1024,
}

// Frontend Usage (same component for all patterns)
<app-entity-attachments
  entityType="product"
  [entityId]="productId()"
  [layout]="'grid'"
/>
```

**Documentation:**

- üìñ [README.md](./docs/features/attachment-system/README.md) - Overview & quick start
- üë®‚Äçüíª [DEVELOPER_GUIDE.md](./docs/features/attachment-system/DEVELOPER_GUIDE.md) - 3 patterns with examples

**Documentation & Release:**

- ‚úÖ **Documentation Updated** - PROJECT_STATUS.md and CLAUDE.md updated with Session 46 summary (Commit: `a884692`)
- ‚úÖ **Merged to Main** - All changes merged to main branch with `--no-ff` (Merge commit: `ee448c3`)
- ‚úÖ **Release Triggered** - GitHub Actions automated release workflow started
- üìä **Merge Statistics**: 400 files changed, +38,755/-54,170 lines (Net: -15,415 lines cleaner!)
- üü¢ **Status**: Awaiting GitHub Actions to complete v1.x.x release

**Repository Status:**

- 15 core backend modules (14 + attachments system)
- 10 core frontend features (core platform only)
- Empty `apps/api/src/modules/` - Ready for HIS modules
- Empty `apps/web/src/app/features/` - Ready for HIS features
- CRUD Generator v2.1.0 verified and ready
- Clean repository ready for HIS and Inventory development

### Previous Status (Session 46 - 2025-10-28)

**Repository Cleanup:**

- ‚úÖ Theme System Removed - 9 files deleted
- ‚úÖ ALL Business Features Removed - 72 files deleted
- ‚úÖ Unused Files Cleaned - Scripts, test directories removed
- ‚úÖ Total Cleanup - 89 files deleted, 4 commits

### Previous Status (Session 44 - 2025-10-28)

**Latest Updates:**

- ‚úÖ **CRUD Generator v2.1.0** - Released with HIS Mode (data accuracy first)
- ‚úÖ **Repository Cleanup** - 143 files deleted, 58,512 lines removed
- ‚úÖ **Communication Guide** - Exact phrases for version releases documented

**Key Learning from Release Process:**

- Tags for npm packages belong in the **PACKAGE repository**, not main monorepo
- Use git subtree to sync `libs/aegisx-crud-generator/` to separate crud-generator repo
- Clear communication phrases prevent mistakes (see "CRUD Generator Version Release & NPM Publishing" section below)

## üö® CRITICAL: CRUD Generator Git Workflow

**‚ö†Ô∏è libs/aegisx-crud-generator/ is synced to separate repository**

**MANDATORY Steps After Making Changes to CRUD Generator:**

```bash
# 1. Commit changes in main monorepo
git add libs/aegisx-crud-generator/
git commit -m "docs(crud-generator): update documentation"

# 2. ‚ö†Ô∏è CRITICAL: Sync to separate crud-generator repository
./libs/aegisx-crud-generator/sync-to-repo.sh develop

# 3. Push main monorepo
git push origin develop

# 4. (Optional) Publish to NPM if package.json version changed
cd libs/aegisx-crud-generator
npm publish
```

**Git Subtree Commands:**

```bash
# Sync to separate repository (most common)
./libs/aegisx-crud-generator/sync-to-repo.sh develop

# Manual sync (if script unavailable)
git subtree push --prefix=libs/aegisx-crud-generator \
  git@github.com:aegisx-platform/crud-generator.git develop

# Pull updates from separate repository (rare)
git subtree pull --prefix=libs/aegisx-crud-generator \
  git@github.com:aegisx-platform/crud-generator.git develop --squash
```

**‚ö†Ô∏è DO NOT FORGET** the git subtree push or changes won't appear in the separate crud-generator repository!

**Why This Matters:**

- `libs/aegisx-crud-generator/` is published as standalone NPM package
- Separate repository: https://github.com/aegisx-platform/crud-generator
- Main monorepo is source of truth, must sync to separate repo
- NPM package is built from separate repository

## üö® CRITICAL: CRUD Generator Version Release & NPM Publishing

**‚ö†Ô∏è NEVER create version tags in main aegisx-starter repository!**

**Tags MUST be created ONLY in the separate crud-generator repository**

### üì¶ How to Communicate with Claude

**Use these EXACT phrases to avoid confusion:**

| What You Want    | Say This to Claude                      | What Claude Will Do                                                                      |
| ---------------- | --------------------------------------- | ---------------------------------------------------------------------------------------- |
| **Version Bump** | "‡∏≠‡∏≠‡∏Å version CRUD generator ‡πÄ‡∏õ‡πá‡∏ô X.X.X" | 1. Bump package.json version<br>2. Commit in main repo<br>3. Sync to crud-generator repo |
| **Tag Creation** | "‡∏™‡∏£‡πâ‡∏≤‡∏á tag CRUD generator vX.X.X"       | Create tag in **crud-generator repo only** (NOT main repo)                               |
| **NPM Publish**  | "publish CRUD generator ‡πÑ‡∏õ npm"         | User provides OTP, Claude runs publish.sh                                                |
| **Full Release** | "release CRUD generator vX.X.X"         | Complete workflow: bump ‚Üí commit ‚Üí sync ‚Üí tag ‚Üí npm publish                              |
| **Sync Only**    | "sync CRUD generator"                   | Git subtree push to crud-generator repo                                                  |

### üîÑ Complete Release Workflow

**When you say: "release CRUD generator v2.1.0"**

```bash
# Step 1: Version Bump & Commit (in main repo)
cd libs/aegisx-crud-generator
# Edit package.json: "version": "2.1.0"
git add .
git commit -m "chore(crud-generator): bump version to 2.1.0"
git push origin develop

# Step 2: Sync to Separate Repository
cd /path/to/main/repo
./libs/aegisx-crud-generator/sync-to-repo.sh develop
# OR manual:
# git subtree push --prefix=libs/aegisx-crud-generator \
#   git@github.com:aegisx-platform/crud-generator.git develop

# Step 3: Create Tag in CRUD Generator Repo (NOT main repo!)
git push git@github.com:aegisx-platform/crud-generator.git \
  <commit-hash>:refs/tags/v2.1.0

# Step 4: Publish to NPM (user provides OTP)
cd libs/aegisx-crud-generator
./publish.sh <OTP-CODE>
```

### ‚ö†Ô∏è CRITICAL RULES

**DO:**

- ‚úÖ Create tags in **crud-generator repository** (`git@github.com:aegisx-platform/crud-generator.git`)
- ‚úÖ Always sync to separate repo before creating tags
- ‚úÖ Wait for user to provide OTP before npm publish
- ‚úÖ Use semantic versioning (major.minor.patch)

**DON'T:**

- ‚ùå NEVER create version tags in main aegisx-starter repository
- ‚ùå NEVER create tags before syncing to separate repo
- ‚ùå NEVER publish without user's explicit OTP code
- ‚ùå NEVER skip git subtree sync step

### üéØ Why This Architecture?

```
Main Monorepo (aegisx-starter)
‚îî‚îÄ‚îÄ libs/aegisx-crud-generator/
    ‚îÇ
    ‚îú‚îÄ git subtree push ‚îÄ‚îÄ‚Üí Separate Repo (crud-generator)
    ‚îÇ                       ‚îî‚îÄ‚îÄ NPM Package Source
    ‚îÇ                           ‚îú‚îÄ‚îÄ Tags (v2.1.0, v2.0.1, etc.)
    ‚îÇ                           ‚îî‚îÄ‚îÄ npm publish ‚Üí registry.npmjs.org
    ‚îÇ
    ‚îî‚îÄ ‚ùå NO TAGS HERE! Tags belong in separate repo only
```

**Benefits:**

1. Main repo stays clean (no package-specific tags)
2. NPM package has its own version history
3. Separation of concerns: monorepo vs. published package
4. Easy to manage multiple packages in future

### üìã Quick Reference Examples

**Example 1: Full Release**

```
User: "‡∏≠‡∏≠‡∏Å version CRUD generator 2.1.0 ‡πÅ‡∏•‡πâ‡∏ß publish"
Claude:
1. ‚úÖ Bump package.json to 2.1.0
2. ‚úÖ Commit to main repo
3. ‚úÖ Sync to crud-generator repo
4. ‚úÖ Create tag v2.1.0 in crud-generator repo
5. ‚è∏Ô∏è Wait for user OTP
User: "OTP: 123456"
Claude: ‚úÖ Publish to npm
```

**Example 2: Sync Only**

```
User: "sync CRUD generator"
Claude: ‚úÖ Git subtree push to crud-generator repo
```

**Example 3: Tag Only**

```
User: "‡∏™‡∏£‡πâ‡∏≤‡∏á tag v2.1.0 ‡πÉ‡∏´‡πâ CRUD generator"
Claude: ‚úÖ Create tag in crud-generator repo (NOT main repo)
```

## ü§ñ CRUD Generator Quick Commands

### Basic Generation

```bash
# Generate basic CRUD (no import, no events)
pnpm aegisx-crud books --package

# Generate with import functionality
pnpm aegisx-crud budgets --package --with-import

# Generate with WebSocket events
pnpm aegisx-crud notifications --package --with-events

# Generate with both import and events
pnpm aegisx-crud products --package --with-import --with-events
```

### Advanced Options

```bash
# Dry run (preview without creating files)
pnpm aegisx-crud articles --package --dry-run

# Force overwrite existing files
pnpm aegisx-crud users --package --force

# Combine all flags
pnpm aegisx-crud inventory --package --with-import --with-events --force
```

### Common Workflows

**1. New Feature with Import:**

```bash
# Generate CRUD with import dialog
pnpm aegisx-crud budgets --package --with-import

# Files created:
# - Backend: controller, service, repository, routes, schemas, tests
# - Frontend: list, create/edit/view dialogs, import dialog, service, types
# - Database: Migration file
```

**2. Real-Time Feature with Events:**

```bash
# Generate CRUD with WebSocket events
pnpm aegisx-crud notifications --package --with-events

# Backend includes:
# - EventService integration
# - Event emission on create/update/delete
# - Bulk operation events (bulk_started, bulk_progress, bulk_completed)
```

**3. Regenerate Existing Feature:**

```bash
# Review changes first
pnpm aegisx-crud books --package --dry-run

# Force regenerate if satisfied
pnpm aegisx-crud books --package --force
```

### Flag Reference

| Flag            | Description                                | Use Case                          |
| --------------- | ------------------------------------------ | --------------------------------- |
| `--package`     | Use `.crudgen.json` config                 | ‚úÖ ALWAYS use this flag           |
| `--with-import` | Add import dialog + backend import service | Bulk data import features         |
| `--with-events` | Add WebSocket real-time events             | Live updates, notifications       |
| `--dry-run`     | Preview changes without creating files     | Review before generation          |
| `--force`       | Overwrite existing files                   | Regenerate after template updates |

**üìö Complete Documentation:** See `docs/crud-generator/` for comprehensive guides

### CI/CD & DevOps

- **[üîÑ Git Flow & Release](./docs/infrastructure/git-flow-release-guide.md)** - Branch strategy & release process
- **[üì¶ Automated Versioning](./docs/infrastructure/automated-versioning-guide.md)** - Conventional commits & changelog
- **[üê≥ Monorepo Docker Guide](./docs/infrastructure/monorepo-docker-guide.md)** - Docker management for monorepo
- **[üöÄ CI/CD Quick Start](./docs/infrastructure/quick-start-cicd.md)** - GitHub Actions setup & usage
- **[üìö CI/CD Complete Setup](./docs/infrastructure/ci-cd-setup.md)** - Detailed CI/CD documentation

## üõ†Ô∏è Technology Stack

- **Frontend**: Angular 19+ with Signals, Angular Material + TailwindCSS
- **Backend**: Fastify 4+ with TypeScript
- **Database**: PostgreSQL 15+ with Knex.js
- **Monorepo**: Nx with Yarn workspaces
- **Testing**: Jest + Playwright + MCP
- **Infrastructure**: Docker + GitHub Actions + GitHub Container Registry

## üèÉ‚Äç‚ôÇÔ∏è Quick Start Commands

```bash
# Install dependencies (‚ö†Ô∏è USE PNPM, NOT NPM OR YARN!)
pnpm install

# Set up environment
cp .env.example .env

# Start databases
pnpm run docker:up

# Run migrations
npm run db:migrate

# Seed database
npm run db:seed

# Start development
nx run-many --target=serve --projects=api,web
```

## üìã Most Used Commands

| Command       | Description                      | Actual Command                                  |
| ------------- | -------------------------------- | ----------------------------------------------- |
| **Install**   | Install dependencies (USE PNPM!) | `pnpm install`                                  |
| **DB Setup**  | Run migrations & seeds           | `pnpm db:migrate && pnpm db:seed`               |
| **Develop**   | Start dev servers                | `nx run-many --target=serve --projects=api,web` |
| **Test**      | Run all tests                    | `nx run-many --target=test --all`               |
| **E2E**       | Run E2E tests                    | `nx e2e e2e`                                    |
| **Build**     | Build for production             | `nx run-many --target=build --all`              |
| **Docker**    | Start services                   | `pnpm run docker:up`                            |
| **Docker PS** | Show current instance containers | `pnpm run docker:ps`                            |

## üöÄ Feature Development Commands

| Command       | Description              | Actual Command                                              |
| ------------- | ------------------------ | ----------------------------------------------------------- |
| **Start**     | Start new feature        | `./scripts/feature-toolkit.sh start [name] [priority]`      |
| **Status**    | Check feature progress   | `./scripts/feature-toolkit.sh status [name]`                |
| **Progress**  | Update feature progress  | `./scripts/feature-toolkit.sh progress [name] "[task]" [%]` |
| **Complete**  | Mark feature complete    | `./scripts/feature-toolkit.sh complete [name]`              |
| **Dashboard** | Show all features        | `./scripts/feature-toolkit.sh dashboard`                    |
| **Conflicts** | Check resource conflicts | `./scripts/feature-toolkit.sh conflicts [name]`             |

## üê≥ Multi-Instance Docker Commands

| Command    | Description                   | Actual Command          |
| ---------- | ----------------------------- | ----------------------- |
| **Up**     | Start instance services       | `pnpm run docker:up`    |
| **Down**   | Stop instance services        | `pnpm run docker:down`  |
| **Status** | Show instance containers      | `pnpm run docker:ps`    |
| **Reset**  | Reset instance (down+up+data) | `pnpm run docker:reset` |

### Quick Aliases (add to ~/.bashrc or ~/.zshrc)

```bash
source .feature-aliases  # Load feature command shortcuts
# Then use: fs, fstat, fprog, fcomp, fdash
```

## üöÄ Project Structure

```
aegisx-starter/
‚îú‚îÄ‚îÄ apps/                      # Applications
‚îÇ   ‚îú‚îÄ‚îÄ api/                   # ‚úÖ Fastify backend
‚îÇ   ‚îú‚îÄ‚îÄ web/                   # ‚úÖ Angular web app
‚îÇ   ‚îî‚îÄ‚îÄ admin/                 # ‚úÖ Angular admin panel
‚îú‚îÄ‚îÄ docs/                      # ‚úÖ Complete documentation
‚îÇ   ‚îú‚îÄ‚îÄ 01-feature-tracking.md
‚îÇ   ‚îú‚îÄ‚îÄ 02-quick-commands.md
‚îÇ   ‚îú‚îÄ‚îÄ 04a-api-first-workflow.md
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ docker-compose.yml         # ‚úÖ Development environment
‚îú‚îÄ‚îÄ package.json               # ‚úÖ NPM scripts
‚îî‚îÄ‚îÄ nx.json                    # ‚úÖ Nx configuration
```

## üéØ Development Philosophy

1. **API-First**: Design OpenAPI spec before implementation (See [API-First Workflow Guide](./docs/04a-api-first-workflow.md))
2. **Feature Modules**: Organized, testable, maintainable code
3. **E2E Testing**: Visual verification with Playwright MCP
4. **Progress Tracking**: Always maintain development status
5. **Quality Gates**: Unit ‚Üí Integration ‚Üí E2E ‚Üí Visual tests
6. **Signals-First**: Angular state management with Signals
7. **Type Safety**: Full TypeScript with strict mode
8. **Contract-Driven**: Frontend and Backend develop from same spec
9. **Alignment Checks**: Continuous validation of frontend-backend compatibility

---

_For complete documentation, see individual files in the `docs/` directory._
