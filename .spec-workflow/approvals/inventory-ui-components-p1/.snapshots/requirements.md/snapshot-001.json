{
  "id": "snapshot_1766063478356_dc9xskncc",
  "approvalId": "approval_1766063478202_9t3l9obz8",
  "approvalTitle": "Requirements Document - Inventory UI Components (Priority 1)",
  "version": 1,
  "timestamp": "2025-12-18T13:11:18.356Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Requirements Document - Inventory UI Components (Priority 1)\n\n## Introduction\n\nThis specification defines the first priority UI components for the Inventory Management System in AegisX UI library. These four essential components form the foundation for efficient inventory operations: **Stock Level Indicator**, **Barcode Scanner**, **Quantity Input with Unit Conversion**, and **Batch/Lot Number Selector**.\n\nThese components address critical pain points in inventory management:\n- **Visual stock monitoring** - Instant recognition of stock levels without reading numbers\n- **Fast data entry** - Barcode scanning eliminates manual typing errors\n- **Unit flexibility** - Automatic conversion between measurement units\n- **Traceability** - Batch/lot tracking for expiry dates and recall management\n\n**Value Proposition:** Reduce inventory transaction time by 60%, eliminate data entry errors, and ensure 100% product traceability compliance.\n\n## Alignment with Product Vision\n\nThese components align with AegisX Platform's goals:\n\n**From product.md:**\n- **Efficiency First**: Reduce transaction time with barcode scanning and visual indicators\n- **Error Prevention**: Unit conversion and batch selection prevent common mistakes\n- **Enterprise Ready**: Production-grade components with accessibility and TypeScript safety\n- **User-Centric Design**: Intuitive visual feedback and mobile-responsive interfaces\n\n**Technical Alignment:**\n- Built as standalone Angular components in `libs/aegisx-ui`\n- Follow existing AegisX UI patterns (Material Design, signals, TypeScript strict mode)\n- Integrate seamlessly with CRUD-generated inventory forms\n- Support both web and mobile (touch-friendly)\n\n---\n\n## Requirements\n\n### Requirement 1: Stock Level Visual Indicator\n\n**User Story:** As an inventory manager, I want to see stock levels visually with color-coded warnings, so that I can quickly identify which products need attention without reading numbers.\n\n#### Acceptance Criteria\n\n1. **WHEN** stock level is above 75% of maximum **THEN** system SHALL display green indicator\n2. **WHEN** stock level is between 25-75% of maximum **THEN** system SHALL display yellow indicator\n3. **WHEN** stock level is below 25% of maximum **THEN** system SHALL display red indicator\n4. **WHEN** stock level reaches minimum threshold **THEN** system SHALL display critical warning badge\n5. **WHEN** user hovers over indicator **THEN** system SHALL show tooltip with exact quantities (current/min/max)\n6. **IF** stock level is zero **THEN** system SHALL display \"Out of Stock\" badge with gray color\n7. **WHEN** component renders **THEN** system SHALL support multiple units (pieces, boxes, kg, liters)\n8. **WHEN** used in mobile view **THEN** system SHALL maintain visibility with responsive sizing\n9. **WHEN** stock data updates **THEN** system SHALL animate transition between colors smoothly\n\n#### Component Specifications\n\n**Component Name:** `ax-stock-level`\n\n**Inputs:**\n- `current: number` - Current stock quantity (required)\n- `minimum: number` - Minimum threshold for warning (required)\n- `maximum: number` - Maximum capacity (required)\n- `unit: string` - Display unit (default: 'pieces')\n- `size: 'sm' | 'md' | 'lg'` - Component size (default: 'md')\n- `showLabel: boolean` - Show text label (default: true)\n- `showPercentage: boolean` - Show percentage value (default: true)\n- `colorScheme: 'traffic-light' | 'gradient'` - Color style (default: 'traffic-light')\n\n**Outputs:**\n- `onWarningClick: EventEmitter<{level: string, current: number}>` - Emitted when warning badge clicked\n\n**Visual Requirements:**\n- Progress bar with segmented zones (green/yellow/red)\n- Badge overlay for critical states\n- Smooth animations (300ms transition)\n- Accessible with ARIA labels\n\n---\n\n### Requirement 2: Barcode Scanner Component\n\n**User Story:** As a warehouse operator, I want to scan product barcodes using my device camera or manually enter codes, so that I can quickly identify products during receiving and issuing operations.\n\n#### Acceptance Criteria\n\n1. **WHEN** component initializes **THEN** system SHALL request camera permission if mode is 'camera'\n2. **WHEN** user grants camera permission **THEN** system SHALL activate camera with auto-focus\n3. **WHEN** barcode is detected in camera view **THEN** system SHALL emit scan event within 500ms\n4. **WHEN** scan is successful **THEN** system SHALL play beep sound and show visual confirmation\n5. **IF** camera permission denied **THEN** system SHALL fallback to manual input mode automatically\n6. **WHEN** user switches to manual mode **THEN** system SHALL show input field with validation\n7. **WHEN** invalid barcode detected **THEN** system SHALL show error message and allow retry\n8. **WHEN** scanning **THEN** system SHALL support multiple formats: QR Code, EAN-13, Code 128, Code 39\n9. **WHEN** scan occurs **THEN** system SHALL store last 10 scans in session history\n10. **IF** continuous scan mode enabled **THEN** system SHALL automatically scan next barcode after 1s delay\n11. **WHEN** used in low light **THEN** system SHALL activate flashlight toggle button\n12. **WHEN** component unmounts **THEN** system SHALL release camera resources properly\n\n#### Component Specifications\n\n**Component Name:** `ax-barcode-scanner`\n\n**Inputs:**\n- `mode: 'camera' | 'manual' | 'auto'` - Scan mode (default: 'auto' - tries camera, fallback to manual)\n- `formats: BarcodeFormat[]` - Supported barcode formats (default: ['qr', 'ean13', 'code128'])\n- `continuousScan: boolean` - Enable continuous scanning (default: false)\n- `beepSound: boolean` - Play sound on scan (default: true)\n- `showHistory: boolean` - Show recent scans (default: false)\n- `placeholder: string` - Manual input placeholder (default: 'Enter barcode...')\n\n**Outputs:**\n- `onScan: EventEmitter<ScanResult>` - Emitted when barcode scanned successfully\n- `onError: EventEmitter<ScanError>` - Emitted when scan fails\n- `onModeChange: EventEmitter<'camera' | 'manual'>` - Emitted when mode changes\n\n**Types:**\n```typescript\ninterface ScanResult {\n  code: string;\n  format: BarcodeFormat;\n  timestamp: Date;\n  mode: 'camera' | 'manual';\n}\n\ninterface ScanError {\n  type: 'permission-denied' | 'invalid-format' | 'camera-error' | 'timeout';\n  message: string;\n}\n\ntype BarcodeFormat = 'qr' | 'ean13' | 'ean8' | 'code128' | 'code39' | 'datamatrix';\n```\n\n**Technical Requirements:**\n- Use ZXing or QuaggaJS library for barcode scanning\n- Lazy load scanner library (code-splitting)\n- Support both front and rear cameras\n- Handle browser compatibility gracefully\n\n---\n\n### Requirement 3: Quantity Input with Unit Conversion\n\n**User Story:** As a warehouse staff, I want to enter quantities in different units (boxes, pieces, kg) with automatic conversion, so that I can work with the unit most convenient for the situation without mental math.\n\n#### Acceptance Criteria\n\n1. **WHEN** component renders **THEN** system SHALL display input field with unit selector dropdown\n2. **WHEN** user changes unit **THEN** system SHALL automatically convert quantity to selected unit\n3. **WHEN** user clicks + button **THEN** system SHALL increment by step size (1 for pieces, 0.1 for kg)\n4. **WHEN** user clicks - button **THEN** system SHALL decrement by step size (cannot go below min)\n5. **IF** user enters value below minimum **THEN** system SHALL show validation error and prevent submission\n6. **IF** user enters value above maximum **THEN** system SHALL show validation error and prevent submission\n7. **WHEN** user types decimal number **THEN** system SHALL validate decimal places (2 for currency, 3 for weight)\n8. **WHEN** base unit is 'pieces' **THEN** system SHALL only allow integer values\n9. **WHEN** user selects 'box' unit and conversion rate is 12 **THEN** system SHALL display \"(12 pieces per box)\"\n10. **WHEN** value changes **THEN** system SHALL emit event with converted value in base unit\n11. **WHEN** quick preset button clicked (x10, x100) **THEN** system SHALL multiply current value\n12. **WHEN** used in form **THEN** system SHALL integrate with Angular Reactive Forms\n\n#### Component Specifications\n\n**Component Name:** `ax-quantity-input`\n\n**Inputs:**\n- `value: number` - Current quantity value (two-way binding with ngModel)\n- `baseUnit: string` - Base unit for storage (required)\n- `availableUnits: UnitConfig[]` - Available units with conversion rates (required)\n- `min: number` - Minimum value (default: 0)\n- `max: number` - Maximum value (default: Infinity)\n- `step: number` - Increment/decrement step (default: 1)\n- `showStepper: boolean` - Show +/- buttons (default: true)\n- `showPresets: boolean` - Show x10, x100 buttons (default: false)\n- `decimalPlaces: number` - Decimal precision (default: 0)\n- `disabled: boolean` - Disable input (default: false)\n\n**Outputs:**\n- `valueChange: EventEmitter<number>` - Emitted when value changes (in base unit)\n- `unitChange: EventEmitter<string>` - Emitted when unit changes\n- `onValidation: EventEmitter<ValidationState>` - Emitted on validation change\n\n**Types:**\n```typescript\ninterface UnitConfig {\n  code: string;              // 'box', 'piece', 'kg', 'g'\n  label: string;             // 'Box', 'Piece', 'Kilogram'\n  conversionRate: number;    // Multiplier to convert to base unit\n  decimalPlaces: number;     // Allowed decimal places\n  symbol?: string;           // Unit symbol for display\n}\n\ninterface ValidationState {\n  valid: boolean;\n  errors: ValidationError[];\n}\n\ninterface ValidationError {\n  type: 'min' | 'max' | 'decimal' | 'integer';\n  message: string;\n}\n```\n\n**Visual Requirements:**\n- Input field with unit dropdown on right\n- Stepper buttons (+ / -) on left\n- Conversion hint below input (\"= 144 pieces\")\n- Validation error messages\n- Disabled state styling\n\n---\n\n### Requirement 4: Batch/Lot Number Selector\n\n**User Story:** As a quality control officer, I want to select batch/lot numbers with visibility of expiry dates and available quantities, so that I can ensure FIFO/FEFO compliance and prevent use of expired products.\n\n#### Acceptance Criteria\n\n1. **WHEN** component loads **THEN** system SHALL fetch available batches for selected product from API\n2. **WHEN** batches load **THEN** system SHALL sort by strategy (FIFO: oldest first, FEFO: earliest expiry first)\n3. **WHEN** batch list displays **THEN** system SHALL show: batch number, expiry date, available quantity, manufacturing date\n4. **WHEN** batch expiry is within 30 days **THEN** system SHALL show yellow warning badge\n5. **WHEN** batch expiry is within 7 days **THEN** system SHALL show red critical badge\n6. **WHEN** batch is expired **THEN** system SHALL show gray \"EXPIRED\" badge and disable selection\n7. **WHEN** user selects batch **THEN** system SHALL emit batch details including all metadata\n8. **IF** allowMultiple is true **THEN** system SHALL allow selecting multiple batches with quantity per batch\n9. **WHEN** multiple batches selected **THEN** system SHALL validate total quantity <= requested quantity\n10. **WHEN** user types batch number **THEN** system SHALL filter list with autocomplete\n11. **WHEN** no batches available **THEN** system SHALL show \"No batches available\" message\n12. **IF** showRecommendation is true **THEN** system SHALL highlight recommended batch based on strategy\n13. **WHEN** batch selected **THEN** system SHALL show confirmation with expiry countdown\n\n#### Component Specifications\n\n**Component Name:** `ax-batch-selector`\n\n**Inputs:**\n- `productId: string` - Product to get batches for (required)\n- `batches: BatchInfo[]` - Available batches (if not using API)\n- `strategy: 'fifo' | 'fefo' | 'lifo'` - Selection strategy (default: 'fefo')\n- `allowMultiple: boolean` - Allow multiple batch selection (default: false)\n- `requestedQuantity: number` - Quantity needed (for multi-batch split)\n- `showExpiry: boolean` - Show expiry date (default: true)\n- `showManufacturing: boolean` - Show manufacturing date (default: false)\n- `showRecommendation: boolean` - Highlight recommended batch (default: true)\n- `expiryWarningDays: number` - Days before expiry to show warning (default: 30)\n- `expiryCriticalDays: number` - Days before expiry to show critical (default: 7)\n\n**Outputs:**\n- `onSelect: EventEmitter<BatchSelection>` - Emitted when batch(es) selected\n- `onBatchesLoad: EventEmitter<BatchInfo[]>` - Emitted when batches loaded\n- `onError: EventEmitter<string>` - Emitted on load/validation error\n\n**Types:**\n```typescript\ninterface BatchInfo {\n  batchNumber: string;\n  lotNumber?: string;\n  expiryDate: Date;\n  manufacturingDate?: Date;\n  availableQuantity: number;\n  unit: string;\n  location?: string;\n  status: 'available' | 'reserved' | 'expired' | 'quarantine';\n  metadata?: Record<string, unknown>;\n}\n\ninterface BatchSelection {\n  batches: SelectedBatch[];\n  totalQuantity: number;\n  strategy: 'fifo' | 'fefo' | 'lifo';\n}\n\ninterface SelectedBatch {\n  batch: BatchInfo;\n  quantity: number;\n}\n```\n\n**API Requirements:**\n- GET `/api/inventory/products/:productId/batches` - Fetch available batches\n- Query params: `?status=available&location=WAREHOUSE-01`\n- Response: `{ batches: BatchInfo[], strategy: string }`\n\n**Visual Requirements:**\n- List view with cards for each batch\n- Expiry badge with color coding\n- Quantity available display\n- Checkbox/radio for selection\n- Recommended badge (star icon)\n- Search/filter input\n- Empty state message\n\n---\n\n## Non-Functional Requirements\n\n### Code Architecture and Modularity\n\n- **Single Responsibility Principle**: Each component has one clear purpose\n- **Standalone Components**: Use Angular standalone architecture (no NgModule)\n- **Type Safety**: TypeScript strict mode, explicit types for all inputs/outputs\n- **Component Isolation**: No dependencies between P1 components\n- **Shared Utilities**: Extract common logic (date formatting, unit conversion) to separate utilities\n\n### Performance\n\n- **Initial Load**: Components should render within 100ms\n- **Barcode Scan**: Detection within 500ms in good lighting\n- **Unit Conversion**: Instant calculation (<16ms, one frame)\n- **Batch Loading**: Display skeleton loader, render results within 300ms\n- **Bundle Size**: Each component <20KB gzipped (lazy-loadable)\n- **Memory**: Clean up camera resources, prevent memory leaks\n\n### Security\n\n- **Input Validation**: Sanitize all user inputs (barcode strings, quantities)\n- **API Security**: Use authentication headers for batch API calls\n- **Camera Permission**: Handle permission denial gracefully\n- **XSS Prevention**: Escape all user-entered text in displays\n- **CSRF Protection**: Include CSRF tokens in batch fetch requests\n\n### Reliability\n\n- **Error Handling**: All errors caught and displayed with helpful messages\n- **Fallback Modes**: Camera → Manual fallback for barcode scanner\n- **Offline Support**: Cache last-used unit conversions\n- **API Retry**: Retry failed batch fetches with exponential backoff (3 attempts)\n- **Data Validation**: Prevent invalid states (negative quantities, expired batch selection)\n\n### Usability\n\n- **Accessibility**: WCAG 2.1 AA compliance\n  - Keyboard navigation for all interactions\n  - ARIA labels for screen readers\n  - Color contrast ratio ≥4.5:1\n  - Focus indicators visible\n- **Mobile Responsive**: Touch-friendly targets (44px minimum)\n- **Visual Feedback**: Loading states, success/error messages, animations\n- **Consistent Design**: Follow AegisX UI design tokens and patterns\n- **Multi-language**: Support i18n for labels and messages (Thai, English)\n- **Dark Mode**: Support both light and dark themes\n\n### Browser Support\n\n- **Desktop**: Chrome 90+, Firefox 88+, Safari 14+, Edge 90+\n- **Mobile**: iOS Safari 14+, Chrome Mobile 90+\n- **Camera API**: Fallback to manual input if MediaDevices API unavailable\n\n---\n\n## Success Metrics\n\n**Adoption:**\n- 80% of inventory transactions use barcode scanner within 1 month\n- Stock level indicators used in all product list views\n\n**Efficiency:**\n- 60% reduction in transaction time (5 min → 2 min average)\n- 95% reduction in quantity entry errors (unit conversion)\n- Zero expired product issues (batch selector compliance)\n\n**Technical:**\n- <100ms component render time\n- <500ms barcode detection\n- 100% TypeScript type coverage\n- 0 critical accessibility violations\n\n---\n\n## Out of Scope\n\n**Not included in Priority 1:**\n- Stock movement timeline (Priority 2)\n- Location/warehouse picker (Priority 2)\n- Multi-location stock view (Priority 3)\n- Stock valuation calculations (Priority 3)\n- Inventory transfer wizard (Priority 2)\n- Product variant selector (Priority 2)\n- Stock alert panel widget (Priority 2)\n\n**Future Enhancements:**\n- Bluetooth barcode scanner support\n- Voice input for quantity\n- AI-powered batch recommendations\n- Integration with weighing scales\n- Augmented reality for stock visualization\n\n---\n\n## Dependencies\n\n**External Libraries:**\n- ZXing or QuaggaJS for barcode scanning\n- Angular Material components (already in project)\n- RxJS for reactive patterns (already in project)\n\n**Internal Dependencies:**\n- AegisX UI theme system\n- Shared utility functions (date formatting, number formatting)\n- Backend API endpoints for batch data\n\n**Browser APIs:**\n- MediaDevices API (camera access)\n- Web Audio API (beep sound)\n- localStorage (scan history, unit preferences)\n\n---\n\n## Glossary\n\n- **FIFO** (First-In, First-Out): Inventory strategy using oldest stock first\n- **FEFO** (First-Expired, First-Out): Inventory strategy using nearest-expiry stock first\n- **LIFO** (Last-In, First-Out): Inventory strategy using newest stock first\n- **Batch Number**: Unique identifier for production batch\n- **Lot Number**: Alternative term for batch number (often same)\n- **Base Unit**: Standard unit for internal storage (e.g., pieces)\n- **Conversion Rate**: Multiplier to convert between units (e.g., 1 box = 12 pieces)\n- **SKU** (Stock Keeping Unit): Unique product identifier\n\n---\n\n*Requirements Version: 1.0*\n*Last Updated: 2025-12-18*\n*Status: Awaiting Approval*\n",
  "fileStats": {
    "size": 17915,
    "lines": 420,
    "lastModified": "2025-12-18T13:09:32.732Z"
  },
  "comments": []
}
