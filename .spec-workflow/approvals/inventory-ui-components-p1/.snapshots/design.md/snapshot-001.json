{
  "id": "snapshot_1766075012334_oz8wdup9n",
  "approvalId": "approval_1766075012281_ahlcswdcd",
  "approvalTitle": "Design Document - Inventory UI Components (Priority 1)",
  "version": 1,
  "timestamp": "2025-12-18T16:23:32.334Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Design Document - Inventory UI Components (Priority 1)\n\n## Introduction\n\nThis design document details the UI/UX, component architecture, and technical implementation for the four Priority 1 inventory components: **Stock Level Indicator**, **Barcode Scanner**, **Quantity Input with Unit Conversion**, and **Batch/Lot Number Selector**.\n\nThese components follow AegisX UI design principles:\n- Material Design 3 guidelines\n- Angular standalone component architecture\n- Signal-based reactive patterns\n- TypeScript strict mode with comprehensive type safety\n- WCAG 2.1 AA accessibility compliance\n\n---\n\n## 1. Stock Level Indicator (`ax-stock-level`)\n\n### 1.1 Visual Design\n\n#### Layout Structure\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Stock Level: 150 / 500 pieces (30%)            â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ â–“â–“â–“â–“â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â”‚\nâ”‚ â””â”€min (50)                                      â”‚\nâ”‚ âš ï¸ Low Stock                                    â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n#### Color Scheme\n- **Green zone (75-100%)**: `bg-success-500` with `text-success-900`\n- **Yellow zone (25-75%)**: `bg-warning-500` with `text-warning-900`\n- **Red zone (0-25%)**: `bg-error-500` with `text-error-900`\n- **Out of stock**: `bg-neutral-300` with `text-neutral-600`\n- **Progress bar background**: `bg-neutral-200` (light), `bg-neutral-700` (dark)\n\n#### Typography\n- **Label**: `text-sm font-medium text-secondary`\n- **Values**: `text-base font-semibold text-primary`\n- **Percentage**: `text-xs text-subtle`\n- **Warning badge**: `text-xs font-bold`\n\n#### Spacing\n- Container padding: `p-3` (12px)\n- Progress bar height:\n  - `sm`: 8px\n  - `md`: 12px\n  - `lg`: 16px\n- Gap between elements: `gap-2` (8px)\n- Badge margin: `mt-2`\n\n#### Responsive Behavior\n- **Mobile (<640px)**: Single column, full width, label above progress bar\n- **Tablet (640-1024px)**: Two columns if in grid layout\n- **Desktop (>1024px)**: Compact horizontal layout\n\n### 1.2 Component Architecture\n\n#### Component Structure\n```typescript\nAxStockLevelComponent\nâ”œâ”€â”€ Template\nâ”‚   â”œâ”€â”€ Label section (optional, *ngIf=\"showLabel\")\nâ”‚   â”‚   â”œâ”€â”€ Current/Max display\nâ”‚   â”‚   â””â”€â”€ Percentage display (optional)\nâ”‚   â”œâ”€â”€ Progress bar section\nâ”‚   â”‚   â”œâ”€â”€ Background bar (full width)\nâ”‚   â”‚   â”œâ”€â”€ Fill bar (percentage width with color)\nâ”‚   â”‚   â””â”€â”€ Threshold markers (min/max indicators)\nâ”‚   â””â”€â”€ Warning badge section (*ngIf=\"isWarning\")\nâ”‚       â””â”€â”€ Badge with warning icon + text\nâ””â”€â”€ State (Signals)\n    â”œâ”€â”€ percentage (computed)\n    â”œâ”€â”€ colorClass (computed)\n    â”œâ”€â”€ isWarning (computed)\n    â””â”€â”€ tooltipText (computed)\n```\n\n#### State Management (Signals)\n```typescript\n// Inputs as signals\ncurrent = input.required<number>();\nminimum = input.required<number>();\nmaximum = input.required<number>();\nunit = input<string>('pieces');\nsize = input<'sm' | 'md' | 'lg'>('md');\nshowLabel = input<boolean>(true);\nshowPercentage = input<boolean>(true);\ncolorScheme = input<'traffic-light' | 'gradient'>('traffic-light');\n\n// Computed signals\npercentage = computed(() => {\n  const max = this.maximum();\n  const curr = this.current();\n  return max > 0 ? Math.round((curr / max) * 100) : 0;\n});\n\ncolorClass = computed(() => {\n  const pct = this.percentage();\n  if (this.colorScheme() === 'traffic-light') {\n    if (pct >= 75) return 'bg-success-500';\n    if (pct >= 25) return 'bg-warning-500';\n    return 'bg-error-500';\n  } else {\n    // Gradient mode: smooth transition\n    return `bg-gradient-to-r from-error-500 via-warning-500 to-success-500`;\n  }\n});\n\nisWarning = computed(() => {\n  return this.current() <= this.minimum();\n});\n\ntooltipText = computed(() => {\n  const curr = this.current();\n  const min = this.minimum();\n  const max = this.maximum();\n  const unit = this.unit();\n  return `Current: ${curr} ${unit}\\nMinimum: ${min} ${unit}\\nMaximum: ${max} ${unit}`;\n});\n```\n\n#### Accessibility Features\n- **ARIA attributes**:\n  ```html\n  <div role=\"progressbar\"\n       [attr.aria-valuenow]=\"current()\"\n       [attr.aria-valuemin]=\"0\"\n       [attr.aria-valuemax]=\"maximum()\"\n       [attr.aria-label]=\"'Stock level: ' + percentage() + '%'\">\n  ```\n- **Screen reader text**: Hidden text describing the stock status\n- **Keyboard navigation**: Not applicable (display-only component)\n- **Color contrast**: All color combinations meet WCAG AA (4.5:1 minimum)\n- **Tooltips**: Accessible via keyboard hover with `matTooltip`\n\n### 1.3 Technical Implementation\n\n#### Dependencies\n```typescript\nimport { Component, computed, input, output } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { AxBadgeComponent } from '../badge/badge.component';\n```\n\n#### Template Snippet\n```html\n<div class=\"ax-stock-level\" [class]=\"'ax-stock-level--' + size()\">\n  @if (showLabel()) {\n    <div class=\"ax-stock-level__label\">\n      <span class=\"ax-stock-level__value\">\n        {{ current() }} / {{ maximum() }} {{ unit() }}\n      </span>\n      @if (showPercentage()) {\n        <span class=\"ax-stock-level__percentage\">({{ percentage() }}%)</span>\n      }\n    </div>\n  }\n\n  <div class=\"ax-stock-level__progress\"\n       [matTooltip]=\"tooltipText()\"\n       role=\"progressbar\"\n       [attr.aria-valuenow]=\"current()\"\n       [attr.aria-valuemin]=\"0\"\n       [attr.aria-valuemax]=\"maximum()\">\n    <div class=\"ax-stock-level__progress-bg\"></div>\n    <div class=\"ax-stock-level__progress-fill\"\n         [class]=\"colorClass()\"\n         [style.width.%]=\"percentage()\"></div>\n    <div class=\"ax-stock-level__threshold\"\n         [style.left.%]=\"(minimum() / maximum()) * 100\">\n      <span class=\"ax-stock-level__threshold-label\">min</span>\n    </div>\n  </div>\n\n  @if (isWarning()) {\n    <ax-badge type=\"warning\"\n              size=\"sm\"\n              content=\"Low Stock\"\n              (click)=\"onWarningClick.emit({ level: 'low', current: current() })\" />\n  }\n</div>\n```\n\n#### Styling Strategy (SCSS)\n```scss\n.ax-stock-level {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n\n  &__label {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n  }\n\n  &__progress {\n    position: relative;\n    height: 12px;\n    border-radius: 9999px;\n    overflow: hidden;\n    transition: height 0.2s ease;\n\n    &-bg {\n      position: absolute;\n      inset: 0;\n      background: var(--background-subtle);\n    }\n\n    &-fill {\n      position: absolute;\n      inset: 0;\n      transition: width 0.3s ease, background-color 0.3s ease;\n    }\n  }\n\n  &__threshold {\n    position: absolute;\n    top: 0;\n    bottom: 0;\n    width: 2px;\n    background: var(--border-emphasis);\n    pointer-events: none;\n\n    &-label {\n      position: absolute;\n      top: -1.5rem;\n      left: 50%;\n      transform: translateX(-50%);\n      font-size: 0.625rem;\n      color: var(--text-subtle);\n    }\n  }\n\n  &--sm {\n    .ax-stock-level__progress {\n      height: 8px;\n    }\n  }\n\n  &--lg {\n    .ax-stock-level__progress {\n      height: 16px;\n    }\n  }\n}\n```\n\n#### Performance Optimizations\n- Use `OnPush` change detection strategy (automatic with signals)\n- Computed signals prevent unnecessary recalculations\n- CSS transitions instead of animations\n- No external API calls (display-only component)\n\n---\n\n## 2. Barcode Scanner (`ax-barcode-scanner`)\n\n### 2.1 Visual Design\n\n#### Layout Structure - Camera Mode\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  ğŸ“¹  Camera Scanning                     [Ã—]    â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚                                                 â”‚\nâ”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚\nâ”‚           â”‚                 â”‚                  â”‚\nâ”‚           â”‚   VIDEO FEED    â”‚                  â”‚\nâ”‚           â”‚                 â”‚                  â”‚\nâ”‚           â”‚  â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“  â”‚ â† Scan frame     â”‚\nâ”‚           â”‚                 â”‚                  â”‚\nâ”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚\nâ”‚                                                 â”‚\nâ”‚  [ğŸ’¡ Flashlight]  [âŒ¨ï¸ Manual Input]            â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚  Recent Scans (if enabled):                    â”‚\nâ”‚  â€¢ 8850999320113 - 2 sec ago                   â”‚\nâ”‚  â€¢ 8851234567890 - 15 sec ago                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n#### Layout Structure - Manual Mode\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  âŒ¨ï¸  Manual Entry                        [Ã—]    â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚\nâ”‚  â”‚ Enter barcode...                      [ğŸ”] â”‚ â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚\nâ”‚  [ğŸ“· Use Camera]                               â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚  Format: EAN-13, Code 128, QR Code            â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n#### Color Scheme\n- **Header background**: `bg-default` with `border-b border-default`\n- **Video container**: `bg-black` (for camera feed)\n- **Scan frame overlay**: `border-2 border-primary-500` with animation\n- **Success state**: Green pulse animation on successful scan\n- **Error state**: Red shake animation on invalid scan\n- **Button primary**: Material Design filled button\n- **Button secondary**: Material Design outlined button\n\n#### Typography\n- **Header title**: `text-lg font-semibold text-primary`\n- **Input placeholder**: `text-base text-subtle`\n- **Recent scans**: `text-sm text-secondary`\n- **Helper text**: `text-xs text-subtle`\n\n#### Animations\n```scss\n@keyframes scan-pulse {\n  0%, 100% { opacity: 1; }\n  50% { opacity: 0.5; }\n}\n\n@keyframes scan-success {\n  0% { transform: scale(1); border-color: var(--primary-500); }\n  50% { transform: scale(1.05); border-color: var(--success-500); }\n  100% { transform: scale(1); border-color: var(--success-500); }\n}\n\n@keyframes scan-error {\n  0%, 100% { transform: translateX(0); }\n  25% { transform: translateX(-10px); }\n  75% { transform: translateX(10px); }\n}\n```\n\n### 2.2 Component Architecture\n\n#### Component Structure\n```typescript\nAxBarcodeScannerComponent\nâ”œâ”€â”€ Template\nâ”‚   â”œâ”€â”€ Header section\nâ”‚   â”‚   â”œâ”€â”€ Mode indicator (camera/manual)\nâ”‚   â”‚   â””â”€â”€ Close button\nâ”‚   â”œâ”€â”€ Scanner section (mode-dependent)\nâ”‚   â”‚   â”œâ”€â”€ Camera mode\nâ”‚   â”‚   â”‚   â”œâ”€â”€ Video element (<video> tag)\nâ”‚   â”‚   â”‚   â”œâ”€â”€ Scan frame overlay (animated border)\nâ”‚   â”‚   â”‚   â””â”€â”€ Canvas (hidden, for frame capture)\nâ”‚   â”‚   â””â”€â”€ Manual mode\nâ”‚   â”‚       â”œâ”€â”€ Text input field\nâ”‚   â”‚       â””â”€â”€ Submit button\nâ”‚   â”œâ”€â”€ Action buttons section\nâ”‚   â”‚   â”œâ”€â”€ Flashlight toggle (camera mode only)\nâ”‚   â”‚   â””â”€â”€ Mode switcher (camera â†” manual)\nâ”‚   â””â”€â”€ Recent scans section (optional)\nâ”‚       â””â”€â”€ List of recent ScanResult items\nâ””â”€â”€ State Management\n    â”œâ”€â”€ mode (signal: 'camera' | 'manual')\n    â”œâ”€â”€ isScanning (signal: boolean)\n    â”œâ”€â”€ hasPermission (signal: boolean)\n    â”œâ”€â”€ recentScans (signal: ScanResult[])\n    â”œâ”€â”€ currentStream (MediaStream | null)\n    â””â”€â”€ codeReader (BrowserMultiFormatReader from ZXing)\n```\n\n#### State Management (Signals)\n```typescript\n// Inputs\nmode = input<'camera' | 'manual' | 'auto'>('auto');\nformats = input<BarcodeFormat[]>(['qr', 'ean13', 'code128']);\ncontinuousScan = input<boolean>(false);\nbeepSound = input<boolean>(true);\nshowHistory = input<boolean>(false);\nplaceholder = input<string>('Enter barcode...');\n\n// Outputs\nonScan = output<ScanResult>();\nonError = output<ScanError>();\nonModeChange = output<'camera' | 'manual'>();\n\n// Internal state\nprivate currentMode = signal<'camera' | 'manual'>('camera');\nprivate isScanning = signal<boolean>(false);\nprivate hasPermission = signal<boolean | null>(null);\nprivate recentScans = signal<ScanResult[]>([]);\nprivate currentStream = signal<MediaStream | null>(null);\nprivate flashlightEnabled = signal<boolean>(false);\n\n// Computed\ncanUseCamera = computed(() => {\n  return 'mediaDevices' in navigator && 'getUserMedia' in navigator.mediaDevices;\n});\n\ndisplayedScans = computed(() => {\n  return this.showHistory() ? this.recentScans().slice(0, 10) : [];\n});\n```\n\n#### Lifecycle Management\n```typescript\nasync ngOnInit() {\n  // Determine initial mode\n  const mode = this.mode();\n  if (mode === 'auto') {\n    if (this.canUseCamera()) {\n      await this.initCameraMode();\n    } else {\n      this.switchToManualMode();\n    }\n  } else if (mode === 'camera') {\n    await this.initCameraMode();\n  } else {\n    this.switchToManualMode();\n  }\n}\n\nngOnDestroy() {\n  this.cleanupCamera();\n}\n\nprivate async initCameraMode() {\n  try {\n    const stream = await navigator.mediaDevices.getUserMedia({\n      video: { facingMode: 'environment', width: { ideal: 1280 }, height: { ideal: 720 } }\n    });\n    this.currentStream.set(stream);\n    this.hasPermission.set(true);\n    this.startScanning();\n  } catch (error) {\n    this.hasPermission.set(false);\n    this.onError.emit({ type: 'permission-denied', message: error.message });\n    this.switchToManualMode();\n  }\n}\n\nprivate cleanupCamera() {\n  const stream = this.currentStream();\n  if (stream) {\n    stream.getTracks().forEach(track => track.stop());\n    this.currentStream.set(null);\n  }\n}\n```\n\n#### Barcode Detection Logic\n```typescript\nprivate async startScanning() {\n  const codeReader = new BrowserMultiFormatReader();\n  const videoElement = this.videoRef?.nativeElement;\n\n  try {\n    await codeReader.decodeFromVideoDevice(\n      undefined, // Use default device\n      videoElement,\n      (result, error) => {\n        if (result) {\n          this.handleScanSuccess(result);\n        }\n        // Ignore errors during continuous scanning\n      }\n    );\n  } catch (error) {\n    this.onError.emit({ type: 'camera-error', message: error.message });\n  }\n}\n\nprivate handleScanSuccess(result: Result) {\n  const scanResult: ScanResult = {\n    code: result.getText(),\n    format: this.mapBarcodeFormat(result.getBarcodeFormat()),\n    timestamp: new Date(),\n    mode: 'camera'\n  };\n\n  // Play beep sound\n  if (this.beepSound()) {\n    this.playBeep();\n  }\n\n  // Add to history\n  const scans = [scanResult, ...this.recentScans()];\n  this.recentScans.set(scans.slice(0, 10));\n\n  // Emit event\n  this.onScan.emit(scanResult);\n\n  // Handle continuous scan\n  if (!this.continuousScan()) {\n    this.isScanning.set(false);\n  }\n}\n\nprivate playBeep() {\n  const audioContext = new AudioContext();\n  const oscillator = audioContext.createOscillator();\n  const gainNode = audioContext.createGain();\n\n  oscillator.connect(gainNode);\n  gainNode.connect(audioContext.destination);\n\n  oscillator.frequency.value = 800;\n  oscillator.type = 'sine';\n\n  gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);\n  gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);\n\n  oscillator.start(audioContext.currentTime);\n  oscillator.stop(audioContext.currentTime + 0.1);\n}\n```\n\n### 2.3 Technical Implementation\n\n#### Library Integration - ZXing\n```typescript\n// Install: pnpm add @zxing/library\nimport {\n  BrowserMultiFormatReader,\n  Result,\n  BarcodeFormat\n} from '@zxing/library';\n\n// Format mapping\nprivate mapBarcodeFormat(format: BarcodeFormat): BarcodeFormat {\n  const formatMap = {\n    [BarcodeFormat.QR_CODE]: 'qr',\n    [BarcodeFormat.EAN_13]: 'ean13',\n    [BarcodeFormat.EAN_8]: 'ean8',\n    [BarcodeFormat.CODE_128]: 'code128',\n    [BarcodeFormat.CODE_39]: 'code39',\n    [BarcodeFormat.DATA_MATRIX]: 'datamatrix',\n  };\n  return formatMap[format] || 'unknown';\n}\n```\n\n#### Manual Input Validation\n```typescript\nprivate validateManualInput(code: string): boolean {\n  const format = this.detectFormat(code);\n\n  if (!format) {\n    this.onError.emit({\n      type: 'invalid-format',\n      message: 'Unrecognized barcode format'\n    });\n    return false;\n  }\n\n  if (!this.formats().includes(format)) {\n    this.onError.emit({\n      type: 'invalid-format',\n      message: `Format ${format} not allowed`\n    });\n    return false;\n  }\n\n  return true;\n}\n\nprivate detectFormat(code: string): BarcodeFormat | null {\n  if (code.length === 13 && /^\\d+$/.test(code)) {\n    return 'ean13';\n  }\n  if (code.length === 8 && /^\\d+$/.test(code)) {\n    return 'ean8';\n  }\n  if (/^[A-Z0-9\\-\\.\\$\\/\\+% ]+$/.test(code)) {\n    return 'code128';\n  }\n  return null;\n}\n```\n\n#### Flashlight Control\n```typescript\nasync toggleFlashlight() {\n  const stream = this.currentStream();\n  if (!stream) return;\n\n  const track = stream.getVideoTracks()[0];\n  const capabilities = track.getCapabilities();\n\n  if (!capabilities.torch) {\n    this.onError.emit({\n      type: 'camera-error',\n      message: 'Flashlight not supported on this device'\n    });\n    return;\n  }\n\n  const enabled = !this.flashlightEnabled();\n  await track.applyConstraints({ advanced: [{ torch: enabled }] });\n  this.flashlightEnabled.set(enabled);\n}\n```\n\n#### Accessibility Features\n- **Keyboard shortcuts**: Enter to scan in manual mode\n- **ARIA labels**: All buttons properly labeled\n- **Screen reader announcements**: Scan success/error announced\n- **Focus management**: Auto-focus input in manual mode\n- **Color-independent feedback**: Sound + vibration on scan\n\n---\n\n## 3. Quantity Input with Unit Conversion (`ax-quantity-input`)\n\n### 3.1 Visual Design\n\n#### Layout Structure\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  [-]  [   150    ]  [+]   [â–¼ pieces]           â”‚\nâ”‚                                                 â”‚\nâ”‚  = 12.5 boxes  (12 pieces per box)             â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n#### Color Scheme\n- **Input field**: Standard Material Design text input\n- **Stepper buttons**: `bg-primary-500` on hover, `bg-primary-100` default\n- **Unit dropdown**: Material Design select component\n- **Conversion hint**: `text-subtle` with `text-xs`\n- **Error state**: `border-error-500` with `text-error-600`\n- **Disabled state**: `opacity-50` with `cursor-not-allowed`\n\n#### Typography\n- **Input value**: `text-base font-medium text-primary`\n- **Unit label**: `text-sm text-secondary`\n- **Conversion hint**: `text-xs text-subtle`\n- **Error message**: `text-xs text-error-600`\n\n#### Spacing\n- Container padding: `p-2`\n- Gap between stepper and input: `gap-1`\n- Gap between input and dropdown: `gap-2`\n- Conversion hint margin top: `mt-1`\n\n#### Interactive States\n- **Hover**: Stepper buttons scale slightly (1.05)\n- **Active**: Stepper buttons scale down (0.95)\n- **Focus**: Input field shows focus ring\n- **Disabled**: All controls grayed out with reduced opacity\n\n### 3.2 Component Architecture\n\n#### Component Structure\n```typescript\nAxQuantityInputComponent\nâ”œâ”€â”€ Template\nâ”‚   â”œâ”€â”€ Input group\nâ”‚   â”‚   â”œâ”€â”€ Decrement button (-)\nâ”‚   â”‚   â”œâ”€â”€ Number input field\nâ”‚   â”‚   â”œâ”€â”€ Increment button (+)\nâ”‚   â”‚   â””â”€â”€ Unit selector (dropdown)\nâ”‚   â”œâ”€â”€ Preset buttons (optional)\nâ”‚   â”‚   â”œâ”€â”€ Ã—10 button\nâ”‚   â”‚   â””â”€â”€ Ã—100 button\nâ”‚   â”œâ”€â”€ Conversion hint\nâ”‚   â”‚   â””â”€â”€ Display in other units\nâ”‚   â””â”€â”€ Error message\nâ”‚       â””â”€â”€ Validation errors\nâ””â”€â”€ State Management\n    â”œâ”€â”€ value (signal, two-way binding)\n    â”œâ”€â”€ selectedUnit (signal)\n    â”œâ”€â”€ validationErrors (computed)\n    â”œâ”€â”€ displayValue (computed)\n    â””â”€â”€ conversionHint (computed)\n```\n\n#### State Management (Signals)\n```typescript\n// Inputs\nvalue = model.required<number>(); // Two-way binding\nbaseUnit = input.required<string>();\navailableUnits = input.required<UnitConfig[]>();\nmin = input<number>(0);\nmax = input<number>(Infinity);\nstep = input<number>(1);\nshowStepper = input<boolean>(true);\nshowPresets = input<boolean>(false);\ndecimalPlaces = input<number>(0);\ndisabled = input<boolean>(false);\n\n// Outputs\nvalueChange = output<number>(); // Emits value in base unit\nunitChange = output<string>();\nonValidation = output<ValidationState>();\n\n// Internal state\nprivate selectedUnit = signal<string>('');\nprivate internalValue = signal<number>(0);\nprivate isTouched = signal<boolean>(false);\n\n// Computed\ndisplayValue = computed(() => {\n  const val = this.value();\n  const unit = this.selectedUnitConfig();\n  if (!unit) return val;\n\n  // Convert from base unit to display unit\n  return val / unit.conversionRate;\n});\n\nselectedUnitConfig = computed(() => {\n  const units = this.availableUnits();\n  const selected = this.selectedUnit();\n  return units.find(u => u.code === selected) || units[0];\n});\n\nconversionHint = computed(() => {\n  const val = this.value();\n  const baseUnit = this.baseUnit();\n  const currentUnit = this.selectedUnit();\n\n  if (currentUnit === baseUnit) return '';\n\n  const config = this.selectedUnitConfig();\n  if (!config) return '';\n\n  return `= ${val} ${baseUnit}  (${config.conversionRate} ${baseUnit} per ${config.label})`;\n});\n\nvalidationErrors = computed(() => {\n  const val = this.value();\n  const errors: ValidationError[] = [];\n\n  if (val < this.min()) {\n    errors.push({\n      type: 'min',\n      message: `Minimum value is ${this.min()}`\n    });\n  }\n\n  if (val > this.max()) {\n    errors.push({\n      type: 'max',\n      message: `Maximum value is ${this.max()}`\n    });\n  }\n\n  const dp = this.decimalPlaces();\n  const decimals = (val.toString().split('.')[1] || '').length;\n  if (decimals > dp) {\n    errors.push({\n      type: 'decimal',\n      message: `Maximum ${dp} decimal places`\n    });\n  }\n\n  const baseUnitConfig = this.availableUnits().find(u => u.code === this.baseUnit());\n  if (baseUnitConfig?.decimalPlaces === 0 && !Number.isInteger(val)) {\n    errors.push({\n      type: 'integer',\n      message: `${this.baseUnit()} must be a whole number`\n    });\n  }\n\n  return errors;\n});\n\nisValid = computed(() => this.validationErrors().length === 0);\n```\n\n#### Unit Conversion Logic\n```typescript\nprivate convertToBaseUnit(displayValue: number, fromUnit: string): number {\n  const unitConfig = this.availableUnits().find(u => u.code === fromUnit);\n  if (!unitConfig) return displayValue;\n\n  // Multiply by conversion rate to get base unit\n  return displayValue * unitConfig.conversionRate;\n}\n\nprivate convertFromBaseUnit(baseValue: number, toUnit: string): number {\n  const unitConfig = this.availableUnits().find(u => u.code === toUnit);\n  if (!unitConfig) return baseValue;\n\n  // Divide by conversion rate to get display unit\n  return baseValue / unitConfig.conversionRate;\n}\n\nonUnitChange(newUnit: string) {\n  this.selectedUnit.set(newUnit);\n  this.unitChange.emit(newUnit);\n  // Value stays the same in base unit, only display changes\n}\n```\n\n#### Stepper Logic\n```typescript\nincrement() {\n  if (this.disabled()) return;\n\n  const currentDisplay = this.displayValue();\n  const step = this.step();\n  const newDisplay = currentDisplay + step;\n\n  // Convert to base unit and update\n  const newValue = this.convertToBaseUnit(newDisplay, this.selectedUnit());\n  this.updateValue(newValue);\n}\n\ndecrement() {\n  if (this.disabled()) return;\n\n  const currentDisplay = this.displayValue();\n  const step = this.step();\n  const newDisplay = Math.max(currentDisplay - step, 0);\n\n  // Convert to base unit and update\n  const newValue = this.convertToBaseUnit(newDisplay, this.selectedUnit());\n  this.updateValue(newValue);\n}\n\nprivate updateValue(newValue: number) {\n  const min = this.min();\n  const max = this.max();\n\n  // Clamp value\n  const clampedValue = Math.max(min, Math.min(max, newValue));\n\n  // Round to decimal places\n  const dp = this.decimalPlaces();\n  const roundedValue = Math.round(clampedValue * Math.pow(10, dp)) / Math.pow(10, dp);\n\n  this.value.set(roundedValue);\n  this.valueChange.emit(roundedValue);\n\n  // Emit validation state\n  this.onValidation.emit({\n    valid: this.isValid(),\n    errors: this.validationErrors()\n  });\n}\n```\n\n### 3.3 Technical Implementation\n\n#### Reactive Forms Integration (ControlValueAccessor)\n```typescript\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\n\n@Component({\n  providers: [{\n    provide: NG_VALUE_ACCESSOR,\n    useExisting: forwardRef(() => AxQuantityInputComponent),\n    multi: true\n  }]\n})\nexport class AxQuantityInputComponent implements ControlValueAccessor {\n  private onChange: (value: number) => void = () => {};\n  private onTouched: () => void = () => {};\n\n  writeValue(value: number): void {\n    this.value.set(value || 0);\n  }\n\n  registerOnChange(fn: (value: number) => void): void {\n    this.onChange = fn;\n  }\n\n  registerOnTouched(fn: () => void): void {\n    this.onTouched = fn;\n  }\n\n  setDisabledState(isDisabled: boolean): void {\n    this.disabled.set(isDisabled);\n  }\n\n  private updateValue(newValue: number) {\n    // ... existing update logic ...\n    this.onChange(newValue);\n  }\n\n  onBlur() {\n    this.onTouched();\n  }\n}\n```\n\n#### Template Snippet\n```html\n<div class=\"ax-quantity-input\"\n     [class.ax-quantity-input--disabled]=\"disabled()\"\n     [class.ax-quantity-input--error]=\"!isValid() && isTouched()\">\n\n  @if (showStepper()) {\n    <button type=\"button\"\n            class=\"ax-quantity-input__stepper\"\n            [disabled]=\"disabled() || value() <= min()\"\n            (click)=\"decrement()\"\n            aria-label=\"Decrease quantity\">\n      <mat-icon>remove</mat-icon>\n    </button>\n  }\n\n  <input type=\"number\"\n         class=\"ax-quantity-input__field\"\n         [value]=\"displayValue()\"\n         [min]=\"convertFromBaseUnit(min(), selectedUnit())\"\n         [max]=\"convertFromBaseUnit(max(), selectedUnit())\"\n         [step]=\"step()\"\n         [disabled]=\"disabled()\"\n         [attr.aria-label]=\"'Quantity in ' + selectedUnit()\"\n         (input)=\"onInputChange($event)\"\n         (blur)=\"onBlur()\" />\n\n  @if (showStepper()) {\n    <button type=\"button\"\n            class=\"ax-quantity-input__stepper\"\n            [disabled]=\"disabled() || value() >= max()\"\n            (click)=\"increment()\"\n            aria-label=\"Increase quantity\">\n      <mat-icon>add</mat-icon>\n    </button>\n  }\n\n  <mat-select class=\"ax-quantity-input__unit-select\"\n              [(value)]=\"selectedUnit\"\n              [disabled]=\"disabled()\"\n              (selectionChange)=\"onUnitChange($event.value)\">\n    @for (unit of availableUnits(); track unit.code) {\n      <mat-option [value]=\"unit.code\">\n        {{ unit.label }} @if (unit.symbol) { ({{ unit.symbol }}) }\n      </mat-option>\n    }\n  </mat-select>\n\n  @if (showPresets() && !disabled()) {\n    <div class=\"ax-quantity-input__presets\">\n      <button type=\"button\"\n              class=\"ax-quantity-input__preset\"\n              (click)=\"multiplyValue(10)\">\n        Ã—10\n      </button>\n      <button type=\"button\"\n              class=\"ax-quantity-input__preset\"\n              (click)=\"multiplyValue(100)\">\n        Ã—100\n      </button>\n    </div>\n  }\n</div>\n\n@if (conversionHint()) {\n  <div class=\"ax-quantity-input__hint\">\n    {{ conversionHint() }}\n  </div>\n}\n\n@if (!isValid() && isTouched()) {\n  <div class=\"ax-quantity-input__errors\">\n    @for (error of validationErrors(); track error.type) {\n      <span class=\"ax-quantity-input__error\">{{ error.message }}</span>\n    }\n  </div>\n}\n```\n\n#### Accessibility Features\n- **ARIA attributes**: All interactive elements properly labeled\n- **Keyboard navigation**:\n  - Arrow up/down to increment/decrement\n  - Tab through stepper â†’ input â†’ unit selector\n  - Enter to confirm input\n- **Screen reader**: Announces value changes and unit conversions\n- **Focus indicators**: Visible focus ring on all interactive elements\n- **Error announcements**: Validation errors announced to screen readers\n\n---\n\n## 4. Batch/Lot Number Selector (`ax-batch-selector`)\n\n### 4.1 Visual Design\n\n#### Layout Structure - List View\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ ğŸ” [Search batches...]                 [Strategy: FEFOâ–¼]â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚\nâ”‚ â”‚ â­ BATCH-2024-001          [Select]                 â”‚ â”‚\nâ”‚ â”‚ Expiry: 2025-03-15 (85 days left)  ğŸŸ¡               â”‚ â”‚\nâ”‚ â”‚ Available: 500 pieces                               â”‚ â”‚\nâ”‚ â”‚ Manufactured: 2024-01-10                            â”‚ â”‚\nâ”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚\nâ”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚\nâ”‚ â”‚ BATCH-2024-002                [Select]              â”‚ â”‚\nâ”‚ â”‚ Expiry: 2025-06-20 (180 days left)  ğŸŸ¢              â”‚ â”‚\nâ”‚ â”‚ Available: 1,200 pieces                             â”‚ â”‚\nâ”‚ â”‚ Manufactured: 2024-02-15                            â”‚ â”‚\nâ”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚\nâ”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚\nâ”‚ â”‚ BATCH-2023-099                [EXPIRED]             â”‚ â”‚\nâ”‚ â”‚ Expiry: 2024-12-01 (EXPIRED 17 days ago)  âš«        â”‚ â”‚\nâ”‚ â”‚ Available: 50 pieces                                â”‚ â”‚\nâ”‚ â”‚ Manufactured: 2023-11-01                            â”‚ â”‚\nâ”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n#### Color Scheme\n- **Recommended batch star**: `text-warning-500`\n- **Expiry status badges**:\n  - Safe (>30 days): `bg-success-100 text-success-800`\n  - Warning (7-30 days): `bg-warning-100 text-warning-800`\n  - Critical (<7 days): `bg-error-100 text-error-800`\n  - Expired: `bg-neutral-100 text-neutral-600`\n- **Card borders**:\n  - Default: `border-default`\n  - Recommended: `border-warning-500 border-2`\n  - Selected: `border-primary-500 border-2`\n  - Expired: `border-neutral-300`\n- **Disabled/Expired**: `opacity-50 cursor-not-allowed`\n\n#### Typography\n- **Batch number**: `text-base font-semibold text-primary`\n- **Expiry date**: `text-sm text-secondary`\n- **Available quantity**: `text-sm font-medium text-primary`\n- **Manufacturing date**: `text-xs text-subtle`\n- **Status badge**: `text-xs font-bold uppercase`\n\n#### Spacing\n- Card padding: `p-4`\n- Gap between cards: `gap-3`\n- Search bar margin: `mb-4`\n- Badge margin: `ml-2`\n\n#### Responsive Behavior\n- **Mobile (<640px)**: Single column, full width cards\n- **Tablet (640-1024px)**: Single column with max-width\n- **Desktop (>1024px)**: Optional two-column grid\n\n### 4.2 Component Architecture\n\n#### Component Structure\n```typescript\nAxBatchSelectorComponent\nâ”œâ”€â”€ Template\nâ”‚   â”œâ”€â”€ Header section\nâ”‚   â”‚   â”œâ”€â”€ Search input (filter batches)\nâ”‚   â”‚   â””â”€â”€ Strategy selector (FIFO/FEFO/LIFO)\nâ”‚   â”œâ”€â”€ Batch list section\nâ”‚   â”‚   â””â”€â”€ Batch card (repeated)\nâ”‚   â”‚       â”œâ”€â”€ Batch number + recommended badge\nâ”‚   â”‚       â”œâ”€â”€ Expiry date + status indicator\nâ”‚   â”‚       â”œâ”€â”€ Available quantity\nâ”‚   â”‚       â”œâ”€â”€ Manufacturing date (optional)\nâ”‚   â”‚       â”œâ”€â”€ Selection control (radio/checkbox)\nâ”‚   â”‚       â””â”€â”€ Quantity input (if multi-select)\nâ”‚   â”œâ”€â”€ Empty state\nâ”‚   â”‚   â””â”€â”€ \"No batches available\" message\nâ”‚   â””â”€â”€ Selected summary (if multi-select)\nâ”‚       â”œâ”€â”€ Total selected quantity\nâ”‚       â””â”€â”€ Selected batches list\nâ””â”€â”€ State Management\n    â”œâ”€â”€ batches (signal: BatchInfo[])\n    â”œâ”€â”€ filteredBatches (computed)\n    â”œâ”€â”€ selectedBatches (signal: SelectedBatch[])\n    â”œâ”€â”€ searchTerm (signal: string)\n    â”œâ”€â”€ strategy (signal: 'fifo' | 'fefo' | 'lifo')\n    â””â”€â”€ recommendedBatchId (computed)\n```\n\n#### State Management (Signals)\n```typescript\n// Inputs\nproductId = input.required<string>();\nbatches = input<BatchInfo[]>([]);\nstrategy = model<'fifo' | 'fefo' | 'lifo'>('fefo');\nallowMultiple = input<boolean>(false);\nrequestedQuantity = input<number | undefined>(undefined);\nshowExpiry = input<boolean>(true);\nshowManufacturing = input<boolean>(false);\nshowRecommendation = input<boolean>(true);\nexpiryWarningDays = input<number>(30);\nexpiryCriticalDays = input<number>(7);\n\n// Outputs\nonSelect = output<BatchSelection>();\nonBatchesLoad = output<BatchInfo[]>();\nonError = output<string>();\n\n// Internal state\nprivate internalBatches = signal<BatchInfo[]>([]);\nprivate selectedBatches = signal<SelectedBatch[]>([]);\nprivate searchTerm = signal<string>('');\nprivate isLoading = signal<boolean>(false);\n\n// Computed\nfilteredBatches = computed(() => {\n  let batches = this.sortBatchesByStrategy();\n  const term = this.searchTerm().toLowerCase();\n\n  if (term) {\n    batches = batches.filter(b =>\n      b.batchNumber.toLowerCase().includes(term) ||\n      b.lotNumber?.toLowerCase().includes(term)\n    );\n  }\n\n  return batches;\n});\n\nsortedBatches = computed(() => {\n  const batches = [...this.internalBatches()];\n  const strategy = this.strategy();\n\n  switch (strategy) {\n    case 'fifo':\n      return batches.sort((a, b) =>\n        a.manufacturingDate?.getTime() - b.manufacturingDate?.getTime()\n      );\n    case 'fefo':\n      return batches.sort((a, b) =>\n        a.expiryDate.getTime() - b.expiryDate.getTime()\n      );\n    case 'lifo':\n      return batches.sort((a, b) =>\n        b.manufacturingDate?.getTime() - a.manufacturingDate?.getTime()\n      );\n  }\n});\n\nrecommendedBatchId = computed(() => {\n  if (!this.showRecommendation()) return null;\n\n  const available = this.sortedBatches().filter(b =>\n    b.status === 'available' && !this.isExpired(b)\n  );\n\n  return available[0]?.batchNumber || null;\n});\n\ntotalSelectedQuantity = computed(() => {\n  return this.selectedBatches().reduce((sum, sb) => sum + sb.quantity, 0);\n});\n\ncanSelectMore = computed(() => {\n  if (!this.allowMultiple()) return true;\n  const requested = this.requestedQuantity();\n  if (!requested) return true;\n  return this.totalSelectedQuantity() < requested;\n});\n```\n\n#### Expiry Status Logic\n```typescript\ngetExpiryStatus(batch: BatchInfo): 'safe' | 'warning' | 'critical' | 'expired' {\n  const now = new Date();\n  const expiry = new Date(batch.expiryDate);\n  const daysUntilExpiry = Math.ceil((expiry.getTime() - now.getTime()) / (1000 * 60 * 60 * 24));\n\n  if (daysUntilExpiry < 0) return 'expired';\n  if (daysUntilExpiry <= this.expiryCriticalDays()) return 'critical';\n  if (daysUntilExpiry <= this.expiryWarningDays()) return 'warning';\n  return 'safe';\n}\n\ngetExpiryBadgeText(batch: BatchInfo): string {\n  const status = this.getExpiryStatus(batch);\n  const now = new Date();\n  const expiry = new Date(batch.expiryDate);\n  const daysUntilExpiry = Math.ceil((expiry.getTime() - now.getTime()) / (1000 * 60 * 60 * 24));\n\n  switch (status) {\n    case 'expired':\n      return `EXPIRED ${Math.abs(daysUntilExpiry)} days ago`;\n    case 'critical':\n      return `${daysUntilExpiry} days left`;\n    case 'warning':\n      return `${daysUntilExpiry} days left`;\n    case 'safe':\n      return `Expires in ${daysUntilExpiry} days`;\n  }\n}\n\nisExpired(batch: BatchInfo): boolean {\n  return this.getExpiryStatus(batch) === 'expired';\n}\n\ncanSelectBatch(batch: BatchInfo): boolean {\n  return batch.status === 'available' && !this.isExpired(batch);\n}\n```\n\n#### Selection Logic\n```typescript\nselectBatch(batch: BatchInfo, quantity?: number) {\n  if (!this.canSelectBatch(batch)) {\n    this.onError.emit(`Cannot select batch ${batch.batchNumber}: ${batch.status}`);\n    return;\n  }\n\n  const selected = this.selectedBatches();\n\n  if (this.allowMultiple()) {\n    // Multi-select mode\n    const existing = selected.find(s => s.batch.batchNumber === batch.batchNumber);\n\n    if (existing) {\n      // Update quantity\n      const newSelected = selected.map(s =>\n        s.batch.batchNumber === batch.batchNumber\n          ? { ...s, quantity: quantity || s.quantity }\n          : s\n      );\n      this.selectedBatches.set(newSelected);\n    } else {\n      // Add new\n      const defaultQty = quantity || Math.min(\n        batch.availableQuantity,\n        (this.requestedQuantity() || batch.availableQuantity) - this.totalSelectedQuantity()\n      );\n\n      this.selectedBatches.set([...selected, { batch, quantity: defaultQty }]);\n    }\n  } else {\n    // Single-select mode\n    this.selectedBatches.set([{ batch, quantity: quantity || batch.availableQuantity }]);\n  }\n\n  this.emitSelection();\n}\n\ndeselectBatch(batchNumber: string) {\n  const selected = this.selectedBatches().filter(s => s.batch.batchNumber !== batchNumber);\n  this.selectedBatches.set(selected);\n  this.emitSelection();\n}\n\nprivate emitSelection() {\n  const selection: BatchSelection = {\n    batches: this.selectedBatches(),\n    totalQuantity: this.totalSelectedQuantity(),\n    strategy: this.strategy()\n  };\n  this.onSelect.emit(selection);\n}\n```\n\n### 4.3 Technical Implementation\n\n#### API Integration\n```typescript\nprivate readonly http = inject(HttpClient);\nprivate readonly apiUrl = '/api/inventory/products';\n\nasync ngOnInit() {\n  if (!this.batches().length && this.productId()) {\n    await this.loadBatches();\n  } else {\n    this.internalBatches.set(this.batches());\n  }\n}\n\nprivate async loadBatches() {\n  this.isLoading.set(true);\n\n  try {\n    const response = await firstValueFrom(\n      this.http.get<{ batches: BatchInfo[], strategy: string }>(\n        `${this.apiUrl}/${this.productId()}/batches`,\n        {\n          params: {\n            status: 'available',\n            // location: 'WAREHOUSE-01', // Optional\n          }\n        }\n      )\n    );\n\n    this.internalBatches.set(response.batches);\n    this.onBatchesLoad.emit(response.batches);\n\n    if (response.strategy) {\n      this.strategy.set(response.strategy as any);\n    }\n  } catch (error) {\n    this.onError.emit(`Failed to load batches: ${error.message}`);\n  } finally {\n    this.isLoading.set(false);\n  }\n}\n```\n\n#### Template Snippet\n```html\n<div class=\"ax-batch-selector\">\n  <div class=\"ax-batch-selector__header\">\n    <mat-form-field class=\"ax-batch-selector__search\">\n      <mat-icon matPrefix>search</mat-icon>\n      <input matInput\n             placeholder=\"Search batches...\"\n             [(ngModel)]=\"searchTerm\"\n             (ngModelChange)=\"searchTerm.set($event)\" />\n    </mat-form-field>\n\n    <mat-form-field class=\"ax-batch-selector__strategy\">\n      <mat-label>Strategy</mat-label>\n      <mat-select [(ngModel)]=\"strategy\">\n        <mat-option value=\"fifo\">FIFO (First In, First Out)</mat-option>\n        <mat-option value=\"fefo\">FEFO (First Expired, First Out)</mat-option>\n        <mat-option value=\"lifo\">LIFO (Last In, First Out)</mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  @if (isLoading()) {\n    <div class=\"ax-batch-selector__loading\">\n      <mat-spinner diameter=\"40\"></mat-spinner>\n      <p>Loading batches...</p>\n    </div>\n  } @else if (filteredBatches().length === 0) {\n    <div class=\"ax-batch-selector__empty\">\n      <mat-icon>inventory_2</mat-icon>\n      <p>No batches available</p>\n    </div>\n  } @else {\n    <div class=\"ax-batch-selector__list\">\n      @for (batch of filteredBatches(); track batch.batchNumber) {\n        <div class=\"ax-batch-selector__card\"\n             [class.ax-batch-selector__card--recommended]=\"batch.batchNumber === recommendedBatchId()\"\n             [class.ax-batch-selector__card--selected]=\"isSelected(batch)\"\n             [class.ax-batch-selector__card--disabled]=\"!canSelectBatch(batch)\">\n\n          <div class=\"ax-batch-selector__card-header\">\n            <div class=\"ax-batch-selector__batch-number\">\n              @if (batch.batchNumber === recommendedBatchId()) {\n                <mat-icon class=\"ax-batch-selector__star\">star</mat-icon>\n              }\n              {{ batch.batchNumber }}\n            </div>\n\n            @if (canSelectBatch(batch)) {\n              @if (allowMultiple()) {\n                <mat-checkbox [checked]=\"isSelected(batch)\"\n                              (change)=\"toggleBatch(batch)\">\n                  Select\n                </mat-checkbox>\n              } @else {\n                <mat-radio-button [checked]=\"isSelected(batch)\"\n                                  (change)=\"selectBatch(batch)\">\n                  Select\n                </mat-radio-button>\n              }\n            } @else {\n              <span class=\"ax-batch-selector__status-badge ax-batch-selector__status-badge--expired\">\n                EXPIRED\n              </span>\n            }\n          </div>\n\n          @if (showExpiry()) {\n            <div class=\"ax-batch-selector__expiry\">\n              <mat-icon>event</mat-icon>\n              <span>Expiry: {{ batch.expiryDate | date:'yyyy-MM-dd' }}</span>\n              <ax-badge [type]=\"getExpiryStatus(batch)\"\n                        [content]=\"getExpiryBadgeText(batch)\"\n                        size=\"sm\" />\n            </div>\n          }\n\n          <div class=\"ax-batch-selector__quantity\">\n            <mat-icon>inventory</mat-icon>\n            <span>Available: {{ batch.availableQuantity }} {{ batch.unit }}</span>\n          </div>\n\n          @if (showManufacturing() && batch.manufacturingDate) {\n            <div class=\"ax-batch-selector__manufacturing\">\n              <mat-icon>precision_manufacturing</mat-icon>\n              <span>Manufactured: {{ batch.manufacturingDate | date:'yyyy-MM-dd' }}</span>\n            </div>\n          }\n\n          @if (isSelected(batch) && allowMultiple()) {\n            <div class=\"ax-batch-selector__quantity-input\">\n              <ax-quantity-input\n                [(value)]=\"getSelectedQuantity(batch)\"\n                [baseUnit]=\"batch.unit\"\n                [availableUnits]=\"[{ code: batch.unit, label: batch.unit, conversionRate: 1, decimalPlaces: 0 }]\"\n                [max]=\"batch.availableQuantity\"\n                [min]=\"1\"\n                (valueChange)=\"updateBatchQuantity(batch, $event)\" />\n            </div>\n          }\n        </div>\n      }\n    </div>\n  }\n\n  @if (allowMultiple() && selectedBatches().length > 0) {\n    <div class=\"ax-batch-selector__summary\">\n      <div class=\"ax-batch-selector__summary-header\">\n        <h4>Selected Batches</h4>\n        <span class=\"ax-batch-selector__total\">\n          Total: {{ totalSelectedQuantity() }}\n          @if (requestedQuantity()) {\n            / {{ requestedQuantity() }}\n          }\n        </span>\n      </div>\n\n      <div class=\"ax-batch-selector__summary-list\">\n        @for (selected of selectedBatches(); track selected.batch.batchNumber) {\n          <div class=\"ax-batch-selector__summary-item\">\n            <span>{{ selected.batch.batchNumber }}</span>\n            <span>{{ selected.quantity }} {{ selected.batch.unit }}</span>\n            <button mat-icon-button\n                    (click)=\"deselectBatch(selected.batch.batchNumber)\"\n                    aria-label=\"Remove batch\">\n              <mat-icon>close</mat-icon>\n            </button>\n          </div>\n        }\n      </div>\n    </div>\n  }\n</div>\n```\n\n#### Accessibility Features\n- **ARIA labels**: All interactive elements labeled\n- **Keyboard navigation**:\n  - Tab through search â†’ strategy â†’ batch cards\n  - Space/Enter to select batch\n  - Arrow keys to navigate cards\n- **Screen reader announcements**:\n  - Batch count announced\n  - Expiry status announced\n  - Selection changes announced\n- **Color-independent indicators**: Icons + text for expiry status\n- **Focus management**: Proper focus indicators on all interactive elements\n\n---\n\n## 5. Cross-Component Integration\n\n### 5.1 Data Flow Architecture\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                  Parent Component                       â”‚\nâ”‚                 (e.g., Stock Receive Form)             â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚                                                         â”‚\nâ”‚  1. Scan barcode                                        â”‚\nâ”‚     â†“                                                   â”‚\nâ”‚  [ax-barcode-scanner]                                   â”‚\nâ”‚     â†“ (onScan event)                                    â”‚\nâ”‚  2. Product identified â†’ Load batches                   â”‚\nâ”‚     â†“                                                   â”‚\nâ”‚  [ax-batch-selector productId=\"...\"]                    â”‚\nâ”‚     â†“ (onSelect event)                                  â”‚\nâ”‚  3. Batch selected â†’ Show quantity input                â”‚\nâ”‚     â†“                                                   â”‚\nâ”‚  [ax-quantity-input]                                    â”‚\nâ”‚     â†“ (valueChange event)                               â”‚\nâ”‚  4. Update stock level preview                          â”‚\nâ”‚     â†“                                                   â”‚\nâ”‚  [ax-stock-level]                                       â”‚\nâ”‚                                                         â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### 5.2 Example Integration - Stock Receive Form\n\n```typescript\n@Component({\n  selector: 'app-stock-receive',\n  standalone: true,\n  imports: [\n    AxBarcodeScannerComponent,\n    AxBatchSelectorComponent,\n    AxQuantityInputComponent,\n    AxStockLevelComponent,\n    ReactiveFormsModule\n  ],\n  template: `\n    <form [formGroup]=\"receiveForm\" (ngSubmit)=\"onSubmit()\">\n      <div class=\"step\" *ngIf=\"currentStep === 'scan'\">\n        <h3>Scan Product Barcode</h3>\n        <ax-barcode-scanner (onScan)=\"handleScan($event)\" />\n      </div>\n\n      <div class=\"step\" *ngIf=\"currentStep === 'batch'\">\n        <h3>Select Batch</h3>\n        <ax-batch-selector\n          [productId]=\"selectedProduct()?.id\"\n          [strategy]=\"'fefo'\"\n          [allowMultiple]=\"false\"\n          (onSelect)=\"handleBatchSelect($event)\" />\n      </div>\n\n      <div class=\"step\" *ngIf=\"currentStep === 'quantity'\">\n        <h3>Enter Quantity</h3>\n        <ax-quantity-input\n          formControlName=\"quantity\"\n          [baseUnit]=\"selectedProduct()?.baseUnit\"\n          [availableUnits]=\"selectedProduct()?.units\"\n          [min]=\"1\"\n          [showPresets]=\"true\" />\n\n        <div class=\"preview\">\n          <h4>New Stock Level Preview</h4>\n          <ax-stock-level\n            [current]=\"previewStockLevel().current\"\n            [minimum]=\"previewStockLevel().minimum\"\n            [maximum]=\"previewStockLevel().maximum\"\n            [unit]=\"selectedProduct()?.baseUnit\" />\n        </div>\n      </div>\n\n      <div class=\"actions\">\n        <button type=\"button\" (click)=\"previousStep()\">Back</button>\n        <button type=\"button\" (click)=\"nextStep()\">Next</button>\n        <button type=\"submit\" [disabled]=\"!receiveForm.valid\">Submit</button>\n      </div>\n    </form>\n  `\n})\nexport class StockReceiveComponent {\n  currentStep = signal<'scan' | 'batch' | 'quantity'>('scan');\n  selectedProduct = signal<Product | null>(null);\n  selectedBatch = signal<BatchInfo | null>(null);\n\n  receiveForm = this.fb.group({\n    productId: ['', Validators.required],\n    batchNumber: ['', Validators.required],\n    quantity: [0, [Validators.required, Validators.min(1)]],\n  });\n\n  previewStockLevel = computed(() => {\n    const product = this.selectedProduct();\n    const quantity = this.receiveForm.value.quantity || 0;\n\n    return {\n      current: product?.currentStock + quantity,\n      minimum: product?.minimumStock,\n      maximum: product?.maximumStock\n    };\n  });\n\n  async handleScan(result: ScanResult) {\n    const product = await this.productService.getByBarcode(result.code);\n    this.selectedProduct.set(product);\n    this.receiveForm.patchValue({ productId: product.id });\n    this.currentStep.set('batch');\n  }\n\n  handleBatchSelect(selection: BatchSelection) {\n    const batch = selection.batches[0];\n    this.selectedBatch.set(batch.batch);\n    this.receiveForm.patchValue({ batchNumber: batch.batch.batchNumber });\n    this.currentStep.set('quantity');\n  }\n\n  nextStep() {\n    if (this.currentStep() === 'scan' && this.receiveForm.value.productId) {\n      this.currentStep.set('batch');\n    } else if (this.currentStep() === 'batch' && this.receiveForm.value.batchNumber) {\n      this.currentStep.set('quantity');\n    }\n  }\n}\n```\n\n---\n\n## 6. Testing Strategy\n\n### 6.1 Unit Testing\n\nEach component will have comprehensive unit tests covering:\n\n#### Stock Level Indicator\n```typescript\ndescribe('AxStockLevelComponent', () => {\n  it('should display green color when stock > 75%', () => {\n    component.current.set(400);\n    component.minimum.set(50);\n    component.maximum.set(500);\n    expect(component.colorClass()).toContain('bg-success');\n  });\n\n  it('should show warning badge when stock <= minimum', () => {\n    component.current.set(40);\n    component.minimum.set(50);\n    expect(component.isWarning()).toBe(true);\n  });\n\n  it('should compute correct percentage', () => {\n    component.current.set(250);\n    component.maximum.set(500);\n    expect(component.percentage()).toBe(50);\n  });\n});\n```\n\n#### Barcode Scanner\n```typescript\ndescribe('AxBarcodeScannerComponent', () => {\n  it('should emit scan event with correct format', async () => {\n    const scanSpy = jasmine.createSpy('onScan');\n    component.onScan.subscribe(scanSpy);\n\n    await component.handleScanSuccess({\n      text: '8850999320113',\n      format: BarcodeFormat.EAN_13\n    });\n\n    expect(scanSpy).toHaveBeenCalledWith({\n      code: '8850999320113',\n      format: 'ean13',\n      timestamp: jasmine.any(Date),\n      mode: 'camera'\n    });\n  });\n\n  it('should fallback to manual mode on permission denied', async () => {\n    spyOn(navigator.mediaDevices, 'getUserMedia').and.rejectWith(new Error('Permission denied'));\n\n    await component.initCameraMode();\n\n    expect(component.currentMode()).toBe('manual');\n  });\n});\n```\n\n#### Quantity Input\n```typescript\ndescribe('AxQuantityInputComponent', () => {\n  it('should convert between units correctly', () => {\n    component.baseUnit.set('pieces');\n    component.availableUnits.set([\n      { code: 'pieces', label: 'Pieces', conversionRate: 1, decimalPlaces: 0 },\n      { code: 'box', label: 'Box', conversionRate: 12, decimalPlaces: 0 }\n    ]);\n    component.selectedUnit.set('box');\n\n    component.value.set(144); // 144 pieces\n    expect(component.displayValue()).toBe(12); // 12 boxes\n  });\n\n  it('should validate decimal places', () => {\n    component.decimalPlaces.set(2);\n    component.value.set(10.12345);\n\n    const errors = component.validationErrors();\n    expect(errors.some(e => e.type === 'decimal')).toBe(true);\n  });\n});\n```\n\n#### Batch Selector\n```typescript\ndescribe('AxBatchSelectorComponent', () => {\n  it('should sort batches by FEFO strategy', () => {\n    component.strategy.set('fefo');\n    component.internalBatches.set([\n      { batchNumber: 'B1', expiryDate: new Date('2025-06-01'), ... },\n      { batchNumber: 'B2', expiryDate: new Date('2025-03-01'), ... },\n      { batchNumber: 'B3', expiryDate: new Date('2025-09-01'), ... },\n    ]);\n\n    const sorted = component.sortedBatches();\n    expect(sorted[0].batchNumber).toBe('B2'); // Earliest expiry first\n  });\n\n  it('should mark batch as critical when expiry < 7 days', () => {\n    const batch = {\n      batchNumber: 'B1',\n      expiryDate: new Date(Date.now() + 5 * 24 * 60 * 60 * 1000), // 5 days\n      ...\n    };\n\n    expect(component.getExpiryStatus(batch)).toBe('critical');\n  });\n});\n```\n\n### 6.2 Integration Testing\n\nTest component interactions:\n\n```typescript\ndescribe('Stock Receive Integration', () => {\n  it('should complete full receive flow', async () => {\n    // 1. Scan barcode\n    const scanner = fixture.debugElement.query(By.directive(AxBarcodeScannerComponent));\n    scanner.componentInstance.onScan.emit({\n      code: '8850999320113',\n      format: 'ean13',\n      timestamp: new Date(),\n      mode: 'camera'\n    });\n    fixture.detectChanges();\n\n    // 2. Verify batch selector appears\n    expect(component.currentStep()).toBe('batch');\n\n    // 3. Select batch\n    const batchSelector = fixture.debugElement.query(By.directive(AxBatchSelectorComponent));\n    batchSelector.componentInstance.onSelect.emit({\n      batches: [{ batch: mockBatch, quantity: 100 }],\n      totalQuantity: 100,\n      strategy: 'fefo'\n    });\n    fixture.detectChanges();\n\n    // 4. Verify quantity input appears\n    expect(component.currentStep()).toBe('quantity');\n\n    // 5. Enter quantity\n    const quantityInput = fixture.debugElement.query(By.directive(AxQuantityInputComponent));\n    quantityInput.componentInstance.value.set(100);\n    fixture.detectChanges();\n\n    // 6. Verify stock level preview updates\n    const stockLevel = fixture.debugElement.query(By.directive(AxStockLevelComponent));\n    expect(stockLevel.componentInstance.current()).toBe(mockProduct.currentStock + 100);\n  });\n});\n```\n\n### 6.3 E2E Testing\n\nPlaywright tests for critical flows:\n\n```typescript\ntest('Stock receive with barcode scanning', async ({ page }) => {\n  await page.goto('/inventory/receive');\n\n  // Mock camera permission and barcode scan\n  await page.evaluate(() => {\n    navigator.mediaDevices.getUserMedia = () => Promise.resolve({} as MediaStream);\n  });\n\n  // Trigger scan (in real test, use camera simulation)\n  await page.evaluate(() => {\n    window.dispatchEvent(new CustomEvent('barcode-scan', {\n      detail: { code: '8850999320113', format: 'ean13' }\n    }));\n  });\n\n  // Select batch\n  await page.click('[data-testid=\"batch-card-1\"]');\n  await page.click('button:has-text(\"Select\")');\n\n  // Enter quantity\n  await page.fill('input[aria-label=\"Quantity\"]', '100');\n\n  // Verify preview\n  const stockLevel = await page.textContent('[data-testid=\"stock-level-preview\"]');\n  expect(stockLevel).toContain('200 / 500'); // Assuming current was 100\n\n  // Submit\n  await page.click('button[type=\"submit\"]');\n\n  // Verify success message\n  await expect(page.locator('.toast-success')).toBeVisible();\n});\n```\n\n---\n\n## 7. Performance Optimization\n\n### 7.1 Bundle Size Optimization\n\n- **Lazy loading**: Scanner library loaded only when needed\n  ```typescript\n  const loadScanner = async () => {\n    const { BrowserMultiFormatReader } = await import('@zxing/library');\n    return new BrowserMultiFormatReader();\n  };\n  ```\n\n- **Tree shaking**: Use ES modules for Material components\n- **Code splitting**: Each component in separate lazy-loaded chunk\n- **Target bundle size**: <20KB gzipped per component\n\n### 7.2 Rendering Performance\n\n- **OnPush change detection**: Automatic with signals\n- **Virtual scrolling**: For batch lists >100 items\n  ```typescript\n  <cdk-virtual-scroll-viewport itemSize=\"120\" class=\"batch-list\">\n    @for (batch of filteredBatches(); track batch.batchNumber) {\n      <div class=\"batch-card\">...</div>\n    }\n  </cdk-virtual-scroll-viewport>\n  ```\n\n- **Computed signals**: Prevent unnecessary recalculations\n- **CSS containment**: Isolate repaint regions\n  ```scss\n  .ax-stock-level {\n    contain: layout style paint;\n  }\n  ```\n\n### 7.3 API Optimization\n\n- **Debounced search**: 300ms debounce on batch search\n  ```typescript\n  private searchDebounced = toSignal(\n    toObservable(this.searchTerm).pipe(\n      debounceTime(300),\n      distinctUntilChanged()\n    )\n  );\n  ```\n\n- **Request caching**: Cache batch data for 5 minutes\n- **Pagination**: Load batches in pages of 50\n- **Optimistic updates**: Update UI before API response\n\n---\n\n## 8. Accessibility Compliance\n\nAll components meet WCAG 2.1 AA standards:\n\n### 8.1 Keyboard Navigation\n- All interactive elements focusable with Tab\n- Logical tab order\n- Arrow keys for stepper controls\n- Enter/Space for selection\n- Escape to cancel/close\n\n### 8.2 Screen Reader Support\n- Proper ARIA roles and labels\n- Live regions for dynamic updates\n- Status announcements\n- Error announcements\n- Progress indicators\n\n### 8.3 Visual Accessibility\n- Color contrast ratio â‰¥4.5:1\n- Focus indicators visible\n- Text resizable to 200%\n- No information by color alone\n- Support for high contrast mode\n\n### 8.4 Motion & Animation\n- Respects `prefers-reduced-motion`\n  ```scss\n  @media (prefers-reduced-motion: reduce) {\n    .ax-stock-level__progress-fill {\n      transition: none;\n    }\n  }\n  ```\n\n---\n\n## 9. Browser Compatibility\n\n### 9.1 Target Browsers\n- Chrome/Edge 90+\n- Firefox 88+\n- Safari 14+\n- iOS Safari 14+\n- Chrome Mobile 90+\n\n### 9.2 Polyfills Required\n- **MediaDevices API**: Graceful degradation if unavailable\n- **Web Audio API**: Optional beep sound\n- **CSS Container Queries**: Progressive enhancement\n\n### 9.3 Feature Detection\n```typescript\n// Camera support\nconst hasCameraSupport = 'mediaDevices' in navigator && 'getUserMedia' in navigator.mediaDevices;\n\n// Flashlight support\nconst hasFlashlightSupport = () => {\n  const track = stream.getVideoTracks()[0];\n  return 'torch' in track.getCapabilities();\n};\n\n// Web Audio support\nconst hasAudioSupport = 'AudioContext' in window || 'webkitAudioContext' in window;\n```\n\n---\n\n## 10. Security Considerations\n\n### 10.1 Input Validation\n- Sanitize barcode strings before API calls\n- Validate quantity ranges server-side\n- Prevent XSS in batch number display\n- CSRF tokens in all API requests\n\n### 10.2 Camera Permissions\n- Request permissions only when needed\n- Handle permission denial gracefully\n- Clear explanation of why camera needed\n- No persistent camera access\n\n### 10.3 API Security\n- Authentication headers required\n- Rate limiting on batch queries\n- SQL injection prevention (parameterized queries)\n- HTTPS only in production\n\n---\n\n## 11. Implementation Roadmap\n\n### Phase 1: Foundation (Week 1)\n- Set up component scaffolding\n- Create type definitions\n- Implement base styling system\n- Set up unit test framework\n\n### Phase 2: Stock Level Indicator (Week 1)\n- Implement core logic\n- Add visual design\n- Write unit tests\n- Integration with theme system\n\n### Phase 3: Barcode Scanner (Week 2)\n- Camera integration\n- Manual input fallback\n- Barcode library integration\n- Error handling\n\n### Phase 4: Quantity Input (Week 2)\n- Basic input component\n- Unit conversion logic\n- Stepper controls\n- Forms integration\n\n### Phase 5: Batch Selector (Week 3)\n- API integration\n- Sorting strategies\n- Expiry calculations\n- Multi-select logic\n\n### Phase 6: Integration & Testing (Week 4)\n- Cross-component integration\n- E2E tests\n- Performance optimization\n- Documentation\n\n---\n\n*Design Version: 1.0*\n*Last Updated: 2025-12-18*\n*Status: Awaiting Approval*\n",
  "fileStats": {
    "size": 61199,
    "lines": 1956,
    "lastModified": "2025-12-18T16:23:22.431Z"
  },
  "comments": []
}
