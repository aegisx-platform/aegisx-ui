{
  "id": "snapshot_1765986110269_upka5us78",
  "approvalId": "approval_1765986110239_8unm2olo1",
  "approvalTitle": "AegisX UI Type System Design",
  "version": 1,
  "timestamp": "2025-12-17T15:41:50.269Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Design Document - AegisX UI Type System Improvements\n\n## Overview\n\nThis design document outlines a systematic approach to achieving 100% TypeScript type safety across the @aegisx/ui library. The implementation will eliminate all `any` type usage, centralize type definitions in dedicated files, establish comprehensive JSDoc documentation, and ensure all public types are properly exported through the library's public API.\n\n**Key Objectives:**\n- Eliminate 26 occurrences of `any` type\n- Extract 196+ inline type definitions to dedicated .types.ts files\n- Establish JSDoc documentation standards\n- Create comprehensive type export strategy\n- Maintain 100% backward compatibility\n\n**Timeline:** Phased implementation across multiple iterations\n**Impact:** Improved developer experience, better IDE support, enhanced type safety\n\n## Steering Document Alignment\n\n### Technical Standards (tech.md)\n\nThis design follows the project's established technical standards:\n\n- **TypeScript Strict Mode**: Already enabled in tsconfig.json (strict: true, noImplicitOverride, noImplicitReturns, noFallthroughCasesInSwitch)\n- **Angular Best Practices**: Using Angular 17+ features including standalone components, signals, and strict template checking\n- **Code Organization**: Following the existing barrel export pattern with module-based organization\n- **Documentation Standards**: Extending existing JSDoc practices to achieve comprehensive coverage\n\n### Project Structure (structure.md)\n\nImplementation will follow the existing project structure:\n\n```\nlibs/aegisx-ui/src/lib/\n├── types/              # Global/shared types (existing)\n├── components/         # Component modules with colocated .types.ts files\n├── layouts/            # Layout components with colocated types\n├── services/           # Services with colocated types\n├── widgets/            # Widget system with type definitions\n├── utils/              # Utility functions with proper typing\n└── index.ts            # Main public API with type exports\n```\n\n## Code Reuse Analysis\n\n### Existing Components to Leverage\n\n- **Type Organization Pattern**: Reuse the existing pattern in `widgets/core/widget.types.ts` as a model for comprehensive type files\n  - Well-structured type hierarchies\n  - Clear section comments\n  - Comprehensive JSDoc documentation\n  - Proper const type definitions (e.g., `DASHBOARD_DEFAULTS`)\n\n- **JSDoc Documentation Style**: Extend the pattern used in `types/ax-navigation.types.ts`\n  - Interface descriptions\n  - Property-level documentation\n  - @deprecated tags for legacy properties\n  - Usage examples where helpful\n\n- **Export Strategy**: Build upon the existing barrel export system in `lib/components/index.ts`\n  - Module-based re-exports\n  - Clear categorization by feature area\n  - Legacy compatibility comments\n\n### Integration Points\n\n- **TypeScript Compiler**: No changes to tsconfig.json needed - strict mode is already enabled\n- **Build System**: Nx build pipeline will automatically validate all type improvements\n- **Public API**: All new types will be added to existing export hierarchy through `lib/index.ts`\n- **Existing Code**: All changes maintain backward compatibility - no breaking changes to public APIs\n\n## Architecture\n\n### Overall Design Pattern\n\nThe type system improvements follow a **colocated, modular architecture** where:\n\n1. **Global/Shared Types** → `lib/types/` directory\n   - Theme types, config types, layout types\n   - Types used across multiple feature areas\n\n2. **Feature-Specific Types** → Colocated with implementation\n   - Component types: `component-name.types.ts` next to component file\n   - Service types: `service-name.types.ts` next to service file\n   - Widget types: Already following this pattern\n\n3. **Type Exports** → Hierarchical barrel export system\n   - Module-level index.ts files re-export local types\n   - Top-level index.ts aggregates all public types\n   - Consumers can import from `@aegisx/ui` or specific subpaths\n\n### Modular Design Principles\n\n- **Single File Responsibility**: Each .types.ts file contains types for a specific domain or component\n- **Component Isolation**: Types are colocated with their implementations for better maintainability\n- **Clear Boundaries**: Distinction between internal types (not exported) and public API types\n- **Zero Runtime Impact**: All type improvements are compile-time only\n\n```mermaid\ngraph TD\n    A[@aegisx/ui] --> B[lib/index.ts]\n    B --> C[types/]\n    B --> D[components/]\n    B --> E[widgets/]\n    B --> F[services/]\n\n    C --> C1[config.types.ts]\n    C --> C2[theme.types.ts]\n    C --> C3[navigation.types.ts]\n\n    D --> D1[component-a/]\n    D1 --> D1a[component-a.component.ts]\n    D1 --> D1b[component-a.types.ts]\n    D1 --> D1c[index.ts]\n\n    E --> E1[widget.types.ts]\n    E --> E2[widget-registry.ts]\n\n    F --> F1[service-a/]\n    F1 --> F1a[service-a.service.ts]\n    F1 --> F1b[service-a.types.ts]\n```\n\n## Components and Interfaces\n\n### Component 1: Type File Extractor\n\n**Purpose:** Extract inline type definitions from component files to dedicated .types.ts files\n\n**Process:**\n1. Scan component files for exported `interface`, `type`, and `enum` declarations\n2. Create corresponding `.types.ts` file if it doesn't exist\n3. Move type definitions to the types file with proper JSDoc comments\n4. Update component import statements\n5. Update module index.ts to re-export types\n\n**File Patterns:**\n- Input: `component-name.component.ts` (with inline types)\n- Output: `component-name.types.ts` (extracted types) + updated component\n\n**Reuses:** Existing type extraction patterns from `drawer.component.ts` (which defines types inline but could be extracted)\n\n### Component 2: Any Type Eliminator\n\n**Purpose:** Replace all `any` type usage with proper TypeScript types\n\n**Categories of `any` Usage:**\n\n1. **Generic Object Types** (e.g., `Record<string, any>`)\n   - Replace with: `Record<string, unknown>` or specific interfaces\n   - Example: `datetime.utils.ts` functions\n\n2. **Type Assertions** (e.g., `key as any`)\n   - Replace with: Proper type guards or refined types\n   - Example: `theme-builder.component.ts` theme key types\n\n3. **Timer/Interval Types** (e.g., `progressInterval: any`)\n   - Replace with: `ReturnType<typeof setInterval>` or `NodeJS.Timeout`\n   - Example: `loading-bar.service.ts`\n\n4. **HTTP Params** (e.g., `params as any`)\n   - Replace with: Proper HttpParams types or specific interfaces\n   - Example: `data.provider.ts`\n\n**Reuses:** TypeScript's built-in utility types (ReturnType, Record, etc.)\n\n### Component 3: JSDoc Documentation Generator\n\n**Purpose:** Add comprehensive JSDoc comments to all exported types\n\n**Documentation Standards:**\n```typescript\n/**\n * [Brief one-line description]\n *\n * [Detailed description with usage context]\n *\n * @example\n * ```typescript\n * const config: TypeName = {\n *   property: 'value'\n * };\n * ```\n *\n * @see RelatedType - [when relevant]\n * @deprecated Use NewType instead - [for deprecated types]\n */\nexport interface TypeName {\n  /**\n   * [Property description]\n   * @default defaultValue - [when applicable]\n   */\n  property: string;\n}\n```\n\n**Key Elements:**\n- Interface/type description\n- Property descriptions for non-obvious fields\n- Usage examples for complex types\n- Default value documentation\n- Deprecation notices with migration guidance\n\n**Reuses:** Existing JSDoc patterns from `widget.types.ts` and `ax-navigation.types.ts`\n\n### Component 4: Public API Type Export Manager\n\n**Purpose:** Ensure all public types are properly exported through the library's public API\n\n**Export Hierarchy:**\n```typescript\n// libs/aegisx-ui/src/lib/index.ts\nexport * from './types';           // Global types\nexport * from './components';      // Component types (via barrel)\nexport * from './widgets';         // Widget types\nexport * from './services';        // Service types\n\n// libs/aegisx-ui/src/lib/components/index.ts\nexport * from './drawer';          // Re-exports drawer.types.ts\nexport * from './launcher';        // Re-exports launcher.types.ts\n// ... etc\n\n// libs/aegisx-ui/src/lib/components/drawer/index.ts\nexport * from './drawer.component';\nexport * from './drawer.types';    // Explicit type export\n```\n\n**Benefits:**\n- Consumers can import: `import { DrawerPosition, DrawerSize } from '@aegisx/ui'`\n- Tree-shaking friendly\n- Discoverable via IDE autocomplete\n\n**Reuses:** Existing barrel export pattern\n\n## Data Models\n\n### Type File Structure Model\n\n```typescript\n// component-name.types.ts\n\n// ============================================================================\n// Section: Core Types\n// ============================================================================\n\n/**\n * [Description]\n */\nexport interface ComponentConfig {\n  // properties with JSDoc as needed\n}\n\n/**\n * [Description]\n */\nexport type ComponentVariant = 'default' | 'compact' | 'expanded';\n\n// ============================================================================\n// Section: Event Types\n// ============================================================================\n\n/**\n * [Description]\n */\nexport interface ComponentEvent {\n  // event properties\n}\n\n// ============================================================================\n// Section: Constants\n// ============================================================================\n\n/**\n * Default configuration\n */\nexport const COMPONENT_DEFAULTS = {\n  variant: 'default' as ComponentVariant,\n  // ...\n} as const;\n```\n\n**Key Principles:**\n- Clear section headers with comment blocks\n- Logical grouping of related types\n- Const assertions for literal types\n- Export everything that might be needed by consumers\n\n### Type Replacement Model\n\n**Before:**\n```typescript\n// component.ts\nexport interface ComponentOptions {\n  data: any;  // ❌ any type\n  callback: any;  // ❌ any type\n}\n```\n\n**After:**\n```typescript\n// component.types.ts\n/**\n * Component options configuration\n */\nexport interface ComponentOptions<TData = unknown> {\n  /**\n   * Component data\n   * @template TData - Type of data being passed\n   */\n  data: TData;\n\n  /**\n   * Callback function invoked on data change\n   */\n  callback: (data: TData) => void;\n}\n```\n\n## Error Handling\n\n### Error Scenarios\n\n1. **Breaking Type Changes**\n   - **Handling:** Maintain deprecated type aliases for one major version\n   - **User Impact:** Deprecation warnings in IDE, but code continues to work\n   - **Example:**\n     ```typescript\n     /** @deprecated Use NewType instead */\n     export type OldType = NewType;\n     ```\n\n2. **Missing Type Exports**\n   - **Handling:** Add types to module index.ts and verify via build\n   - **User Impact:** None - types become available\n   - **Detection:** Build-time type checking\n\n3. **Generic Type Complexity**\n   - **Handling:** Provide sensible defaults and helper types\n   - **User Impact:** Can use simple types or opt into advanced generics\n   - **Example:**\n     ```typescript\n     // Simple usage\n     const config: WidgetConfig = { ... };\n\n     // Advanced usage with generics\n     const config: WidgetConfig<CustomData> = { ... };\n     ```\n\n4. **Type Import Path Changes**\n   - **Handling:** Maintain backward-compatible exports at old paths\n   - **User Impact:** None - both old and new paths work\n   - **Migration:** Document new preferred import paths\n\n## Testing Strategy\n\n### Type Testing with tsd\n\nInstall and configure [tsd](https://github.com/SamVerschueren/tsd) for compile-time type testing:\n\n```typescript\n// types.test-d.ts\nimport { expectType, expectError } from 'tsd';\nimport { DrawerPosition, DrawerSize } from '@aegisx/ui';\n\n// Test valid types\nexpectType<DrawerPosition>('left');\nexpectType<DrawerSize>('md');\n\n// Test invalid types\nexpectError<DrawerPosition>('invalid');\n\n// Test generic constraints\nimport { WidgetConfig } from '@aegisx/ui';\ninterface CustomData { value: number; }\nexpectType<WidgetConfig<CustomData>>({\n  data: { value: 42 }\n});\n```\n\n**Coverage Goals:**\n- All exported types have at least one positive test\n- Invalid type usage is tested with expectError\n- Generic type constraints are validated\n\n### Unit Testing\n\n- **No runtime changes** - type improvements are compile-time only\n- **Existing unit tests** - should continue to pass without modification\n- **Build validation** - `pnpm run build` must succeed with no type errors\n\n### Integration Testing\n\n1. **Type Import Validation**\n   - Test that all types can be imported from `@aegisx/ui`\n   - Verify subpath imports work (e.g., `@aegisx/ui/types`)\n\n2. **IDE IntelliSense Testing**\n   - Manual verification that autocomplete works correctly\n   - Type hints show proper JSDoc documentation\n   - Deprecated types show deprecation warnings\n\n3. **Consumer Project Testing**\n   - Create a test Angular project that consumes @aegisx/ui\n   - Verify type safety in component usage\n   - Confirm no breaking changes\n\n### Build Validation\n\n```bash\n# Must pass with zero type errors\npnpm run build\n\n# Type checking only (faster)\npnpm nx run aegisx-ui:type-check\n\n# Type testing with tsd\npnpm run test:types\n```\n\n## Migration Strategy\n\n### Phase 1: Foundation (No Breaking Changes)\n1. Create .types.ts files for components missing them\n2. Add JSDoc documentation to existing types\n3. Export types through public API\n4. Set up tsd for type testing\n\n### Phase 2: Type Safety Improvements (No Breaking Changes)\n1. Replace `any` with `unknown` or proper types\n2. Extract inline types to .types.ts files\n3. Add generic type parameters where beneficial\n4. Update component @Input/@Output type annotations\n\n### Phase 3: Optimization (Potential Breaking Changes)\n1. Rename poorly-named types (with deprecated aliases)\n2. Consolidate duplicate type definitions\n3. Remove truly deprecated/unused types (after deprecation period)\n\n### Backward Compatibility Guarantees\n\n- **All existing imports continue to work** - no import path changes\n- **Deprecated types maintained** - for at least one major version\n- **Type widening only** - making types more specific is okay, making them more generic is breaking\n- **Optional generics** - new generic parameters have defaults\n- **Migration guide** - provided in CHANGELOG.md for any breaking changes\n\n## Documentation Deliverables\n\n1. **Type Catalog** (`docs/type-catalog.md`)\n   - Comprehensive list of all exported types\n   - Organized by category\n   - Usage examples for each type\n\n2. **Migration Guide** (`docs/type-migration.md`)\n   - How to migrate from deprecated types\n   - Updated import paths (if any)\n   - Generic type usage patterns\n\n3. **JSDoc Coverage Report**\n   - List of all documented types\n   - Validation that 100% coverage achieved\n\n4. **CHANGELOG.md Updates**\n   - Document all type improvements\n   - Note any deprecated types\n   - Highlight new type exports\n\n## Success Criteria\n\n✅ **Zero `any` types** in the codebase (except legacy/deprecated code)\n✅ **100% type file coverage** - all components have .types.ts files\n✅ **100% JSDoc coverage** - all exported types documented\n✅ **Complete public API** - all types importable from `@aegisx/ui`\n✅ **Strict mode builds** - library builds with no type errors\n✅ **Type tests passing** - tsd tests validate type correctness\n✅ **Backward compatible** - existing code continues to work\n✅ **Build time** - no more than 10% increase in build duration\n",
  "fileStats": {
    "size": 15306,
    "lines": 477,
    "lastModified": "2025-12-17T15:41:40.302Z"
  },
  "comments": []
}
