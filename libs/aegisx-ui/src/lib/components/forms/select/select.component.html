<div class="ax-select-container">
  <!-- Label -->
  @if (label) {
    <label class="ax-select-label">
      {{ label }}
      @if (required) {
        <span class="ax-select-required">*</span>
      }
    </label>
  }

  <!-- Select Control -->
  <div [class]="wrapperClasses" (click)="toggleDropdown()">
    <!-- Display Area -->
    <div class="ax-select-display">
      <!-- Multiple Mode: Tags -->
      @if (multiple && selectedOptions.length > 0) {
        <div class="ax-select-tags">
          @for (option of visibleTags; track option.value) {
            <span class="ax-select-tag">
              {{ option.label }}
              <button
                type="button"
                class="ax-select-tag-close"
                (click)="removeTag(option, $event)"
                tabindex="-1"
              >
                <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
                  <path
                    d="M10.5 3.5L3.5 10.5M3.5 3.5L10.5 10.5"
                    stroke="currentColor"
                    stroke-width="1.5"
                    stroke-linecap="round"
                  />
                </svg>
              </button>
            </span>
          }
          @if (remainingTagCount > 0) {
            <span class="ax-select-tag ax-select-tag-more">
              +{{ remainingTagCount }}
            </span>
          }
        </div>
      }

      <!-- Single Mode: Selected Label -->
      @if (!multiple && selectedLabel) {
        <span class="ax-select-value">
          {{ selectedLabel }}
        </span>
      }

      <!-- Placeholder -->
      @if (!selectedLabel && (!multiple || selectedOptions.length === 0)) {
        <span class="ax-select-placeholder">
          {{ placeholder }}
        </span>
      }
    </div>

    <!-- Icons & Actions -->
    <div class="ax-select-actions">
      <!-- Clear Button -->
      @if (showClearButton) {
        <button
          type="button"
          class="ax-select-clear"
          (click)="clearValue($event)"
          tabindex="-1"
        >
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
            <path
              d="M12 4L4 12M4 4L12 12"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
            />
          </svg>
        </button>
      }

      <!-- Dropdown Arrow -->
      <div class="ax-select-arrow">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
          <path
            d="M5 7.5L10 12.5L15 7.5"
            stroke="currentColor"
            stroke-width="1.5"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
        </svg>
      </div>
    </div>
  </div>

  <!-- Dropdown Panel -->
  @if (isOpen) {
    <div class="ax-select-dropdown">
      <!-- Search Input -->
      @if (searchable) {
        <div class="ax-select-search">
          <input
            #searchInput
            type="text"
            class="ax-select-search-input"
            placeholder="Search..."
            [(ngModel)]="searchQuery"
            (input)="onSearchInput($event)"
            (click)="$event.stopPropagation()"
          />
        </div>
      }

      <!-- Options List -->
      <div class="ax-select-options">
        <!-- Flat Options -->
        @if (optionGroups.length === 0) {
          @for (option of filteredOptions; track option.value) {
            <div
              class="ax-select-option"
              [class.ax-select-option-selected]="isOptionSelected(option)"
              [class.ax-select-option-disabled]="option.disabled"
              (click)="selectOption(option)"
            >
              <!-- Checkbox for multiple mode -->
              @if (multiple) {
                <span class="ax-select-checkbox">
                  @if (isOptionSelected(option)) {
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                      <path
                        d="M3 8L6.5 11.5L13 5"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      />
                    </svg>
                  }
                </span>
              }

              <!-- Icon -->
              @if (option.icon) {
                <span class="ax-select-option-icon">
                  {{ option.icon }}
                </span>
              }

              <!-- Label & Description -->
              <div class="ax-select-option-content">
                <div class="ax-select-option-label">{{ option.label }}</div>
                @if (option.description) {
                  <div class="ax-select-option-description">
                    {{ option.description }}
                  </div>
                }
              </div>

              <!-- Selected Check (single mode) -->
              @if (!multiple && isOptionSelected(option)) {
                <span class="ax-select-check">
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                    <path
                      d="M3 8L6.5 11.5L13 5"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </span>
              }
            </div>
          }
        }

        <!-- Grouped Options -->
        @if (optionGroups.length > 0) {
          @for (group of filteredOptionGroups; track group.label) {
            <div class="ax-select-group">
              <div class="ax-select-group-label">{{ group.label }}</div>
              @for (option of group.options; track option.value) {
                <div
                  class="ax-select-option"
                  [class.ax-select-option-selected]="isOptionSelected(option)"
                  [class.ax-select-option-disabled]="
                    option.disabled || group.disabled
                  "
                  (click)="selectOption(option)"
                >
                  <!-- Checkbox for multiple mode -->
                  @if (multiple) {
                    <span class="ax-select-checkbox">
                      @if (isOptionSelected(option)) {
                        <svg
                          width="16"
                          height="16"
                          viewBox="0 0 16 16"
                          fill="none"
                        >
                          <path
                            d="M3 8L6.5 11.5L13 5"
                            stroke="currentColor"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                          />
                        </svg>
                      }
                    </span>
                  }

                  <!-- Icon -->
                  @if (option.icon) {
                    <span class="ax-select-option-icon">
                      {{ option.icon }}
                    </span>
                  }

                  <!-- Label & Description -->
                  <div class="ax-select-option-content">
                    <div class="ax-select-option-label">{{ option.label }}</div>
                    @if (option.description) {
                      <div class="ax-select-option-description">
                        {{ option.description }}
                      </div>
                    }
                  </div>

                  <!-- Selected Check (single mode) -->
                  @if (!multiple && isOptionSelected(option)) {
                    <span class="ax-select-check">
                      <svg
                        width="16"
                        height="16"
                        viewBox="0 0 16 16"
                        fill="none"
                      >
                        <path
                          d="M3 8L6.5 11.5L13 5"
                          stroke="currentColor"
                          stroke-width="2"
                          stroke-linecap="round"
                          stroke-linejoin="round"
                        />
                      </svg>
                    </span>
                  }
                </div>
              }
            </div>
          }
        }

        <!-- Empty State -->
        @if (filteredOptions.length === 0) {
          <div class="ax-select-empty">No options found</div>
        }
      </div>
    </div>
  }

  <!-- Helper Text / Error Message -->
  @if (displayMessage) {
    <div class="ax-select-message">
      {{ displayMessage }}
    </div>
  }
</div>
