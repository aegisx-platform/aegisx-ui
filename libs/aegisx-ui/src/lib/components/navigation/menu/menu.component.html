<div class="ax-menu">
  <ng-content select="[trigger]"></ng-content>

  @if (open) {
    <div class="ax-menu-dropdown" role="menu">
      @for (item of items; track trackByIndex($index)) {
        @if (item.divider) {
          <div class="ax-menu-divider" role="separator"></div>
        } @else {
          <div class="ax-menu-item-wrapper">
            <button
              type="button"
              class="ax-menu-item"
              [class.ax-menu-item-disabled]="item.disabled"
              [class.ax-menu-item-has-children]="
                item.children && item.children.length > 0
              "
              (click)="
                item.children && item.children.length > 0
                  ? toggleSubmenu($index, $event)
                  : onItemClick(item, $event)
              "
              [attr.aria-disabled]="item.disabled"
              role="menuitem"
            >
              @if (item.icon) {
                <span class="ax-menu-item-icon">{{ item.icon }}</span>
              }
              <span class="ax-menu-item-label">{{ item.label }}</span>
              @if (item.children && item.children.length > 0) {
                <svg
                  class="ax-menu-item-arrow"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path
                    d="M9 18l6-6-6-6"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                </svg>
              }
            </button>

            @if (
              item.children &&
              item.children.length > 0 &&
              isSubmenuActive($index)
            ) {
              <div class="ax-menu-submenu" role="menu">
                @for (child of item.children; track trackByIndex($index)) {
                  @if (child.divider) {
                    <div class="ax-menu-divider" role="separator"></div>
                  } @else {
                    <button
                      type="button"
                      class="ax-menu-item"
                      [class.ax-menu-item-disabled]="child.disabled"
                      (click)="onItemClick(child, $event)"
                      [attr.aria-disabled]="child.disabled"
                      role="menuitem"
                    >
                      @if (child.icon) {
                        <span class="ax-menu-item-icon">{{ child.icon }}</span>
                      }
                      <span class="ax-menu-item-label">{{ child.label }}</span>
                    </button>
                  }
                }
              </div>
            }
          </div>
        }
      }
    </div>
  }
</div>
