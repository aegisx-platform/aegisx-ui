<div class="ax-timeline__container">
  @for (item of items; track trackByIndex($index); let i = $index) {
    <div
      class="ax-timeline-item"
      [class.ax-timeline-item--left]="getItemAlign(i) === 'left'"
      [class.ax-timeline-item--right]="getItemAlign(i) === 'right'"
    >
      <!-- Opposite Content (for alternate layout) -->
      @if (shouldShowOpposite()) {
        <div class="ax-timeline-item__opposite">
          @if (oppositeTemplate) {
            <ng-container
              *ngTemplateOutlet="
                oppositeTemplate;
                context: { $implicit: item, index: i }
              "
            ></ng-container>
          } @else if (item.opposite) {
            <span class="ax-timeline-item__opposite-text">{{
              item.opposite
            }}</span>
          } @else if (item.timestamp && align === 'alternate') {
            <span class="ax-timeline-item__timestamp">{{
              item.timestamp
            }}</span>
          }
        </div>
      }

      <!-- Separator with Marker -->
      <div class="ax-timeline-item__separator">
        <!-- Connector Line (before marker) -->
        @if (i > 0) {
          <div
            class="ax-timeline-item__connector ax-timeline-item__connector--before"
          ></div>
        }

        <!-- Marker -->
        <div class="ax-timeline-item__marker-wrapper">
          @if (markerTemplate) {
            <ng-container
              *ngTemplateOutlet="
                markerTemplate;
                context: { $implicit: item, index: i }
              "
            ></ng-container>
          } @else {
            <div
              class="ax-timeline-item__marker"
              [style.background-color]="item.color || 'var(--ax-brand-default)'"
            >
              @if (item.icon) {
                <mat-icon class="ax-timeline-item__marker-icon">{{
                  item.icon
                }}</mat-icon>
              }
            </div>
          }
        </div>

        <!-- Connector Line (after marker) -->
        @if (i < items.length - 1) {
          <div
            class="ax-timeline-item__connector ax-timeline-item__connector--after"
          ></div>
        }
      </div>

      <!-- Content -->
      <div class="ax-timeline-item__content">
        @if (contentTemplate) {
          <ng-container
            *ngTemplateOutlet="
              contentTemplate;
              context: { $implicit: item, index: i }
            "
          ></ng-container>
        } @else {
          <div class="ax-timeline-item__title">{{ item.title }}</div>
          @if (item.description) {
            <div class="ax-timeline-item__description">
              {{ item.description }}
            </div>
          }
          @if (item.timestamp && align !== 'alternate') {
            <div class="ax-timeline-item__timestamp">{{ item.timestamp }}</div>
          }
        }
      </div>
    </div>
  }
</div>
