# ‡∏£‡∏∞‡∏ö‡∏ö‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì - Workflow ‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå

**‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏â‡∏ö‡∏±‡∏ö‡∏ô‡∏µ‡πâ:** ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ workflow ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏à‡∏±‡∏î‡∏™‡∏£‡∏£‡∏á‡∏ö‡∏à‡∏ô‡∏ñ‡∏∂‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏á‡∏ö‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°

**‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á:** 18 ‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏° 2025
**‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:** Draft - ‡∏£‡∏≠ Review ‡πÅ‡∏•‡∏∞ Implement

---

## üìã ‡∏™‡∏≤‡∏£‡∏ö‡∏±‡∏ç

1. [‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏° Business Process](#1-‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°-business-process)
2. [Workflow 1: Budget Request & Allocation](#2-workflow-1-budget-request--allocation)
3. [Workflow 2: Budget Planning](#3-workflow-2-budget-planning)
4. [Workflow 3: Purchase Request (PR)](#4-workflow-3-purchase-request-pr)
5. [Workflow 4: Purchase Order (PO)](#5-workflow-4-purchase-order-po)
6. [Workflow 5: Goods Receipt & Inventory](#6-workflow-5-goods-receipt--inventory)
7. [‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á](#7-‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á)

---

## 1. ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏° Business Process

### 1.1 ‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î‡∏´‡∏•‡∏±‡∏Å

**‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡πÉ‡∏ô‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• = ‡∏á‡∏ö‡∏Å‡∏•‡∏≤‡∏á (Central Budget Pool)**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏¢‡∏≤‡∏£‡∏ß‡∏°‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•                         ‚îÇ
‚îÇ                    5,000,000 ‡∏ö‡∏≤‡∏ó/‡∏õ‡∏µ                             ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ   ‡πÑ‡∏°‡πà‡πÅ‡∏ö‡πà‡∏á‡πÅ‡∏¢‡∏Å‡∏£‡∏≤‡∏¢‡πÅ‡∏ú‡∏ô‡∏Å - ‡∏ó‡∏∏‡∏Å‡πÅ‡∏ú‡∏ô‡∏Å‡πÉ‡∏ä‡πâ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô                          ‚îÇ
‚îÇ   ‡∏Ñ‡∏•‡∏±‡∏á‡∏Å‡∏•‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏ã‡∏∑‡πâ‡∏≠‡∏£‡∏ß‡∏°                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ                  ‚îÇ                  ‚îÇ                  ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ ‡πÅ‡∏ú‡∏ô‡∏Å A  ‚îÇ      ‚îÇ  ‡πÅ‡∏ú‡∏ô‡∏Å B   ‚îÇ    ‚îÇ  ‡πÅ‡∏ú‡∏ô‡∏Å C   ‚îÇ    ‚îÇ  ‡πÅ‡∏ú‡∏ô‡∏Å D   ‚îÇ
    ‚îÇ ‡∏≠‡∏≤‡∏¢‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‚îÇ      ‚îÇ  ‡∏®‡∏±‡∏•‡∏¢‡∏Å‡∏£‡∏£‡∏°  ‚îÇ    ‚îÇ  ‡πÄ‡∏†‡∏™‡∏±‡∏ä     ‚îÇ    ‚îÇ  ‡∏´‡πâ‡∏≠‡∏á‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                  ‚îÇ                  ‚îÇ                  ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                  ‚îÇ
                      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                      ‚îÇ   ‡∏Ñ‡∏•‡∏±‡∏á‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏±‡∏î‡∏ã‡∏∑‡πâ‡∏≠‡∏£‡∏ß‡∏°  ‚îÇ
                      ‚îÇ   (Central Warehouse) ‚îÇ
                      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô:**

1. **‡∏á‡∏ö‡∏£‡∏ß‡∏°** - ‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏£‡∏≤‡∏¢‡πÅ‡∏ú‡∏ô‡∏Å ‡πÉ‡∏Ñ‡∏£‡∏Å‡πá‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ
2. **‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ** - ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÅ‡∏ú‡∏ô‡∏Å‡πÉ‡∏ä‡πâ‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏π‡πâ (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏õ‡∏µ‡∏´‡∏ô‡πâ‡∏≤)
3. **‡∏Ñ‡∏•‡∏±‡∏á‡∏Å‡∏•‡∏≤‡∏á‡∏ã‡∏∑‡πâ‡∏≠** - ‡∏à‡∏±‡∏î‡∏ã‡∏∑‡πâ‡∏≠‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• (‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô)
4. **‡πÅ‡∏ö‡πà‡∏á‡∏ï‡∏≤‡∏°‡πÑ‡∏ï‡∏£‡∏°‡∏≤‡∏™** - Q1-Q4 ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÉ‡∏´‡πâ‡∏™‡∏°‡πà‡∏≥‡πÄ‡∏™‡∏°‡∏≠

---

### 1.2 Timeline ‡∏ï‡∏•‡∏≠‡∏î‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì

```
‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì 2568 (1 ‡∏ï.‡∏Ñ. 2567 - 30 ‡∏Å.‡∏¢. 2568)

‡πÄ‡∏î‡∏∑‡∏≠‡∏ô 1-3:    ‡∏Å.‡∏Ñ.-‡∏Å.‡∏¢. 2567    [‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏õ‡∏µ 2568]
              ‚îî‚îÄ> ‡∏™‡∏£‡πâ‡∏≤‡∏á Budget Request
              ‚îî‚îÄ> ‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
              ‚îî‚îÄ> ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏á‡∏ö

Q1:           ‡∏ï.‡∏Ñ.-‡∏ò.‡∏Ñ. 2567    [‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô + ‡∏à‡∏±‡∏î‡∏ã‡∏∑‡πâ‡∏≠ Q1]
              ‚îî‚îÄ> ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏£‡∏≤‡∏¢‡∏¢‡∏≤ (Budget Plan)
              ‚îî‚îÄ> ‡∏™‡∏£‡πâ‡∏≤‡∏á PR/PO ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Q1
              ‚îî‚îÄ> ‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡∏•‡∏±‡∏á

Q2:           ‡∏°.‡∏Ñ.-‡∏°‡∏µ.‡∏Ñ. 2568   [‡∏à‡∏±‡∏î‡∏ã‡∏∑‡πâ‡∏≠ Q2]
              ‚îî‚îÄ> ‡∏™‡∏£‡πâ‡∏≤‡∏á PR/PO ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Q2
              ‚îî‚îÄ> ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏á‡∏ö Q1

Q3:           ‡πÄ‡∏°.‡∏¢.-‡∏°‡∏¥.‡∏¢. 2568  [‡∏à‡∏±‡∏î‡∏ã‡∏∑‡πâ‡∏≠ Q3]
              ‚îî‚îÄ> ‡∏™‡∏£‡πâ‡∏≤‡∏á PR/PO ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Q3
              ‚îî‚îÄ> ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏á‡∏ö Q1-Q2

Q4:           ‡∏Å.‡∏Ñ.-‡∏Å.‡∏¢. 2568    [‡∏à‡∏±‡∏î‡∏ã‡∏∑‡πâ‡∏≠ Q4 + Review]
              ‚îî‚îÄ> ‡∏™‡∏£‡πâ‡∏≤‡∏á PR/PO ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Q4
              ‚îî‚îÄ> ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏á‡∏ö Q1-Q3
              ‚îî‚îÄ> ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏á‡∏ö‡∏õ‡∏µ 2569
```

---

### 1.3 ‡∏ú‡∏π‡πâ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á (Actors)

| ‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó               | ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö                      | Permission                                      |
| ------------------- | ---------------------------------- | ----------------------------------------------- |
| **Finance Manager** | ‡∏à‡∏±‡∏î‡∏™‡∏£‡∏£‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì, ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏á‡∏ö          | `budgetRequests:approve_finance`                |
| **Department Head** | ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏Ç‡∏≠‡∏á‡πÅ‡∏ú‡∏ô‡∏Å                 | `budgetRequests:approve_dept`                   |
| **Pharmacist**      | ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏¢‡∏≤, ‡∏™‡∏£‡πâ‡∏≤‡∏á PR                 | `budgetPlans:create`, `purchaseRequests:create` |
| **Warehouse Staff** | ‡∏™‡∏£‡πâ‡∏≤‡∏á PO, ‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á                   | `purchaseOrders:create`, `inventory:receive`    |
| **System**          | Reserve/Commit/Release ‡∏á‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ | -                                               |

---

## 2. Workflow 1: Budget Request & Allocation

### 2.1 ‡∏à‡∏∏‡∏î‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå

**‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ï‡∏±‡πâ‡∏á‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏£‡∏≤‡∏¢‡∏õ‡∏µ ‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏™‡∏£‡∏£‡∏á‡∏ö‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥**

---

### 2.2 ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô

#### Step 1.1: ‡∏™‡∏£‡πâ‡∏≤‡∏á Budget Request (User: Finance/Pharmacist)

**Input:**

- ‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì (fiscal_year): 2568
- ‡πÅ‡∏ú‡∏ô‡∏Å (department_id): **NULL** (‡∏á‡∏ö‡∏Å‡∏•‡∏≤‡∏á)
- ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏• (justification): "‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏¢‡∏≤‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏õ‡∏µ 2568"

**Action:**

```http
POST /api/inventory/budget/budget-requests
{
  "fiscal_year": 2568,
  "department_id": null,
  "justification": "‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏¢‡∏≤‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏õ‡∏µ 2568 ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏¢‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ~5,000 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£"
}
```

**Database:**

```sql
INSERT INTO inventory.budget_requests (
  request_number,      -- 'BR-2568-001' (auto-generated)
  fiscal_year,         -- 2568
  department_id,       -- NULL (‡∏á‡∏ö‡∏Å‡∏•‡∏≤‡∏á)
  status,              -- 'DRAFT'
  total_requested_amount, -- 0 (‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å items)
  created_by,          -- user_id
  created_at
) VALUES (...);
```

**Output:**

- `budget_requests` record ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ `DRAFT`

---

#### Step 1.2: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏≤ (Add Items)

**Input:**

- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏≤ 5,000 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (import ‡∏à‡∏≤‡∏Å Excel)

**Action:**

```http
POST /api/inventory/budget/budget-requests/1/items
[
  {
    "generic_id": 100,           // Paracetamol 500mg
    "requested_qty": 120000,     // 120,000 ‡πÄ‡∏°‡πá‡∏î
    "unit_price": 2.50,
    "q1_qty": 30000,             // Q1: 30,000 ‡πÄ‡∏°‡πá‡∏î
    "q2_qty": 30000,
    "q3_qty": 30000,
    "q4_qty": 30000,
    "budget_type_id": 1          // ‡∏á‡∏ö‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô
  },
  // ... ‡∏≠‡∏µ‡∏Å 4,999 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
]
```

**Database:**

```sql
INSERT INTO inventory.budget_request_items (
  budget_request_id,   -- 1
  line_number,         -- 1, 2, 3, ...
  generic_id,          -- 100
  requested_qty,       -- 120000
  unit_price,          -- 2.50
  q1_qty, q2_qty, q3_qty, q4_qty,
  budget_type_id,      -- 1
  item_justification
) VALUES (...);

-- ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì total_requested_amount
UPDATE inventory.budget_requests
SET total_requested_amount = (
  SELECT SUM(requested_qty * unit_price)
  FROM budget_request_items
  WHERE budget_request_id = 1
)
WHERE id = 1;
```

**Output:**

- `budget_request_items` 5,000 records
- `total_requested_amount` = 5,000,000 ‡∏ö‡∏≤‡∏ó

---

#### Step 1.3: Submit (‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠)

**Action:**

```http
POST /api/inventory/budget/budget-requests/1/submit
```

**Database:**

```sql
UPDATE inventory.budget_requests
SET status = 'SUBMITTED',
    submitted_by = user_id,
    submitted_at = NOW()
WHERE id = 1;
```

**Output:**

- Status: `DRAFT` ‚Üí `SUBMITTED`

---

#### Step 1.4: Department Approve (‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏ú‡∏ô‡∏Å‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥)

**‚ö†Ô∏è ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:** ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏á‡∏ö‡∏Å‡∏•‡∏≤‡∏á ‡∏≠‡∏≤‡∏à‡∏Ç‡πâ‡∏≤‡∏° step ‡∏ô‡∏µ‡πâ ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏´‡πâ Finance ‡∏ó‡∏≥‡∏ó‡∏±‡πâ‡∏á 2 step

**Action:**

```http
POST /api/inventory/budget/budget-requests/1/approve-dept
{
  "comments": "‡πÄ‡∏´‡πá‡∏ô‡∏ä‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ï‡∏±‡πâ‡∏á‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏¢‡∏≤‡∏õ‡∏µ 2568"
}
```

**Database:**

```sql
UPDATE inventory.budget_requests
SET status = 'DEPT_APPROVED',
    dept_reviewed_by = user_id,
    dept_reviewed_at = NOW(),
    dept_comments = '‡πÄ‡∏´‡πá‡∏ô‡∏ä‡∏≠‡∏ö...'
WHERE id = 1;
```

**Output:**

- Status: `SUBMITTED` ‚Üí `DEPT_APPROVED`

---

#### Step 1.5: Finance Approve (‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥) ‚≠ê **‡∏™‡∏£‡πâ‡∏≤‡∏á Budget Allocations**

**Action:**

```http
POST /api/inventory/budget/budget-requests/1/approve-finance
{
  "comments": "‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏¢‡∏≤‡∏õ‡∏µ 2568 ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô 5,000,000 ‡∏ö‡∏≤‡∏ó"
}
```

**Database Transaction:**

```sql
BEGIN;

-- 1. Update budget request status
UPDATE inventory.budget_requests
SET status = 'FINANCE_APPROVED',
    finance_reviewed_by = user_id,
    finance_reviewed_at = NOW(),
    finance_comments = '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥...'
WHERE id = 1;

-- 2. Fetch all items
SELECT * FROM budget_request_items WHERE budget_request_id = 1;

-- 3. ‡∏™‡∏£‡πâ‡∏≤‡∏á budget_allocations ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
-- (Loop for each item)

FOR EACH item:
  -- ‡∏Å‡∏≥‡∏´‡∏ô‡∏î department_id
  -- ‡∏ñ‡πâ‡∏≤ request.department_id = NULL ‚Üí ‡πÉ‡∏ä‡πâ department_id = 1 (‡∏Ñ‡∏•‡∏±‡∏á‡∏Å‡∏•‡∏≤‡∏á)
  target_department_id = request.department_id || 1;

  -- ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏á‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÑ‡∏ï‡∏£‡∏°‡∏≤‡∏™
  total_amount = item.requested_qty * item.unit_price;
  q1_amount = item.q1_qty * item.unit_price;
  q2_amount = item.q2_qty * item.unit_price;
  q3_amount = item.q3_qty * item.unit_price;
  q4_amount = item.q4_qty * item.unit_price;

  -- UPSERT budget_allocations
  INSERT INTO inventory.budget_allocations (
    fiscal_year,         -- 2568
    budget_id,           -- item.budget_type_id || 1
    department_id,       -- 1 (‡∏Ñ‡∏•‡∏±‡∏á‡∏Å‡∏•‡∏≤‡∏á)
    total_budget,        -- total_amount
    q1_budget,           -- q1_amount
    q2_budget,           -- q2_amount
    q3_budget,           -- q3_amount
    q4_budget,           -- q4_amount
    total_spent,         -- 0
    q1_spent, q2_spent, q3_spent, q4_spent,  -- 0
    remaining_budget,    -- total_amount (‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö total_budget)
    is_active,           -- true
    created_at, updated_at
  ) VALUES (...)
  ON CONFLICT (fiscal_year, budget_id, department_id)
  DO UPDATE SET
    total_budget = budget_allocations.total_budget + EXCLUDED.total_budget,
    q1_budget = budget_allocations.q1_budget + EXCLUDED.q1_budget,
    q2_budget = budget_allocations.q2_budget + EXCLUDED.q2_budget,
    q3_budget = budget_allocations.q3_budget + EXCLUDED.q3_budget,
    q4_budget = budget_allocations.q4_budget + EXCLUDED.q4_budget,
    remaining_budget = budget_allocations.remaining_budget + EXCLUDED.total_budget,
    updated_at = NOW();

COMMIT;
```

**Output:**

- Status: `DEPT_APPROVED` ‚Üí `FINANCE_APPROVED`
- ‡∏™‡∏£‡πâ‡∏≤‡∏á `budget_allocations` record:

```
budget_allocations (example):
‚îú‚îÄ fiscal_year: 2568
‚îú‚îÄ budget_id: 1 (‡∏á‡∏ö‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô)
‚îú‚îÄ department_id: 1 (‡∏Ñ‡∏•‡∏±‡∏á‡∏Å‡∏•‡∏≤‡∏á/‡∏á‡∏ö‡∏£‡∏ß‡∏°)
‚îú‚îÄ total_budget: 5,000,000.00
‚îú‚îÄ q1_budget: 1,250,000.00
‚îú‚îÄ q2_budget: 1,250,000.00
‚îú‚îÄ q3_budget: 1,250,000.00
‚îú‚îÄ q4_budget: 1,250,000.00
‚îú‚îÄ total_spent: 0
‚îú‚îÄ q1_spent: 0
‚îú‚îÄ q2_spent: 0
‚îú‚îÄ q3_spent: 0
‚îú‚îÄ q4_spent: 0
‚îú‚îÄ remaining_budget: 5,000,000.00
‚îî‚îÄ is_active: true
```

---

### 2.3 ‡∏™‡∏£‡∏∏‡∏õ Workflow 1

```
User Input                   Database Tables                    Output
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
1. ‡∏™‡∏£‡πâ‡∏≤‡∏á Request        ‚Üí  budget_requests              ‚Üí  BR-2568-001 (DRAFT)
2. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏≤        ‚Üí  budget_request_items (5,000) ‚Üí  Total: 5M
3. Submit              ‚Üí  budget_requests (SUBMITTED)   ‚Üí  ‡∏£‡∏≠ Approve
4. Dept Approve        ‚Üí  budget_requests (DEPT_APPROVED) ‚Üí ‡∏£‡∏≠ Finance
5. Finance Approve     ‚Üí  budget_requests (FINANCE_APPROVED)
                       ‚Üí  budget_allocations (create!)  ‚Üí  ‡∏á‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
```

**‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á Finance Approve:**

- ‚úÖ ‡∏á‡∏ö‡∏ñ‡∏π‡∏Å‡∏à‡∏±‡∏î‡∏™‡∏£‡∏£‡πÅ‡∏•‡πâ‡∏ß (allocations created)
- ‚úÖ ‡∏á‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (remaining_budget = total_budget)
- ‚úÖ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á PR/PO ‡πÑ‡∏î‡πâ

---

## 3. Workflow 2: Budget Planning

### 3.1 ‡∏à‡∏∏‡∏î‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå

**‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏¢‡∏≤ - ‡∏ß‡πà‡∏≤‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏¢‡∏≤‡∏à‡∏∞‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà ‡πÑ‡∏ï‡∏£‡∏°‡∏≤‡∏™‡πÑ‡∏´‡∏ô**

---

### 3.2 ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô

#### Step 2.1: ‡∏™‡∏£‡πâ‡∏≤‡∏á Budget Plan (User: Pharmacist)

**Input:**

- ‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì: 2568
- ‡πÅ‡∏ú‡∏ô‡∏Å: 1 (‡∏Ñ‡∏•‡∏±‡∏á‡∏Å‡∏•‡∏≤‡∏á)
- ‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏ú‡∏ô: "‡πÅ‡∏ú‡∏ô‡∏à‡∏±‡∏î‡∏ã‡∏∑‡πâ‡∏≠‡∏¢‡∏≤‡∏õ‡∏µ 2568"

**Action:**

```http
POST /api/inventory/budget/budget-plans
{
  "fiscal_year": 2568,
  "department_id": 1,  // ‡∏Ñ‡∏•‡∏±‡∏á‡∏Å‡∏•‡∏≤‡∏á
  "plan_name": "‡πÅ‡∏ú‡∏ô‡∏à‡∏±‡∏î‡∏ã‡∏∑‡πâ‡∏≠‡∏¢‡∏≤‡∏õ‡∏µ 2568",
  "notes": "‡πÅ‡∏ú‡∏ô‡∏à‡∏±‡∏î‡∏ã‡∏∑‡πâ‡∏≠‡∏¢‡∏≤‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°‡∏ó‡∏∏‡∏Å‡πÅ‡∏ú‡∏ô‡∏Å"
}
```

**Database:**

```sql
INSERT INTO inventory.budget_plans (
  fiscal_year,         -- 2568
  department_id,       -- 1
  plan_name,           -- "‡πÅ‡∏ú‡∏ô‡∏à‡∏±‡∏î‡∏ã‡∏∑‡πâ‡∏≠‡∏¢‡∏≤‡∏õ‡∏µ 2568"
  total_planned_amount,-- 0 (‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å items)
  status,              -- 'DRAFT'
  created_by
) VALUES (...);
```

---

#### Step 2.2: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏≤ (Add Plan Items)

**Input:**

- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏≤ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á 3 ‡∏õ‡∏µ

**Action:**

```http
POST /api/inventory/budget/budget-plans/1/items
[
  {
    "generic_id": 100,              // Paracetamol 500mg
    "last_year_qty": 115000,        // ‡∏õ‡∏µ 2567 ‡πÉ‡∏ä‡πâ 115,000
    "two_years_ago_qty": 110000,    // ‡∏õ‡∏µ 2566 ‡πÉ‡∏ä‡πâ 110,000
    "three_years_ago_qty": 105000,  // ‡∏õ‡∏µ 2565 ‡πÉ‡∏ä‡πâ 105,000
    "planned_quantity": 120000,     // ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏ã‡∏∑‡πâ‡∏≠ 120,000
    "estimated_unit_price": 2.50,
    "total_planned_value": 300000,  // 120,000 √ó 2.50
    "q1_planned_qty": 30000,
    "q2_planned_qty": 30000,
    "q3_planned_qty": 30000,
    "q4_planned_qty": 30000
  },
  // ... ‡∏≠‡∏µ‡∏Å 4,999 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
]
```

**Database:**

```sql
INSERT INTO inventory.budget_plan_items (
  budget_plan_id,
  generic_id,
  last_year_qty,
  two_years_ago_qty,
  three_years_ago_qty,
  planned_quantity,
  estimated_unit_price,
  total_planned_value,
  q1_planned_qty,
  q2_planned_qty,
  q3_planned_qty,
  q4_planned_qty,
  total_purchased_qty,      -- 0 (‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ã‡∏∑‡πâ‡∏≠)
  total_purchased_value,    -- 0
  q1_purchased_qty,         -- 0
  q2_purchased_qty,         -- 0
  q3_purchased_qty,         -- 0
  q4_purchased_qty          -- 0
) VALUES (...);
```

---

#### Step 2.3: Submit & Approve

**Action:**

```http
POST /api/inventory/budget/budget-plans/1/submit
POST /api/inventory/budget/budget-plans/1/approve
```

**Database:**

```sql
UPDATE inventory.budget_plans
SET status = 'APPROVED',
    approved_by = user_id,
    approved_at = NOW()
WHERE id = 1;
```

**Output:**

- Status: `DRAFT` ‚Üí `SUBMITTED` ‚Üí `APPROVED`

---

### 3.3 ‡∏™‡∏£‡∏∏‡∏õ Workflow 2

```
User Input                   Database Tables                    Output
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
1. ‡∏™‡∏£‡πâ‡∏≤‡∏á Plan          ‚Üí  budget_plans                  ‚Üí  Plan-2568-001
2. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏¢‡∏≤ + ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥   ‚Üí  budget_plan_items (5,000)    ‚Üí  Total: 4.8M
3. Approve             ‚Üí  budget_plans (APPROVED)       ‚Üí  ‡πÅ‡∏ú‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
```

**‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡∏Ç‡∏≠‡∏á Budget Plan:**

- ‚úÖ ‡πÄ‡∏´‡πá‡∏ô‡∏†‡∏≤‡∏û historical consumption (3 ‡∏õ‡∏µ‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á)
- ‚úÖ ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏à‡∏±‡∏î‡∏ã‡∏∑‡πâ‡∏≠‡πÑ‡∏î‡πâ‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥
- ‚úÖ ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ß‡πà‡∏≤‡∏ã‡∏∑‡πâ‡∏≠‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà (purchased vs planned)

---

## 4. Workflow 3: Purchase Request (PR)

### 4.1 ‡∏à‡∏∏‡∏î‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå

**‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏à‡∏±‡∏î‡∏ã‡∏∑‡πâ‡∏≠‡∏¢‡∏≤ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏à‡∏≠‡∏á‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß**

---

### 4.2 ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô (‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô vs ‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡πÄ‡∏õ‡πá‡∏ô)

#### Step 3.1: ‡∏™‡∏£‡πâ‡∏≤‡∏á PR (User: Pharmacist/Warehouse)

**Input:**

- ‡∏¢‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£: Amoxicillin 500mg
- ‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì: 5,000 ‡πÅ‡∏Ñ‡∏õ‡∏ã‡∏π‡∏•
- ‡πÑ‡∏ï‡∏£‡∏°‡∏≤‡∏™: Q1

**Action:**

```http
POST /api/inventory/purchase-requests
{
  "pr_number": "PR-2568-Q1-001",  // auto-generated
  "fiscal_year": 2568,
  "department_id": 5,              // ‡πÅ‡∏ú‡∏ô‡∏Å‡πÄ‡∏†‡∏™‡∏±‡∏ä (‡∏Ñ‡∏ô‡∏Ç‡∏≠‡∏ã‡∏∑‡πâ‡∏≠)
  "budget_id": 1,                  // ‡∏á‡∏ö‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô
  "required_date": "2024-11-15",
  "purpose": "‡∏à‡∏±‡∏î‡∏ã‡∏∑‡πâ‡∏≠‡∏¢‡∏≤‡πÑ‡∏ï‡∏£‡∏°‡∏≤‡∏™ 1",
  "items": [
    {
      "generic_id": 101,           // Amoxicillin 500mg
      "quantity": 5000,
      "unit": "CAP",
      "estimated_unit_price": 15.00,
      "estimated_total": 75000.00
    }
  ]
}
```

---

#### Step 3.2: ‚úÖ **‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏á‡∏ö** (‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥ - ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ!)

**Database Function (‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á):**

```sql
SELECT * FROM check_budget_availability(
  2568,        -- fiscal_year
  1,           -- budget_id
  1,           -- department_id (‡∏Ñ‡∏•‡∏±‡∏á‡∏Å‡∏•‡∏≤‡∏á)
  75000.00,    -- amount
  1            -- quarter (Q1)
);
```

**Logic:**

```sql
-- ‡∏î‡∏∂‡∏á‡∏á‡∏ö‡πÑ‡∏ï‡∏£‡∏°‡∏≤‡∏™ Q1
SELECT q1_budget, q1_spent FROM budget_allocations
WHERE fiscal_year = 2568
  AND budget_id = 1
  AND department_id = 1;

-- ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:
q1_budget: 1,250,000.00
q1_spent: 0

-- ‡∏î‡∏∂‡∏á active reservations ‡πÉ‡∏ô Q1
SELECT COALESCE(SUM(reserved_amount), 0) FROM budget_reservations
WHERE allocation_id = (
  SELECT id FROM budget_allocations
  WHERE fiscal_year = 2568 AND budget_id = 1 AND department_id = 1
)
AND status = 'active'
AND quarter = 1;

-- ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:
reserved: 0

-- ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì available
available = q1_budget - q1_spent - reserved
          = 1,250,000 - 0 - 0
          = 1,250,000.00

-- ‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≠
requested = 75,000.00

-- Result:
available >= requested ‚Üí TRUE (‡∏°‡∏µ‡∏á‡∏ö‡∏û‡∏≠)
remaining = 1,250,000 - 75,000 = 1,175,000.00
```

**Output:**

```json
{
  "available": true,
  "remaining": 1175000.0
}
```

---

#### Step 3.3: ‚úÖ **‡∏à‡∏≠‡∏á‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì** (‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥ - ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ!)

**Database Transaction:**

```sql
BEGIN;

-- 1. ‡∏™‡∏£‡πâ‡∏≤‡∏á PR
INSERT INTO inventory.purchase_requests (
  pr_number, fiscal_year, department_id, budget_id,
  total_amount, status, requested_by
) VALUES (
  'PR-2568-Q1-001', 2568, 5, 1,
  75000.00, 'SUBMITTED', user_id
) RETURNING id; -- id = 1

-- 2. ‡∏™‡∏£‡πâ‡∏≤‡∏á PR Items
INSERT INTO inventory.purchase_request_items (
  pr_id, generic_id, quantity, estimated_unit_price, estimated_total
) VALUES (1, 101, 5000, 15.00, 75000.00);

-- 3. ‡∏à‡∏≠‡∏á‡∏á‡∏ö (Reserve Budget)
INSERT INTO inventory.budget_reservations (
  allocation_id,       -- (SELECT id FROM budget_allocations WHERE ...)
  pr_id,               -- 1
  reserved_amount,     -- 75000.00
  quarter,             -- 1
  reservation_date,    -- NOW()
  expires_date,        -- NOW() + INTERVAL '30 days'
  is_released,         -- false
  released_at          -- NULL
) VALUES (...);

COMMIT;
```

**Output:**

```
budget_reservations:
‚îú‚îÄ allocation_id: 1
‚îú‚îÄ pr_id: 1
‚îú‚îÄ reserved_amount: 75,000.00
‚îú‚îÄ quarter: 1
‚îú‚îÄ reservation_date: 2024-10-15
‚îú‚îÄ expires_date: 2024-11-14 (30 ‡∏ß‡∏±‡∏ô)
‚îú‚îÄ is_released: false
‚îî‚îÄ released_at: NULL
```

**‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≠‡∏á:**

```
Available (Q1) = q1_budget - q1_spent - reserved
               = 1,250,000 - 0 - 75,000
               = 1,175,000.00 ‡∏ö‡∏≤‡∏ó
```

---

#### Step 3.4: ‡∏ñ‡πâ‡∏≤ PR Rejected ‚Üí Release Budget

**Action:**

```http
POST /api/inventory/purchase-requests/1/reject
{
  "reason": "‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏π‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏à‡∏£‡∏à‡∏≤‡πÉ‡∏´‡∏°‡πà"
}
```

**Database Transaction (‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥ - ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ!):**

```sql
BEGIN;

-- 1. Update PR status
UPDATE inventory.purchase_requests
SET status = 'REJECTED',
    rejected_by = user_id,
    rejected_at = NOW(),
    rejection_reason = '‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏π‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ...'
WHERE id = 1;

-- 2. Release reservation
UPDATE inventory.budget_reservations
SET is_released = true,
    released_at = NOW()
WHERE pr_id = 1
  AND is_released = false;

COMMIT;
```

**Output:**

- PR status ‚Üí `REJECTED`
- Reservation ‚Üí `is_released = true`
- ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ (available ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô 75,000)

---

### 4.3 ‡∏™‡∏£‡∏∏‡∏õ Workflow 3

| Step                 | ‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô | ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏õ‡πá‡∏ô   | Status    |
| -------------------- | ------------ | --------- | --------- |
| 1. ‡∏™‡∏£‡πâ‡∏≤‡∏á PR          | ‚úÖ ‡∏°‡∏µ        | ‚úÖ        | ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ |
| 2. Check Budget      | ‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ     | ‚úÖ ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ | ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏° |
| 3. Reserve Budget    | ‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ     | ‚úÖ ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ | ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏° |
| 4. Release on Reject | ‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ     | ‚úÖ ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ | ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏° |

**‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏î:**

1. ‚ùå Database function: `check_budget_availability()`
2. ‚ùå Logic: Reserve budget ‡∏´‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á PR
3. ‚ùå Logic: Release budget ‡πÄ‡∏°‡∏∑‡πà‡∏≠ reject PR
4. ‚ùå Validation: ‡∏´‡πâ‡∏≤‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á PR ‡∏ñ‡πâ‡∏≤‡∏á‡∏ö‡πÑ‡∏°‡πà‡∏û‡∏≠

---

## 5. Workflow 4: Purchase Order (PO)

### 5.1 ‡∏à‡∏∏‡∏î‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå

**‡∏™‡∏£‡πâ‡∏≤‡∏á PO ‡∏à‡∏≤‡∏Å PR ‡∏ó‡∏µ‡πà approved ‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏î‡∏á‡∏ö‡∏à‡∏£‡∏¥‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠ PO approved**

---

### 5.2 ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô

#### Step 4.1: ‡∏™‡∏£‡πâ‡∏≤‡∏á PO ‡∏à‡∏≤‡∏Å PR (User: Warehouse)

**Action:**

```http
POST /api/inventory/purchase-orders
{
  "po_number": "PO-2568-Q1-001",  // auto-generated
  "pr_id": 1,                      // Reference to PR
  "vendor_id": 100,                // ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏¢‡∏≤ ABC ‡∏à‡∏≥‡∏Å‡∏±‡∏î
  "po_date": "2024-10-20",
  "delivery_date": "2024-11-15",
  "payment_terms": "NET30",
  "items": [
    {
      "pr_item_id": 1,
      "generic_id": 101,
      "quantity": 5000,
      "unit_price": 14.50,         // ‡∏ï‡πà‡∏≠‡∏£‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏Å‡∏ß‡πà‡∏≤! (‡∏à‡∏≤‡∏Å 15.00)
      "discount_percent": 5,
      "discount_amount": 3625,
      "total_price": 68875.00      // (5000 √ó 14.50) - 3625
    }
  ],
  "total_amount": 68875.00,
  "vat_amount": 4821.25,           // 7%
  "grand_total": 73696.25
}
```

**Database:**

```sql
INSERT INTO inventory.purchase_orders (
  po_number, pr_id, vendor_id, po_date, delivery_date,
  total_amount, vat_amount, grand_total,
  status, payment_terms
) VALUES (
  'PO-2568-Q1-001', 1, 100, '2024-10-20', '2024-11-15',
  68875.00, 4821.25, 73696.25,
  'DRAFT', 'NET30'
);
```

---

#### Step 4.2: ‚úÖ **Approve PO ‚Üí Commit Budget** (‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥ - ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ!)

**Action:**

```http
POST /api/inventory/purchase-orders/1/approve
```

**Database Transaction (‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥):**

```sql
BEGIN;

-- 1. Update PO status
UPDATE inventory.purchase_orders
SET status = 'APPROVED',
    approved_by = user_id,
    approved_at = NOW()
WHERE id = 1;

-- 2. ‡∏´‡∏≤ allocation ‡πÅ‡∏•‡∏∞ reservation
SELECT ba.id as allocation_id,
       br.id as reservation_id,
       br.reserved_amount
FROM budget_reservations br
JOIN budget_allocations ba ON ba.id = br.allocation_id
WHERE br.pr_id = 1
  AND br.is_released = false;

-- 3. ‡∏ï‡∏±‡∏î‡∏á‡∏ö‡∏à‡∏£‡∏¥‡∏á (Commit Budget)
-- ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÑ‡∏ï‡∏£‡∏°‡∏≤‡∏™
quarter = EXTRACT(QUARTER FROM po_date);  -- Q1 = 1

-- Update budget allocation
UPDATE inventory.budget_allocations
SET q1_spent = q1_spent + 68875.00,      -- ‡∏ï‡∏±‡∏î‡∏á‡∏ö Q1
    total_spent = total_spent + 68875.00,
    remaining_budget = remaining_budget - 68875.00,
    updated_at = NOW()
WHERE id = allocation_id;

-- 4. Release reservation (‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞)
UPDATE inventory.budget_reservations
SET is_released = true,
    released_at = NOW()
WHERE id = reservation_id;

-- 5. ‡∏Ñ‡∏∑‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ï‡πà‡∏≤‡∏á (‡∏ñ‡πâ‡∏≤‡∏£‡∏≤‡∏Ñ‡∏≤‡∏à‡∏£‡∏¥‡∏á‡∏ñ‡∏π‡∏Å‡∏Å‡∏ß‡πà‡∏≤)
-- Reserved: 75,000.00
-- Actual: 68,875.00
-- Refund: 6,125.00
UPDATE inventory.budget_allocations
SET q1_spent = q1_spent - 6125.00,
    total_spent = total_spent - 6125.00,
    remaining_budget = remaining_budget + 6125.00
WHERE id = allocation_id;

-- Final spent:
-- q1_spent = 68875 - 6125 = 62750 ‚ùå ‡∏ú‡∏¥‡∏î!
-- ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏õ‡πá‡∏ô: q1_spent = 68875 (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏∑‡∏ô ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÄ‡∏£‡∏≤‡∏ï‡∏±‡∏î‡∏ï‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á)

-- ‚úÖ ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á: ‡∏ï‡∏±‡∏î‡∏ï‡∏≤‡∏°‡∏£‡∏≤‡∏Ñ‡∏≤‡∏à‡∏£‡∏¥‡∏á‡πÄ‡∏•‡∏¢ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏∑‡∏ô
UPDATE inventory.budget_allocations
SET q1_spent = q1_spent + 68875.00,
    total_spent = total_spent + 68875.00,
    remaining_budget = total_budget - total_spent
WHERE id = allocation_id;

COMMIT;
```

**‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:** ‡∏ï‡∏±‡∏î‡∏á‡∏ö‡∏ï‡∏≤‡∏° **PO Amount ‡∏à‡∏£‡∏¥‡∏á** ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏ï‡∏≤‡∏° Reserved Amount

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:**

```
‡∏Å‡πà‡∏≠‡∏ô Approve PO:
  q1_budget: 1,250,000.00
  q1_spent: 0
  remaining_budget: 5,000,000.00
  reserved (active): 75,000.00

‡∏´‡∏•‡∏±‡∏á Approve PO:
  q1_budget: 1,250,000.00
  q1_spent: 68,875.00          ‚Üê ‡∏ï‡∏±‡∏î‡∏á‡∏ö‡∏à‡∏£‡∏¥‡∏á
  remaining_budget: 4,931,125.00
  reserved (active): 0         ‚Üê ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ‡πÅ‡∏•‡πâ‡∏ß
```

---

#### Step 4.3: ‚úÖ **Update Budget Plan** (‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥ - ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ!)

**Database (‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥‡πÉ‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö commit budget):**

```sql
-- ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï purchased quantity ‡πÉ‡∏ô budget_plan_items
UPDATE inventory.budget_plan_items
SET q1_purchased_qty = q1_purchased_qty + 5000,
    total_purchased_qty = total_purchased_qty + 5000,
    total_purchased_value = total_purchased_value + 68875.00,
    updated_at = NOW()
WHERE budget_plan_id = 1
  AND generic_id = 101;
```

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:**

```
budget_plan_items (Amoxicillin):
  planned_quantity: 5,000
  q1_planned_qty: 1,250
  q1_purchased_qty: 5,000 ‚úÖ (‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏Å‡∏¥‡∏ô‡πÅ‡∏ú‡∏ô Q1!)
  total_purchased_qty: 5,000
  total_purchased_value: 68,875.00 (‡∏ñ‡∏π‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£!)
```

---

### 5.3 ‡∏™‡∏£‡∏∏‡∏õ Workflow 4

| Step                   | ‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô | ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏õ‡πá‡∏ô   | Status    |
| ---------------------- | ------------ | --------- | --------- |
| 1. ‡∏™‡∏£‡πâ‡∏≤‡∏á PO            | ‚úÖ ‡∏°‡∏µ        | ‚úÖ        | ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ |
| 2. Approve PO          | ‚úÖ ‡∏°‡∏µ        | ‚úÖ        | ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ |
| 3. Commit Budget       | ‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ     | ‚úÖ ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ | ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏° |
| 4. Release Reservation | ‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ     | ‚úÖ ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ | ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏° |
| 5. Update Plan         | ‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ     | ‚úÖ ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ | ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏° |

**‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏î:**

1. ‚ùå Logic: Commit budget ‡∏´‡∏•‡∏±‡∏á PO approved
2. ‚ùå Logic: Release reservation
3. ‚ùå Logic: Update budget_plan_items
4. ‚ùå Validation: ‡∏´‡πâ‡∏≤‡∏° approve PO ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ reservation

---

## 6. Workflow 5: Goods Receipt & Inventory

### 6.1 ‡∏à‡∏∏‡∏î‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå

**‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡∏•‡∏±‡∏á ‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ï‡πá‡∏≠‡∏Å (‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏á‡∏ö‡πÅ‡∏•‡πâ‡∏ß)**

---

### 6.2 ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô

**Action:**

```http
POST /api/inventory/transactions
{
  "transaction_type": "RECEIVE",
  "po_id": 1,
  "items": [
    {
      "generic_id": 101,
      "quantity": 5000,
      "unit_price": 14.50,
      "lot_number": "LOT2024-001",
      "expiry_date": "2026-10-01"
    }
  ]
}
```

**Database:**

```sql
-- ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ï‡πá‡∏≠‡∏Å
UPDATE inventory.drug_stocks
SET quantity = quantity + 5000,
    last_received_date = NOW()
WHERE generic_id = 101;

-- ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å transaction
INSERT INTO inventory.inventory_transactions (
  transaction_type, po_id, generic_id, quantity, unit_price
) VALUES ('RECEIVE', 1, 101, 5000, 14.50);
```

---

## 7. ‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á

### 7.1 ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

| ‡∏ï‡∏≤‡∏£‡∏≤‡∏á                  | ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞          | ‡∏õ‡∏±‡∏ç‡∏´‡∏≤                   | ‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç                      |
| ---------------------- | -------------- | ----------------------- | -------------------------------- |
| `budget_requests`      | ‚úÖ ‡∏û‡∏£‡πâ‡∏≠‡∏°       | -                       | -                                |
| `budget_request_items` | ‚úÖ ‡∏û‡∏£‡πâ‡∏≠‡∏°       | -                       | -                                |
| `budget_allocations`   | ‚úÖ ‡∏û‡∏£‡πâ‡∏≠‡∏°       | -                       | -                                |
| `budget_plans`         | ‚úÖ ‡∏û‡∏£‡πâ‡∏≠‡∏°       | -                       | -                                |
| `budget_plan_items`    | ‚úÖ ‡∏û‡∏£‡πâ‡∏≠‡∏°       | -                       | -                                |
| `budget_reservations`  | ‚ö†Ô∏è ‡∏°‡∏µ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ | Schema ‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á functions | ‡πÅ‡∏Å‡πâ schema ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà |
| `purchase_requests`    | ‚úÖ ‡∏û‡∏£‡πâ‡∏≠‡∏°       | -                       | -                                |
| `purchase_orders`      | ‚úÖ ‡∏û‡∏£‡πâ‡∏≠‡∏°       | -                       | -                                |

---

### 7.2 Database Functions ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á

| Function                              | Purpose                | Priority   |
| ------------------------------------- | ---------------------- | ---------- |
| `check_budget_availability()`         | ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏á‡∏ö‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠       | üî¥ ‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å  |
| `reserve_budget()`                    | ‡∏à‡∏≠‡∏á‡∏á‡∏ö‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á PR     | üî¥ ‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å  |
| `commit_budget()`                     | ‡∏ï‡∏±‡∏î‡∏á‡∏ö‡πÄ‡∏°‡∏∑‡πà‡∏≠ PO approved | üî¥ ‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å  |
| `release_budget_reservation()`        | ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ‡∏á‡∏ö              | üî¥ ‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å  |
| `auto_release_expired_reservations()` | Auto-release ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏   | üü° ‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á |

---

### 7.3 Application Hooks ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°

| Event           | Current        | Should Be                                                 | File                           |
| --------------- | -------------- | --------------------------------------------------------- | ------------------------------ |
| **PR Created**  | ‡∏™‡∏£‡πâ‡∏≤‡∏á PR ‡πÄ‡∏â‡∏¢‡πÜ  | + Check budget<br>+ Reserve budget                        | `purchase-requests.service.ts` |
| **PR Approved** | ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô status | (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°)                                              | -                              |
| **PR Rejected** | ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô status | + Release budget                                          | `purchase-requests.service.ts` |
| **PO Approved** | ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô status | + Commit budget<br>+ Release reservation<br>+ Update plan | `purchase-orders.service.ts`   |

---

### 7.4 Validations ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°

| Validation                    | Current    | Should Be             |
| ----------------------------- | ---------- | --------------------- |
| ‡∏™‡∏£‡πâ‡∏≤‡∏á PR ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏á‡∏ö‡∏û‡∏≠           | ‚ùå ‡πÑ‡∏°‡πà‡πÄ‡∏ä‡πá‡∏Ñ | ‚úÖ ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Å‡πà‡∏≠‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á      |
| Approve PO ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ reservation | ‚ùå ‡πÑ‡∏°‡πà‡πÄ‡∏ä‡πá‡∏Ñ | ‚úÖ ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Å‡πà‡∏≠‡∏ô approve   |
| ‡∏¢‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô budget plan      | ‚ùå ‡πÑ‡∏°‡πà‡πÄ‡∏ä‡πá‡∏Ñ | üü° Optional (warning) |
| ‡πÑ‡∏ï‡∏£‡∏°‡∏≤‡∏™‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏á‡∏ö‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠         | ‚ùå ‡πÑ‡∏°‡πà‡πÄ‡∏ä‡πá‡∏Ñ | ‚úÖ ‡πÄ‡∏ä‡πá‡∏Ñ‡πÅ‡∏¢‡∏Å‡∏£‡∏≤‡∏¢‡πÑ‡∏ï‡∏£‡∏°‡∏≤‡∏™   |

---

### 7.5 Monitoring & Alerts

| Feature              | Current  | Should Be               | Priority   |
| -------------------- | -------- | ----------------------- | ---------- |
| Budget Dashboard     | ‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ | ‚úÖ ‡πÅ‡∏™‡∏î‡∏á utilization     | üü° ‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á |
| Active Reservations  | ‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ | ‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà | üü° ‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á |
| Budget > 80% Alert   | ‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ | ‚úÖ ‡∏™‡πà‡∏á notification     | üü¢ ‡∏ï‡πà‡∏≥     |
| Expired Reservations | ‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ | ‚úÖ Cron job ‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏á‡∏ö     | üü° ‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á |

---

### 7.6 ‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤ (Implementation Plan)

#### Phase 1: ‡πÅ‡∏Å‡πâ Schema & Functions (3-5 ‡∏ß‡∏±‡∏ô)

**‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô:**

1. ‡πÅ‡∏Å‡πâ `budget_reservations` schema ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö functions
2. ‡∏™‡∏£‡πâ‡∏≤‡∏á 5 database functions
3. Test functions

**Deliverables:**

- Migration script
- Function SQL files
- Unit tests

---

#### Phase 2: ‡πÄ‡∏û‡∏¥‡πà‡∏° Application Hooks (3-5 ‡∏ß‡∏±‡∏ô)

**‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô:**

1. ‡πÄ‡∏û‡∏¥‡πà‡∏° reserve logic ‡πÉ‡∏ô PR service
2. ‡πÄ‡∏û‡∏¥‡πà‡∏° commit logic ‡πÉ‡∏ô PO service
3. ‡πÄ‡∏û‡∏¥‡πà‡∏° release logic ‡πÉ‡∏ô PR reject
4. Test workflow end-to-end

**Deliverables:**

- Updated services
- Integration tests
- API documentation

---

#### Phase 3: Monitoring & Cron Jobs (2-3 ‡∏ß‡∏±‡∏ô)

**‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô:**

1. ‡∏™‡∏£‡πâ‡∏≤‡∏á budget dashboard API
2. ‡πÄ‡∏û‡∏¥‡πà‡∏° cron job auto-release
3. ‡πÄ‡∏û‡∏¥‡πà‡∏° alert system

**Deliverables:**

- Dashboard APIs
- Cron job scripts
- Alert configurations

---

## 8. ‡∏†‡∏≤‡∏Ñ‡∏ú‡∏ô‡∏ß‡∏Å

### 8.1 Example: Complete Flow (End-to-End)

**Scenario:** ‡∏à‡∏±‡∏î‡∏ã‡∏∑‡πâ‡∏≠‡∏¢‡∏≤ Amoxicillin 5,000 ‡πÅ‡∏Ñ‡∏õ‡∏ã‡∏π‡∏•

```
‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 1 ‡∏Å.‡∏¢. 2567
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 1. Finance ‡∏™‡∏£‡πâ‡∏≤‡∏á Budget Request             ‚îÇ
‚îÇ    - ‡∏¢‡∏≤ 5,000 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£                         ‚îÇ
‚îÇ    - ‡∏á‡∏ö‡∏£‡∏ß‡∏° 5,000,000 ‡∏ö‡∏≤‡∏ó                     ‚îÇ
‚îÇ    ‚Üí Status: DRAFT                           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 15 ‡∏Å.‡∏¢. 2567
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 2. Finance Approve                           ‚îÇ
‚îÇ    ‚Üí budget_allocations ‡∏™‡∏£‡πâ‡∏≤‡∏á!              ‚îÇ
‚îÇ    ‚Üí ‡∏á‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô 5,000,000 ‡∏ö‡∏≤‡∏ó             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 1 ‡∏ï.‡∏Ñ. 2567 (‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏õ‡∏µ‡∏á‡∏ö 2568)
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 3. Pharmacist ‡∏™‡∏£‡πâ‡∏≤‡∏á Budget Plan             ‚îÇ
‚îÇ    - ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏¢‡∏≤ 5,000 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£                   ‚îÇ
‚îÇ    - ‡πÅ‡∏ö‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏≤‡∏¢‡πÑ‡∏ï‡∏£‡∏°‡∏≤‡∏™                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 15 ‡∏ï.‡∏Ñ. 2567
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 4. Pharmacist ‡∏™‡∏£‡πâ‡∏≤‡∏á PR-2568-Q1-001          ‚îÇ
‚îÇ    - Amoxicillin 5,000 CAP @ 15.00           ‚îÇ
‚îÇ    - Total: 75,000 ‡∏ö‡∏≤‡∏ó                       ‚îÇ
‚îÇ                                              ‚îÇ
‚îÇ ‚úÖ System Auto:                              ‚îÇ
‚îÇ    - Check budget: OK (1,250,000 available)  ‚îÇ
‚îÇ    - Reserve: 75,000 ‡∏ö‡∏≤‡∏ó                     ‚îÇ
‚îÇ    - Expires: 14 ‡∏û.‡∏¢. 2567 (30 ‡∏ß‡∏±‡∏ô)         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

Available Budget = 1,250,000 - 75,000 = 1,175,000

‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 20 ‡∏ï.‡∏Ñ. 2567
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 5. Warehouse ‡∏™‡∏£‡πâ‡∏≤‡∏á PO-2568-Q1-001           ‚îÇ
‚îÇ    - Vendor: ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏¢‡∏≤ ABC                    ‚îÇ
‚îÇ    - ‡∏ï‡πà‡∏≠‡∏£‡∏≠‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤‡πÑ‡∏î‡πâ: 14.50/CAP                ‚îÇ
‚îÇ    - Total: 68,875 ‡∏ö‡∏≤‡∏ó (‡∏ñ‡∏π‡∏Å‡∏Å‡∏ß‡πà‡∏≤!)           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 25 ‡∏ï.‡∏Ñ. 2567
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 6. Manager Approve PO                        ‚îÇ
‚îÇ                                              ‚îÇ
‚îÇ ‚úÖ System Auto:                              ‚îÇ
‚îÇ    - Commit budget: 68,875 ‡∏ö‡∏≤‡∏ó               ‚îÇ
‚îÇ    - Release reservation                     ‚îÇ
‚îÇ    - Update budget_plan_items                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‡∏á‡∏ö‡∏´‡∏•‡∏±‡∏á Commit:
  q1_spent: 68,875
  remaining: 4,931,125
  saved: 6,125 (‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠‡∏£‡∏≠‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤)

‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 15 ‡∏û.‡∏¢. 2567
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 7. Warehouse ‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡∏•‡∏±‡∏á                  ‚îÇ
‚îÇ    - Amoxicillin 5,000 CAP                   ‚îÇ
‚îÇ    - Lot: LOT2024-001                        ‚îÇ
‚îÇ    - Exp: 01/10/2026                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚úÖ Workflow ‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå!
```

---

### 8.2 ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á SQL Queries ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Monitoring

**Query 1: ‡∏á‡∏ö‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÑ‡∏ï‡∏£‡∏°‡∏≤‡∏™**

```sql
SELECT
  fiscal_year,
  budget_id,
  q1_budget,
  q1_spent,
  q1_budget - q1_spent as q1_remaining,
  ROUND((q1_spent / NULLIF(q1_budget, 0)) * 100, 2) as q1_utilization,
  q2_budget,
  q2_spent,
  q2_budget - q2_spent as q2_remaining,
  ROUND((q2_spent / NULLIF(q2_budget, 0)) * 100, 2) as q2_utilization
FROM budget_allocations
WHERE fiscal_year = 2568
  AND department_id = 1
ORDER BY budget_id;
```

**Query 2: Active Reservations**

```sql
SELECT
  br.id,
  pr.pr_number,
  br.reserved_amount,
  br.quarter,
  br.reservation_date,
  br.expires_date,
  DATE_PART('day', br.expires_date - CURRENT_DATE) as days_until_expire
FROM budget_reservations br
JOIN purchase_requests pr ON pr.id = br.pr_id
WHERE br.is_released = false
  AND br.expires_date > CURRENT_DATE
ORDER BY br.expires_date ASC;
```

**Query 3: Budget vs Actual (Variance Analysis)**

```sql
SELECT
  bpi.generic_id,
  dg.generic_name,
  bpi.planned_quantity,
  bpi.total_purchased_qty,
  bpi.planned_quantity - bpi.total_purchased_qty as variance_qty,
  ROUND((bpi.total_purchased_qty / NULLIF(bpi.planned_quantity, 0)) * 100, 2) as fulfillment_rate,
  bpi.total_planned_value,
  bpi.total_purchased_value,
  bpi.total_planned_value - bpi.total_purchased_value as savings
FROM budget_plan_items bpi
JOIN drug_generics dg ON dg.id = bpi.generic_id
WHERE bpi.budget_plan_id = 1
ORDER BY variance_qty DESC;
```

---

## ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠:

1. ‚úÖ ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à workflow ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô
2. ‚úÖ ‡πÄ‡∏´‡πá‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô vs ‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡πÄ‡∏õ‡πá‡∏ô
3. ‚úÖ ‡∏£‡∏∞‡∏ö‡∏∏‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á
4. ‚úÖ ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏´‡πâ‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå

**Next Steps:**

1. Review ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ
2. Approve ‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤
3. ‡πÄ‡∏£‡∏¥‡πà‡∏° Implementation ‡∏ï‡∏≤‡∏° Phase 1-3

---

**‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£**
